{"version":3,"sources":["utils/index.ts","components/Nav.tsx","assets/logo.png","services/base.ts","types/index.ts","utils/initData.ts","utils/undoRedo.ts","store/template.ts","components/side-bar/ImageItem.tsx","components/side-bar/TextItem.tsx","components/side-bar/UploadImage.tsx","components/side-bar/Sidebar.tsx","services/common.ts","components/Footer.tsx","assets/undo.png","assets/redo.png","store/context.ts","utils/mouseEvent.ts","assets/rotate.svg","components/layer/Border.tsx","assets/lock.svg","components/layer/HoverBorder.tsx","components/layer/Layer.tsx","utils/helpLine.ts","components/layer/TextEditor.tsx","components/Canvas.tsx","assets/opacity.svg","utils/const.ts","components/tool-bar/Index.tsx","components/Editor.tsx","components/Main.tsx","pages/App.tsx","reportWebVitals.ts","index.tsx"],"names":["getCenterCoords","p1","p2","x","y","calcRotatedCoords","point","center","rotate","Math","PI","cos","sin","getCoverImage","selector","a","el","document","querySelector","copyEl","cloneNode","style","transform","position","left","body","appendChild","querySelectorAll","forEach","img","setAttribute","opt","width","offsetWidth","height","offsetHeight","backgroundColor","useCORS","Promise","resolve","reject","html2canvas","then","canvas","res","toDataURL","catch","e","finally","removeChild","Nav","useState","loading","setLoading","exportImage","url","createElement","href","Date","now","click","remove","console","error","Header","Img","src","type","onClick","styled","header","service","axios","create","baseURL","timeout","interceptors","response","use","data","LAYER_TYPE","defaultTemplate","global","background","color","layers","id","reverse","source","imageUrl","opacity","zIndex","content","font","fontSize","lineHeight","textAlign","fontWeight","underline","historyCache","pointer","isUndoOrRedo","undoRedo","setCanUseUndo","templateStore","setCanUseRedo","init","template","push","pushHistory","_template","cloneDeep","map","l","isSelected","isEditing","isHover","splice","length","shift","undo","setTemplate","setLayerType","EMPTY","redo","Object","assign","layer","isLocked","scale","localTemplateCache","localStorage","getItem","JSON","parse","observable","layerType","needUpdateLayerHeight","isMoving","canUseUndo","canUseRedo","this","getTemplate","val","setCanvasSize","size","setLayers","setLayer","idx","findIndex","addLayer","IMAGE","TEXT","removeLayer","setLayerLevel","level","selectLayer","dispatchEvent","Event","hoverLayer","editTextLayer","some","setLayerLock","resetSelectStatus","resetEditStatus","setBackgroundColor","setNeedUpdateLayerHeight","setIsMoving","action","bound","reaction","join","replaceAll","stringify","setItem","save","delay","observer","image","flexBasis","webformatWidth","webformatHeight","draggable","newLayer","String","webformatURL","onDragStartCapture","dataTransfer","setData","alt","Image","div","onUseImage","UploadButton","htmlFor","accept","display","onChange","reader","FileReader","readAsDataURL","target","files","onload","result","label","Panel","Collapse","Search","Input","ajaxLock","isLoadMore","Sidebar","list","setList","page","per_page","image_type","q","orientation","safesearch","query","setQuery","showFilter","setShowFilter","useEffect","params","ajax","key","lang","concat","hits","Side","defaultActiveKey","collapsible","extra","onSearch","preventDefault","placeholder","title","trigger","visible","onVisibleChange","FilterOutlined","stopPropagation","FilterPanel","ListContent","UploadImage","ImageItem","marginTop","TextItem","aside","setScale","FooterBar","SliderWrapper","className","tipFormatter","defaultValue","min","max","round","UndoRedo","ToolItem","footer","ScaleContext","createContext","BackgroundContext","MouseEvents","handleMove","handleUp","payload","startCoords","preCoords","mouseUp","onmousemove","onmouseup","mouseMove","event","diffX","clientX","diffY","clientY","diff","curCoords","mouseDown","POINT_TYPE","MIN_SIZE","INIT_ANGLE","ANGLE_TO_CURSOR","start","end","cursor","info","useContext","cursors","setCursors","resize","whRatio","newX","newY","newWidth","newHeight","TL","TR","BL","BR","T","B","L","R","resizeNormal","pointRect","getBoundingClientRect","canvasRect","pointCenter","Number","top","symmetricPoint","curPoint","oldHeight","newCenterPoint","newOriginCurPoint","newOriginSymmetricPoint","abs","latestOriginCurPoint","latestCurPoint","sqrt","newCenter","isReverse","angle","resizeWithRotate","calcCursors","useCallback","newAngle","item","find","i","BorderEl","LockIcon","icon","lockIcon","PointBR","onMouseDown","PointTL","PointTR","PointBL","PointL","PointR","PointT","PointB","RotateIcon","rotateIcon","borderEl","closest","rect","rotateCenterPoint","offsetY","offsetX","atan2","Point","span","bottom","alignItems","justifyContent","pointerEvents","borderRadius","boxShadow","userSelect","props","right","HoverBorder","children","setIsSelectedBackground","realRect","layerId","allLayers","canvasSize","vLineEl","hLineEl","vType","hType","vLineHandle","targetX","hLineHandle","targetY","renderLine","vLine","visibility","hLine","getRect","scl","rad","move","helpLine","helpLineRect","initHelpLine","helpLinePipe","updatePosition","newPosition","hideLine","LayerWrapper","onMouseEnter","onMouseOut","LayerContent","TransportBorder","Border","createPortal","editorRef","useRef","editor","setEditor","onTextChange","_layer","text","getText","current","instance","Quill","setText","enable","setSelection","on","off","TextWrapper","Text","onDoubleClick","Editor","ref","spellCheck","fontFamily","textDecorationLine","dragCursorPosition","isSelectedBackground","Wrapper","CanvasContent","onDrop","test","getData","onDragOver","pageX","pageY","Background","BACKGROUND","Layer","toJS","TransportEditor","TextEditor","LayerControl","BackgroundBorder","VLine","HLine","TextControl","flex","margin","FONT_LIST","name","value","FONTSIZE_LIST","CANVAS_SIZE_LIST","Option","Select","selectValue","setSelectValue","activeLayer","layerScale","hasUnderline","levelInfo","canvasWidth","canvasHeight","onReverseImage","direction","CanvasSizeOptions","Group","marginRight","isNumber","marginLeft","ToolBarWrapper","ItemGroup","includes","placement","clr","rgba","rgb","r","g","b","ColorItem","f","toFixed","isNaN","BoldOutlined","UnderlineOutlined","align","AlignLeftOutlined","AlignCenterOutlined","AlignRightOutlined","overlay","Item","padding","SwapOutlined","sort","step","opacityIcon","LockOutlined","UnlockOutlined","DeleteOutlined","onConfirm","okText","cancelText","copyLayer","canvasWrapperRef","wrapperEl","clientWidth","clientHeight","onKeyboardListener","activeElement","metaKey","ctrlKey","shiftKey","addEventListener","removeEventListener","CanvasWrapper","Provider","Canvas","Footer","num","Main","MainBody","main","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.2f860cb2.chunk.js","sourcesContent":["import html2canvas from 'html2canvas-stroke2'\n\ninterface Coords {\n  x: number;\n  y: number;\n}\n\n// 求两点之间的中点坐标\nexport const getCenterCoords = (p1: Coords, p2: Coords): Coords => {\n  return {\n    x: p1.x + ((p2.x - p1.x) / 2),\n    y: p1.y + ((p2.y - p1.y) / 2)\n  }\n}\n\n/**\n * 计算根据圆心旋转后的点的坐标\n * @param point 旋转前的点坐标\n * @param center 旋转中心\n * @param rotate 旋转的角度\n * @return 旋转后的坐标\n */\n export const calcRotatedCoords = (point: Coords, center: Coords, rotate: number): Coords => {\n  rotate /= 180 / Math.PI\n  return {\n    x: (point.x - center.x) * Math.cos(rotate) - (point.y - center.y) * Math.sin(rotate) + center.x,\n    y: (point.x - center.x) * Math.sin(rotate) + (point.y - center.y) * Math.cos(rotate) + center.y\n  }\n}\n\n/** 截取图片 */\nexport async function getCoverImage (selector: string): Promise<string> {\n  const el = document.querySelector(selector) as HTMLElement\n  const copyEl = el.cloneNode(true) as HTMLElement\n\n  copyEl.style.transform = ''\n  copyEl.style.position = 'fixed'\n  copyEl.style.left = '-9999px'\n  document.body.appendChild(copyEl)\n  copyEl.querySelectorAll('img').forEach((img) => {\n    // 图片跨域，服务端也要支持（图片服务器配置Access-Control-Allow-Origin）\n    img.setAttribute('crossOrigin', 'anonymous')\n  })\n  const opt = {\n    width: copyEl.offsetWidth, // canvas宽度\n    height: copyEl.offsetHeight,\n    backgroundColor: null, // 画出来的图片有白色的边框,不要可设置背景为透明色（null）\n    useCORS: true // 支持图片跨域\n  }\n\n  return new Promise((resolve, reject) => {\n    html2canvas(copyEl, opt).then((canvas: any) => {\n      const res = canvas.toDataURL('image/png')\n      resolve(res)\n    }).catch((e: any) => {\n      reject(e)\n    }).finally(() => {\n      document.body.removeChild(copyEl)\n    })\n  })\n}\n","import styled from \"@emotion/styled\";\nimport Logo from 'assets/logo.png'\nimport { Button } from 'antd'\nimport { getCoverImage } from 'utils'\nimport { useState } from \"react\";\n\nexport default function Nav () {\n  const [loading, setLoading] = useState(false)\n\n  const exportImage = async () => {\n    setLoading(true)\n    try {\n      const url = await getCoverImage('#canvasContent')\n      const a = document.createElement('a')\n      a.href = url\n      a.setAttribute('download', `${Date.now()}.png`)\n      a.click()\n      a.remove()\n    } catch (e) { console.error(e) }\n    setLoading(false)\n  }\n\n  return <Header>\n    <Img src={Logo} />\n    <Button loading={loading} type=\"primary\" onClick={exportImage}>导出图片</Button>\n  </Header>\n}\n\nconst Header = styled.header`\n  height: 56px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 20px;\n  background-color: #fff;\n  border-bottom: 1px solid #ddd;\n`\n\nconst Img = styled.img`\n  width: 48px;\n  height: 48px;\n  object-fit: cover;\n`","export default \"data:image/png;base64,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\"","import axios from 'axios'\n\nconst service = axios.create({\n  baseURL: 'https://pixabay.com/api',\n  timeout: 10000\n})\n\nservice.interceptors.response.use((response) => {\n  return response.data\n})\n\nexport default service","export interface TemplateInfo {\n  global: {\n    width: number;\n    height: number;\n  },\n  background: {\n    color: string;\n  },\n  layers: Layer[];\n}\n\nexport interface Layer {\n  id: string;\n  type: LayerType;\n  width: number;\n  height: number;\n  position: {\n    x: number;\n    y: number;\n  };\n  rotate: number;\n  reverse?: {\n    x: number;\n    y: number;\n  },\n  source: {\n    imageUrl?: string;\n    content?: string;\n  };\n  opacity: number;\n  style?: FontStyle;\n  zIndex: number;\n  isSelected?: boolean;\n  isHover?: boolean;\n  isEditing?: boolean;\n  isLocked?: boolean;\n  scale?: number;\n}\n\nexport interface FontStyle {\n  font: string;\n  fontSize: number;\n  lineHeight: number;\n  color: string;\n  textAlign: Align;\n  fontWeight: number;\n  underline: boolean;\n}\n\nexport type LayerType = 'image' | 'text'\nexport type Align = 'left' | 'center' | 'right' | 'justify'\n\nexport enum LAYER_TYPE {\n  EMPTY = 'empty',\n  IMAGE = 'image',\n  TEXT = 'text',\n  BACKGROUND = 'background'\n}","import { TemplateInfo } from 'types'\n\nexport const defaultTemplate: TemplateInfo = {\n  global: {\n    width: 1280,\n    height: 720\n  },\n  background: {\n    color: '#fff'\n  },\n  layers: [\n    {\n      id: '1',\n      type: 'image',\n      width: 510,\n      height: 340,\n      position: {\n        x: 100,\n        y: 100\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: 'https://cdn.pixabay.com/photo/2014/04/13/20/49/cat-323262__340.jpg'\n      },\n      opacity: 1,\n      zIndex: 1\n    },\n    {\n      id: '2',\n      type: 'text',\n      width: 380,\n      height: 72,\n      position: {\n        x: 100,\n        y: 500\n      },\n      rotate: 0,\n      source: {\n        content: '双击编辑文字'\n      },\n      style: {\n        font: 'Microsoft Yahei',\n        fontSize: 60,\n        lineHeight: 1.2,\n        color: '#000',\n        textAlign: 'left',\n        fontWeight: 400,\n        underline: false\n      },\n      opacity: 1,\n      zIndex: 2\n    }\n  ]\n}","import { cloneDeep } from 'lodash'\nimport { templateStore } from 'store/template'\nimport { TemplateInfo, LAYER_TYPE } from 'types'\n\nconst historyCache: TemplateInfo[] = []\nlet pointer = 0\nlet isUndoOrRedo = false\n\nexport default function undoRedo () {\n  const { setCanUseUndo, setCanUseRedo } = templateStore\n\n  const init = (template: TemplateInfo) => {\n    historyCache.push(template)\n  }\n\n  // 缓存历史记录\n  const pushHistory = () => {\n    if (isUndoOrRedo) {\n      isUndoOrRedo = false\n      return\n    }\n\n    const _template = cloneDeep(templateStore.template)\n    _template.layers = _template.layers.map(l => {\n      l.isSelected = false\n      l.isEditing = false\n      l.isHover = false\n      return l\n    })\n    pointer++\n    historyCache[pointer] = _template\n    historyCache.splice(pointer + 1, historyCache.length)\n    setCanUseUndo(true)\n    setCanUseRedo(false)\n    if (historyCache.length > 100) {\n      historyCache.shift()\n      pointer--\n    }\n  }\n\n  // 撤销\n  const undo = () => {\n    if (historyCache[pointer - 1]) {\n      isUndoOrRedo = true\n      pointer--\n      const _template = historyCache[pointer]\n      templateStore.setTemplate(cloneDeep(_template))\n      templateStore.setLayerType(LAYER_TYPE.EMPTY)\n      setCanUseRedo(true)\n      if (!historyCache[pointer - 1]) {\n        setCanUseUndo(false)\n      }\n    }\n  }\n\n  // 重做\n  const redo = () => {\n    if (historyCache[pointer + 1]) {\n      isUndoOrRedo = true\n      pointer++\n      const _template = historyCache[pointer]\n      templateStore.setTemplate(cloneDeep(_template))\n      templateStore.setLayerType(LAYER_TYPE.EMPTY)\n      setCanUseUndo(true)\n      if (!historyCache[pointer + 1]) {\n        setCanUseRedo(false)\n      }\n    }\n  }\n\n  return {\n    init,\n    pushHistory,\n    undo,\n    redo\n  }\n}","import { observable, action, reaction } from 'mobx'\nimport { defaultTemplate } from 'utils/initData'\nimport { TemplateInfo, Layer, LAYER_TYPE } from 'types'\nimport { cloneDeep } from 'lodash'\nimport undoRedo from 'utils/undoRedo'\n\nlet template: TemplateInfo = Object.assign(defaultTemplate, {\n  layers: defaultTemplate.layers.map(layer => { return {...layer, isSelected: false, isEditing: false, isHover: false, isLocked: false, scale: 1} })\n})\n\nconst localTemplateCache = localStorage.getItem('TEMPLATE')\nif (localTemplateCache) {\n  template = JSON.parse(localTemplateCache)\n}\n\n// 模板store\nexport const templateStore = observable({\n  // 模板\n  template: template,\n  // 当前编辑图层类型\n  layerType: LAYER_TYPE.EMPTY,\n  // 是否需要重新计算图层的高度，比如改变字体大小时需要\n  needUpdateLayerHeight: false,\n  // 图层是否正在移动\n  isMoving: false,\n  canUseUndo: false,\n  canUseRedo: false,\n\n  get layers (): Layer[] {\n    return this.template.layers\n  },\n\n  // 获取最新的模板\n  getTemplate () {\n    const _template = cloneDeep(templateStore.template)\n    _template.layers = _template.layers.map(l => {\n      if (l.type === 'text' && l.style && l.scale) {\n        l.style.fontSize *= l.scale\n      }\n      delete l.isSelected\n      delete l.isEditing\n      delete l.scale\n      return l\n    })\n    return _template\n  },\n\n  // 修改整体模板\n  setTemplate (val: TemplateInfo) {\n    this.template = val\n  },\n\n  // 修改画布尺寸\n  setCanvasSize (size: { width: number; height: number }) {\n    this.template.global.width = size.width\n    this.template.global.height = size.height\n  },\n\n  // 修改全部图层\n  setLayers (layers: Layer[]) {\n    this.template.layers = layers\n  },\n\n  // 修改单个图层\n  setLayer (layer: Layer) {\n    const idx = this.layers.findIndex(l => l.id === layer.id)\n    if (idx > -1 && !this.layers[idx].isLocked) {\n      this.layers[idx] = layer\n    }\n  },\n\n  // 新增单个图层\n  addLayer (layer: Layer) {\n    this.layers.push(layer)\n    if (layer.type === 'image') {\n      this.setLayerType(LAYER_TYPE.IMAGE)\n    } else if (layer.type === 'text') {\n      this.setLayerType(LAYER_TYPE.TEXT)\n    }\n  },\n\n  // 移除单个图层\n  removeLayer (id: string) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1 && !this.layers[idx].isLocked) {\n      this.layers.splice(idx, 1)\n      this.setLayerType(LAYER_TYPE.EMPTY)\n    }\n  },\n\n  // 设置图层层级\n  setLayerLevel (id: string, level: number) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1) {\n      this.layers[idx].zIndex = level\n    }\n  },\n\n  // 选择图层\n  selectLayer (id: string) {\n    this.layers.forEach(layer => {\n      layer.isSelected = layer.id === id\n      if (layer.isSelected) {\n        if (layer.type === 'image') {\n          this.setLayerType(LAYER_TYPE.IMAGE)\n        } else if (layer.type === 'text') {\n          this.setLayerType(LAYER_TYPE.TEXT)\n        }\n      }\n    })\n    // 隐藏一些下拉组件\n    document.dispatchEvent(new Event('mousedown'))\n  },\n\n  // 鼠标经过图层\n  hoverLayer (id?: string) {\n    this.layers.forEach(layer => {\n      layer.isHover = id ? layer.id === id : false\n    })\n  },\n\n  // 设置当前选择的图层类型\n  setLayerType (type: LAYER_TYPE) {\n    this.layerType = type\n  },\n\n  // 设置文字图层编辑状态\n  editTextLayer (id: string) {\n    if (this.layers.some(l => l.id === id && l.isLocked)) return\n    this.layers.forEach(layer => {\n      layer.isEditing = layer.id === id\n    })\n  },\n\n  // 设置图层锁定状态\n  setLayerLock (id: string, isLocked: boolean) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1) {\n      this.layers[idx].isLocked = isLocked\n      this.layers[idx].isEditing = false\n    }\n  },\n\n  // 重置所有图层选中状态\n  resetSelectStatus () {\n    this.layers.forEach(layer => {\n      layer.isSelected = false\n    })\n    this.setLayerType(LAYER_TYPE.EMPTY)\n  },\n\n  // 重置所有文字图层编辑状态\n  resetEditStatus () {\n    this.layers.forEach(layer => {\n      layer.isEditing = false\n    })\n  },\n\n  // 设置背景色\n  setBackgroundColor (color: string) {\n    this.template.background.color = color\n  },\n\n  // 设置needUpdateLayerHeight\n  setNeedUpdateLayerHeight (val: boolean) {\n    this.needUpdateLayerHeight = val\n  },\n\n  // 设置isMoving\n  setIsMoving (val: boolean) {\n    this.isMoving = val\n  },\n\n  setCanUseUndo (val: boolean) {\n    this.canUseUndo = val\n  },\n\n  setCanUseRedo (val: boolean) {\n    this.canUseRedo = val\n  },\n}, {\n  setTemplate: action.bound,\n  getTemplate: action.bound,\n  setCanvasSize: action.bound,\n  setLayers: action.bound,\n  setLayer: action.bound,\n  addLayer: action.bound,\n  removeLayer: action.bound,\n  selectLayer: action.bound,\n  setLayerLevel: action.bound,\n  hoverLayer: action.bound,\n  setLayerType: action.bound,\n  editTextLayer: action.bound,\n  setLayerLock: action.bound,\n  resetSelectStatus: action.bound,\n  resetEditStatus: action.bound,\n  setBackgroundColor: action.bound,\n  setNeedUpdateLayerHeight: action.bound,\n  setIsMoving: action.bound,\n  setCanUseUndo: action.bound,\n  setCanUseRedo: action.bound\n})\n\n// 切换图层时重置文字编辑状态\n// 清空空文字图层\nreaction(\n  () => templateStore.layers.map(l => l.isSelected).join(''),\n  () => {\n    templateStore.resetEditStatus()\n    const idx = templateStore.layers.findIndex(l => l.type === 'text' && !l.source.content?.replaceAll(/\\n/g, ''))\n    if (idx > -1) {\n      templateStore.removeLayer(templateStore.layers[idx].id)\n    }\n  }\n)\n\n// 撤销重做\nconst { init, pushHistory } = undoRedo()\ninit(template)\n\n// 保存到本地\nconst save = () => {\n  const template = cloneDeep(templateStore.template)\n  template.layers = template.layers.map(l => {\n    l.isSelected = false\n    l.isEditing = false\n    l.isHover = false\n    return l\n  })\n  localStorage.setItem('TEMPLATE', JSON.stringify(template))\n}\n\n// 侦听保存\nreaction(\n  () => {\n    const template = cloneDeep(templateStore.template)\n    template.layers = template.layers.map(l => {\n      delete l.isSelected\n      delete l.isEditing\n      delete l.isHover\n      return l\n    })\n    return JSON.stringify(template)\n  },\n  () => { save(); pushHistory() },\n  {\n    delay: 500\n  }\n)\n","import styled from \"@emotion/styled\";\nimport { ImageItem as ImageInfo } from \"types/image\";\nimport { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { observer } from 'mobx-react';\nimport { DragEvent } from 'react'\n\nexport default observer(({ image }: { image: ImageInfo }) => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n\n  // 使用图片\n  const onUseImage = () => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'image',\n      width: image.webformatWidth,\n      height: image.webformatHeight,\n      position: {\n        x: (template.global.width - image.webformatWidth) / 2,\n        y: (template.global.height - image.webformatHeight) / 2\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: image.webformatURL\n      },\n      opacity: 1,\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n\n  // 拖拽图片\n  const onDragStartCapture = (e: DragEvent<HTMLDivElement>) => {\n    e.dataTransfer.setData('image', JSON.stringify(image))\n  }\n\n  return <Image\n    style={{\n      flexBasis: `${100 * image.webformatWidth / image.webformatHeight}px`\n    }}\n    draggable=\"true\"\n    onClick={onUseImage}\n    onDragStartCapture={onDragStartCapture}\n  >\n    <img src={image.webformatURL} alt=\"\" draggable=\"false\" />\n  </Image>\n})\n\nconst Image = styled.div`\n  position: relative;\n  margin: 0 10px 10px 0;\n  background-color: #f0f1f4;\n  overflow: hidden;\n  flex-grow: 1;\n\n  img {\n    min-width: 100%;\n    height: 100px;\n    object-fit: cover;\n  }\n`","import { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { Button } from 'antd';\nimport { observer } from 'mobx-react';\n\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus, editTextLayer } = templateStore\n\n  // 新增文本\n  const onUseImage = () => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'text',\n      width: 380,\n      height: 72,\n      position: {\n        x: (template.global.width - 300) / 2,\n        y: (template.global.height - 72) / 2\n      },\n      rotate: 0,\n      source: {\n        content: '双击编辑文字'\n      },\n      style: {\n        font: '微软雅黑',\n        fontSize: 60,\n        lineHeight: 1.2,\n        color: '#000',\n        textAlign: 'left',\n        fontWeight: 400,\n        underline: false\n      },\n      opacity: 1,\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: true,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n    editTextLayer(newLayer.id)\n  }\n\n  return <Button size=\"large\" style={{ width: '100%' }} onClick={onUseImage}>\n    添加文本\n  </Button>\n})","import styled from \"@emotion/styled\";\nimport { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { Button } from 'antd';\nimport { observer } from 'mobx-react';\n\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n\n  // 选择图片\n  const uploadImage = (e: any) => {\n    const reader = new FileReader()\n    reader.readAsDataURL(e.target.files[0])\n    reader.onload = el => {\n      const url = el.target?.result\n      if (typeof url === 'string') {\n        const img = new Image()\n        img.src = url\n        img.onload = () => {\n          onUseImage(img.width, img.height, url)\n        }\n      }\n    }\n  }\n\n  // 使用图片\n  const onUseImage = (width: number, height: number, url: string) => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'image',\n      width: width,\n      height: height,\n      position: {\n        x: (template.global.width - width) / 2,\n        y: (template.global.height - height) / 2\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: url\n      },\n      opacity: 1,\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n\n  return <>\n    <UploadButton htmlFor=\"uploadImage\">\n      <Button size=\"large\">\n        选择本地图片\n      </Button>\n    </UploadButton>\n    <input type=\"file\" id=\"uploadImage\" accept=\"image/*\" style={{ display: 'none' }} onChange={uploadImage} />\n  </>\n})\n\nconst UploadButton = styled.label`\n  display: block;\n  width: 100%;\n  margin-bottom: 16px;\n  cursor: pointer;\n\n  button {\n    width: 100%;\n    pointer-events: none;\n  }\n`","import styled from \"@emotion/styled\";\nimport { useState, useEffect } from \"react\";\nimport { ImageItem as ImageInfo, SearchQuery } from \"types/image\";\nimport { getImages } from \"services/common\";\nimport { Collapse } from 'antd';\nimport { FilterOutlined } from '@ant-design/icons';\nimport { Popover, Input, Button } from 'antd';\nimport ImageItem from './ImageItem'\nimport TextItem from './TextItem'\nimport UploadImage from \"./UploadImage\";\n\nconst { Panel } = Collapse\nconst { Search } = Input\n\nlet ajaxLock = false\nlet isLoadMore = false\n\nexport default function Sidebar () {\n  // 图片列表\n  const [list, setList] = useState<ImageInfo[]>([])\n  // 图片查询参数\n  const [query, setQuery] = useState<Partial<SearchQuery>>({\n    page: 1,\n    per_page: 20,\n    image_type: 'all',\n    q: '',\n    orientation: 'all',\n    safesearch: true\n  })\n\n  const [showFilter, setShowFilter] = useState(false)\n\n  useEffect(() => {\n    getImages(query).then((data: any) => {\n      if (isLoadMore) {\n        setList(list => list.concat(data.hits))\n      } else {\n        setList(data.hits)\n      }\n    }).finally(() => {\n      ajaxLock = false\n    })\n  }, [query])\n\n  // 加载更多图片\n  const onLoadMore = () => {\n    if (ajaxLock) return\n    ajaxLock = true\n    const page = query.page\n    isLoadMore = true\n    setQuery(Object.assign({}, query, {\n      page: page ? page + 1 : 1\n    }))\n  }\n\n  // 图片筛选面板\n  const FilterPanel = () => {\n    const onSearch = (val: string, e: any) => {\n      e.preventDefault()\n      if (val) {\n        isLoadMore = false\n        setQuery(Object.assign({}, query, {\n          q: val,\n          page: 1\n        }))\n      }\n    }\n\n    const Content = () => {\n      return <>\n        <Search placeholder=\"搜索\" onSearch={onSearch} style={{ width: 200 }} />\n      </>\n    }\n\n    return <Popover\n      content={Content}\n      title=\"筛选\"\n      trigger=\"click\"\n      visible={showFilter}\n      onVisibleChange={visible => setShowFilter(visible)}\n    >\n      <FilterOutlined onClick={(e) => { e.stopPropagation(); setShowFilter(true) }} />\n    </Popover>\n  }\n\n  return <Side>\n    <Collapse defaultActiveKey={['1']} collapsible=\"header\">\n      <Panel header={<div style={{ width: '300px' }}>图片</div>} key=\"1\" extra={FilterPanel()}>\n        <ListContent>\n          <UploadImage />\n          {list.map(image => <ImageItem key={image.id} image={image} />)}\n          <Button style={{ width: '100%', marginTop: '20px' }} onClick={onLoadMore}>加载更多</Button>\n      </ListContent>\n      </Panel>\n      <Panel header={<div style={{ width: '300px' }}>文字</div>} key=\"2\">\n        <ListContent>\n          <TextItem />\n        </ListContent>\n      </Panel>\n    </Collapse>\n  </Side>\n}\n\nconst Side = styled.aside`\n  flex: none;\n  display: flex;\n  flex-direction: column;\n  width: 400px;\n  height: 100%;\n  background-color: #fff;\n  border-right: 1px solid #ddd;\n  overflow-y: scroll;\n\n  ::-webkit-scrollbar {\n    width: 8px;\n    background: #fff;\n\n    &:horizontal {\n      height: 8px;\n    }\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #fff;\n  }\n\n  ::-webkit-scrollbar-corner {\n    background: #fff;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #c4c4c4;\n    border: 8px solid rgba(0, 0, 0, 0);\n    border-radius: 9999px;\n\n    &:hover {\n      background: #adadad;\n    }\n  }\n\n  .ant-collapse {\n    border: 0;\n    background-color: #fff;\n  }\n`\n\nconst ListContent = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  padding-left: 10px;\n  user-select: none;\n\n  &:after {\n    content: '';\n    display: block;\n    flex-grow: 99999;\n  }\n`\n","import ajax from './base'\n\nconst key = '24178889-8dbe9fccf0c585814c1dcb342'\n\nexport const getImages = (params: any): any => {\n  return ajax({\n    url: '/',\n    params: {\n      key,\n      lang: 'zh',\n      ...params\n    }\n  })\n}\n","import styled from \"@emotion/styled\";\nimport { Slider } from \"antd\";\nimport UndoIcon from \"assets/undo.png\";\nimport RedoIcon from \"assets/redo.png\";\nimport undoRedo from 'utils/undoRedo'\nimport { templateStore } from 'store/template'\nimport { observer } from 'mobx-react';\n\nconst { undo, redo } = undoRedo()\n\nexport default observer(({ scale, setScale }: { scale: number; setScale: (n: number) => void }) => {\n  const { canUseUndo, canUseRedo } = templateStore\n\n  const scaleChange = (val: number) => {\n    setScale(val / 100)\n  }\n\n  return <FooterBar>\n    <SliderWrapper>\n      <Slider\n        className=\"slider\"\n        tipFormatter={null}\n        defaultValue={scale * 100}\n        min={10} max={500}\n        onChange={scaleChange}\n      />\n      <div className=\"scale\">{Math.round(scale * 100)}%</div>\n    </SliderWrapper>\n    <UndoRedo>\n      <ToolItem className={ canUseUndo ? 'active' : '' } onClick={undo}><img src={UndoIcon} alt=\"\" /></ToolItem>\n      <ToolItem className={ canUseRedo ? 'active' : '' } onClick={redo}><img src={RedoIcon} alt=\"\" /></ToolItem>\n    </UndoRedo>\n  </FooterBar>\n})\n\nconst FooterBar = styled.footer`\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  width: 100%;\n  height: 44px;\n  padding: 0 40px;\n  background-color: #fff;\n  border-top: 1px solid #ddd;\n\n  .slider {\n    width: 240px;\n  }\n\n  .scale {\n    width: 100px;\n    padding-left: 20px;\n  }\n`\n\nconst SliderWrapper = styled.div`\n  display: flex;\n  align-items: center;\n`\n\nconst UndoRedo = styled.div`\n  display: flex;\n  justify-content: space-around;\n  width: 120px;\n\n  img {\n    width: 22px;\n    height: 22px;\n    pointer-events: none;\n    user-select: none;\n  }\n`\n\nconst ToolItem = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 6px 8px;\n  border-radius: 4px;\n  cursor: not-allowed;\n  opacity: .5;\n\n  &:hover {\n    background-color: rgba(64,87,109,.07);\n  }\n\n  &.active {\n    opacity: 1;\n    cursor: pointer;\n  }\n`","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAArRJREFUWEfFl09rE1EQwGfyB/SgKOjBQz1IIeBBEPsB6tFL8uZBCiIIgiiKigcpiKDtwYJ4kFpQiAh68WDovrdRWMGDfoAW9KBURRCUigoe9BJD3o5syZbNZje7G5P4IITMmzfzezPzZgjCf16Yxj8RXQWAeWae11rPpTmTVicRQAhxGREXfIPDhugLQESXAOBm8DaI+MCyrBNpb5ikFwtARBcAYDFk4I3rujO2bb9NMpx2PxJACHEGEe+M2rlnvwdASnmSme+Nw3kPABEdB4CHEeHzIvKtIzfM7HqrUCgY79v7DQCe/Hur1friOM6vzCkQQhxFxEdpDyborSGicl13WWu92k93IwXVanWy3W5/GJLzLjOIWDPGLMYV7mYNENFjj2UUEAAQ+3q6ijAOwms+acAQcQIASp3PrjSF3PMKoiAG6X5CiNuIeD4JIrIPDBFiGhFfhDppzbKs076sXyeMqolZpVRXa05KTblcLuXz+bWgHjNP+a8jaRb0QLiue8y27UzPVQgxi4g3Nm+NeMWyrI0BlzgNw+kYdBgR0U8A2NmBeKWUOpgKwFMKQDxn5lNa609JoQ/vE9EKABzy5caY7Y1G43diBPwDQoi5YrG4UK/XW1mdhy7hHy8ppd6nBhjEafCMdwFEvObLmPmw1vrl2ACIaBkAZABgUmv9cWwAUsrXzHzAB2g2m1scx/kzFoBKpTKRy+XeAcDWDsAzpdSR1K/gX/MvpVxi5nOB8J/VWt8dCwAReRPWa2j+WkfEKcuyvo4cQEp5i5kvhtpw13+LodeAEGJHoVDYb4y5DgDTofTVlVIzQVlmgGq1utsYc5+Zt0XUxl4A2BdTMz3OB0qBEKJnxKYo0kjn4wBYZeaa1roWB5k5BVLKPcy8HmPwBwB8RsQVZn6ilHqaFJ3MAEkGs+7/BQfySDDlTlsQAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAqtJREFUWEfFljGrE0EQx2duQ0yjiKA2TxBEfWjhg2dno1gdaLJzD2MlKOLDRkUtLCx8tqIgPEGwULASD243ATvB9wVEsBCEh4qChQqKFlpcMrIhd1wul9wuOXEhhGRn5v+7uZ2ZRfjPC6vWl1KuIOINAGgrpcKy+JUCZMQT3VKISgGCIHjEzKdzTz0VolKAVqu1z/O8pwCw3xaiUgAj6gpROYArhBOA7/ub6vX6HCJuAwCBiJ5ZcRwL821+m/8NBDNvB4D7BVUwciZKAaSUi57nLTEzAcB8WVlZ7qcQEwHMuxRCXGLmZcugTma1Wm13GIbrhQDDg/QMAHY6RbU3DpVSbWM+BiClPIyILwpifQOAt+bDzJ9stIYdMW+aio8BSCkXhuKbs17MvKq1vmgjmtgUdEWzNSI+BkBEpomcyIkf0VqvuYgT0RUAuJPzGRMfASCiMwDwMOvU6/Xmu92uSbv1IqJzAPDARnwEIAiCx8x8KnFk5mta61vWygAQBMFJZn5iK57PwPvMqf+ulNriIm5sC4ZRYdqzcQdV0Gw2NwohfmY2XiqlDroC5OZAqXiaASLaMyyxRNPKuQjQQCBiW2u9YvMAgwzka5+Zb9oGsBGZZpMA7ELE9YxhpJRamjW4jf8AwPf9DY1G40/igIivoyg6YBNgVpu0FRPRKwBYGAb83e/393Y6HauWOwtEFsDM7vOZLNyLoujCLMFtfFMAKeVRRHyecyq91dqIlB7CxEBKeRsRr440CsS7URRdnlVokv/YOM6dhcRvTQhxPY7jN1rrH1XCFF5IiOgLAGydIPQOAD7m9xDxlxDibBiGX10AJ17JikZzWWBmdh7dUy+lUsplRDR3wsUycbNfOUAiSkTHEPE4M5sBtWPC6/nMzIe01h9sYNNydzH+F7Z/AWqi/yEtgkl8AAAAAElFTkSuQmCC\"","import { createContext } from \"react\";\nexport const ScaleContext = createContext<number>(1)\nexport const BackgroundContext = createContext<any>(null)","import { MouseEvent as MouseEventType } from \"react\";\n\nexport class MouseEvents {\n  constructor (e: MouseEventType<HTMLElement>, handleMove: (payload: any) => void, handleUp?: () => void) {\n    this.mouseDown(e)\n    this.handleMove = handleMove\n    handleUp && (this.handleUp = handleUp)\n  }\n  \n  private handleMove = (payload: any) => {}\n  private handleUp = () => {}\n\n  private startCoords = {\n    x: 0,\n    y: 0\n  }\n\n  private preCoords = {\n    x: 0,\n    y: 0\n  }\n\n  private mouseUp = () => {\n    document.onmousemove = null\n    document.onmouseup = null\n    this.handleUp()\n  }\n\n  private mouseMove = (event: any) => {\n    const diffX = event.clientX - this.preCoords.x\n    const diffY = event.clientY - this.preCoords.y\n    this.preCoords = {\n      x: event.clientX,\n      y: event.clientY\n    }\n    this.handleMove({\n      diff: {\n        x: diffX,\n        y: diffY\n      },\n      startCoords: this.startCoords,\n      curCoords: this.preCoords\n    })\n  }\n\n  private mouseDown = (e: MouseEventType<HTMLElement>) => {\n    this.startCoords = {\n      x: e.clientX,\n      y: e.clientY\n    }\n    this.preCoords = {\n      x: e.clientX,\n      y: e.clientY\n    }\n    document.onmousemove = this.mouseMove\n    document.onmouseup = this.mouseUp\n  }\n}","export default __webpack_public_path__ + \"static/media/rotate.a7cc796d.svg\";","import { Layer } from 'types';\nimport { MouseEvent, useContext, useState, useEffect, useCallback } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { ScaleContext } from 'store/context';\nimport { MouseEvents } from 'utils/mouseEvent';\nimport { getCenterCoords, calcRotatedCoords } from 'utils';\nimport rotateIcon from 'assets/rotate.svg';\nimport lockIcon from 'assets/lock.svg';\nimport { templateStore } from 'store/template';\nimport { cloneDeep } from 'lodash';\nimport { observer } from 'mobx-react';\n\nenum POINT_TYPE {\n  TL = 'topLeft',\n  TR = 'topRight',\n  BL = 'bottomLeft',\n  BR = 'bottomRight',\n  T = 'top',\n  B = 'bottom',\n  L = 'left',\n  R = 'right'\n}\n\ninterface Coords {\n  x: number;\n  y: number;\n}\n\nconst MIN_SIZE = {\n  width: 10,\n  height: 10\n}\n\n// 初始的指针角度（左上、上、右上、右）\nconst INIT_ANGLE = [0, 45, 90, 135]\n// 角度范围对应的指针样式\nconst ANGLE_TO_CURSOR = [\n  { start: 0, end: 23, cursor: 'nwse-resize' },\n  { start: 338, end: 360, cursor: 'nwse-resize' },\n  { start: 23, end: 68, cursor: 'ns-resize' },\n  { start: 68, end: 113, cursor: 'nesw-resize' },\n  { start: 113, end: 158, cursor: 'ew-resize' },\n  { start: 158, end: 203, cursor: 'nwse-resize' },\n  { start: 203, end: 248, cursor: 'ns-resize' },\n  { start: 248, end: 293, cursor: 'nesw-resize' },\n  { start: 293, end: 338, cursor: 'ew-resize' }\n]\n\n// 编辑框\nexport default observer(({ info }: { info: Layer; }) => {\n  const scale = useContext(ScaleContext)\n\n  const { layers, setLayer, isMoving, setIsMoving } = templateStore\n\n  // 鼠标样式\n  const [cursors, setCursors] = useState<string[]>([])\n\n  // 调整大小 无旋转\n  const resizeNormal = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    const idx = layers.findIndex(layer => layer.id === info.id)\n    // const layer = cloneDeep(layers[idx])\n\n    if (idx > -1) {\n      new MouseEvents(e, (payload) => {\n        const layer = cloneDeep(layers[idx])\n\n        const { x, y } = payload.diff\n        const whRatio = layer.width / layer.height\n        let { x: newX, y: newY } = layer.position\n        let { width: newWidth, height: newHeight } = layer\n        switch (point) {\n          case POINT_TYPE.TL: {\n            const height = layer.height\n            newWidth -= x / scale\n            newX += x / scale\n            newHeight = newWidth / whRatio\n            newY -= newHeight - height\n            break\n          }\n          case POINT_TYPE.TR: {\n            const height = layer.height\n            newWidth += x / scale\n            newHeight = newWidth / whRatio\n            newY -= newHeight - height\n            break\n          }\n          case POINT_TYPE.BL: {\n            newWidth -= x / scale\n            newX += x / scale\n            newHeight = newWidth / whRatio\n            break\n          }\n          case POINT_TYPE.BR: {\n            newWidth += x / scale\n            newHeight = newWidth / whRatio\n            break\n          }\n          case POINT_TYPE.T: {\n            newHeight -= y / scale\n            newY += y / scale\n            break\n          }\n          case POINT_TYPE.B: {\n            newHeight += y / scale\n            break\n          }\n          case POINT_TYPE.L: {\n            newWidth -= x / scale\n            newX += x / scale\n            break\n          }\n          case POINT_TYPE.R: {\n            newWidth += x / scale\n            break\n          }\n        }\n\n        if ((newWidth > MIN_SIZE.width && newHeight > MIN_SIZE.height) || newWidth > layer.width || newHeight > layer.height) {\n          if (layer.type === 'text') {\n            if (layer.height !== newHeight && layer.scale) {\n              layer.scale *= newHeight / layer.height\n            }\n          }\n\n          layer.width = newWidth\n          layer.height = newHeight\n          layer.position.x = newX\n          layer.position.y = newY\n        }\n\n        setLayer(layer)\n        setIsMoving(true)\n      }, () => {\n        setIsMoving(false)\n      })\n    }\n  }\n\n  // 调整大小 有旋转\n  const resizeWithRotate = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    // 图层相对于画布左上角的中心点\n    const center = {\n      x: (info.position.x + info.width / 2) * scale,\n      y: (info.position.y + info.height / 2) * scale\n    }\n\n    // 获取边框圆点中心点\n    const pointRect = (e.target as HTMLElement)?.getBoundingClientRect()\n    const canvasRect = (document.querySelector('#layerControl') as HTMLElement)?.getBoundingClientRect()\n    const pointCenter = {\n      x: pointRect.left - Number(canvasRect.left) + pointRect.width / 2,\n      y: pointRect.top - Number(canvasRect.top) + pointRect.height / 2\n    }\n\n    // 获取对称点\n    const symmetricPoint = {\n      x: center.x - (pointCenter.x - center.x),\n      y: center.y - (pointCenter.y - center.y)\n    }\n\n    const whRatio = info.width / info.height\n    const idx = layers.findIndex(layer => layer.id === info.id)\n    // const layer = cloneDeep(layers[idx])\n\n    new MouseEvents(e, ({ curCoords }: { curCoords: Coords }) => {\n      const layer = cloneDeep(layers[idx])\n\n      const curPoint = {\n        x: curCoords.x - Number(canvasRect.left),\n        y: curCoords.y - Number(canvasRect.top)\n      }\n\n      const oldHeight = layer.height\n\n      switch (point) {\n        case POINT_TYPE.TL: {\n          // 根据鼠标当前位置和对称点获取最新中心点\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的左上角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          // 获取旋转前的对称点坐标\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          let newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          // 获取等比缩放计算后的坐标\n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x += Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y += Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          // 由于现在求的未旋转前的坐标是以没按比例缩减宽高前的坐标来计算的\n          // 所以缩减宽高后，需要按照原来的中心点旋转回去，获得缩减宽高并旋转后对应的坐标\n          // 然后以这个坐标和对称点获得新的中心点，并重新计算未旋转前的坐标\n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginCurPoint.y / scale\n            layer.position.x = newOriginCurPoint.x / scale\n          }\n          break\n        }\n\n        case POINT_TYPE.TR: {\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的右上角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          let newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x -= Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y += Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginCurPoint.y / scale\n            layer.position.x = newOriginSymmetricPoint.x / scale\n          }\n          break\n        }\n  \n        case POINT_TYPE.BR: {\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的右下角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          let newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x -= Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y -= Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginSymmetricPoint.y / scale\n            layer.position.x = newOriginSymmetricPoint.x / scale\n          }\n          break\n        }\n  \n        case POINT_TYPE.BL: {\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的左下角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          let newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x += Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y -= Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginSymmetricPoint.y / scale\n            layer.position.x = newOriginCurPoint.x / scale\n          }\n          break\n        }\n  \n        case POINT_TYPE.T:\n        case POINT_TYPE.B: {\n          // 由于用户拉伸时是以任意角度拉伸的，所以在求得旋转前的坐标时，只取 y 坐标（这里的 x 坐标可能是任意值），x 坐标用 pointCenter 的。\n          // 这个中心点（第二个参数）用 pointCenter, center, symmetricPoint 都可以，只要他们在一条直线上就行\n          const newOriginCurPoint = calcRotatedCoords(curPoint, pointCenter, -info.rotate)\n  \n          // 算出旋转前 y 坐标，再用 initCurPoint 的 x 坐标，重新计算它们旋转后对应的坐标\n          const latestCurPoint = calcRotatedCoords({\n            x: pointCenter.x,\n            y: newOriginCurPoint.y\n          }, pointCenter, info.rotate)\n  \n          // 用旋转后的坐标和对称点算出新的高度（勾股定理）\n          const newHeight = Math.sqrt((latestCurPoint.x - symmetricPoint.x) ** 2 + (latestCurPoint.y - symmetricPoint.y) ** 2)\n  \n          const newCenter = {\n            x: latestCurPoint.x - (latestCurPoint.x - symmetricPoint.x) / 2,\n            y: latestCurPoint.y + (symmetricPoint.y - latestCurPoint.y) / 2\n          }\n  \n          // 是否反向拉伸了\n          let isReverse = false\n          const angle = (info.rotate + 360) % 360\n          // 禁止反向拉伸\n          if (point === POINT_TYPE.T) {\n            if ((angle >= 0 && angle <= 90) || (angle >= 270 && angle <= 360)) {\n              if (latestCurPoint.y >= symmetricPoint.y) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.y <= symmetricPoint.y) {\n              isReverse = true\n            }\n          }\n          if (point === POINT_TYPE.B) {\n            if (angle >= 90 && angle <= 270) {\n              if (latestCurPoint.y >= symmetricPoint.y) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.y <= symmetricPoint.y) {\n              isReverse = true\n            }\n          }\n  \n          if (newHeight / scale > MIN_SIZE.height && !isReverse) {\n            layer.height = newHeight / scale\n            layer.position.y = (newCenter.y - (newHeight / 2)) / scale\n            layer.position.x = newCenter.x / scale - (layer.width / 2)\n          }\n          break\n        }\n  \n        case POINT_TYPE.L:\n        case POINT_TYPE.R: {\n          const newOriginCurPoint = calcRotatedCoords(curPoint, pointCenter, -info.rotate)\n  \n          const latestCurPoint = calcRotatedCoords({\n            x: newOriginCurPoint.x,\n            y: pointCenter.y\n          }, pointCenter, info.rotate)\n  \n          const newWidth = Math.sqrt((latestCurPoint.x - symmetricPoint.x) ** 2 + (latestCurPoint.y - symmetricPoint.y) ** 2)\n  \n          const newCenter = {\n            x: latestCurPoint.x - (latestCurPoint.x - symmetricPoint.x) / 2,\n            y: latestCurPoint.y + (symmetricPoint.y - latestCurPoint.y) / 2\n          }\n  \n          // 是否反向拉伸了\n          let isReverse = false\n          const angle = (info.rotate + 360) % 360\n          // 禁止反向拉伸\n          if (point === POINT_TYPE.L) {\n            if ((angle >= 0 && angle <= 90) || (angle >= 270 && angle <= 360)) {\n              if (latestCurPoint.x >= symmetricPoint.x) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.x <= symmetricPoint.x) {\n              isReverse = true\n            }\n          }\n          if (point === POINT_TYPE.R) {\n            if (angle >= 90 && angle <= 270) {\n              if (latestCurPoint.x >= symmetricPoint.x) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.x <= symmetricPoint.x) {\n              isReverse = true\n            }\n          }\n  \n          if (newWidth / scale > MIN_SIZE.width && !isReverse) {\n            layer.width = newWidth / scale\n            layer.position.y = newCenter.y / scale - (layer.height / 2)\n            layer.position.x = (newCenter.x - (newWidth / 2)) / scale\n          }\n          break\n        }\n      }\n\n      if (layer.type === 'text') {\n        if (layer.height !== oldHeight && layer.scale) {\n          layer.scale *= layer.height / oldHeight\n        }\n      }\n\n      setLayer(layer)\n      setIsMoving(true)\n    }, () => {\n      setIsMoving(false)\n    })\n  }\n\n  // 调整大小\n  const resize = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    e.stopPropagation()\n    if (info.rotate === 0) {\n      resizeNormal(e, point)\n    } else {\n      resizeWithRotate(e, point)\n    }\n  }\n\n  // 旋转\n  const rotate = (e: MouseEvent<HTMLElement>) => {\n    e.stopPropagation()\n    const borderEl = (e.target as HTMLElement).closest('.border-control')\n    if (borderEl) {\n      const rect = borderEl.getBoundingClientRect()\n      const rotateCenterPoint = {\n        x: rect.left + rect.width / 2,\n        y: rect.top + rect.height / 2\n      }\n      new MouseEvents(e, ({ curCoords }: { curCoords: Coords }) => {\n        const offsetY = curCoords.y - rotateCenterPoint.y\n        const offsetX = curCoords.x - rotateCenterPoint.x\n        // 当前距离x轴的角度(x轴起逆时针方向至该边)\n        const angle = Math.atan2(offsetY, offsetX) * 180 / Math.PI\n\n        const idx = layers.findIndex(layer => layer.id === info.id)\n        const layer = cloneDeep(layers[idx])\n        layer.rotate = (angle - 90 + 360) % 360\n\n        setLayer(layer)\n        setIsMoving(true)\n      }, () => {\n        setIsMoving(false)\n      })\n    }\n  }\n\n  // 计算8个圆点的指针样式，按顺序分别为 左上（右下）、上（下）、右上（左下）、右（左）\n  const calcCursors = useCallback(() => {\n    let angle = info.rotate\n    if (angle < 0) {\n      angle += 360\n    }\n    const cursors: string[] = []\n    INIT_ANGLE.forEach((a) => {\n      const newAngle = (a + angle) % 360\n      const item = ANGLE_TO_CURSOR.find(i => i.start <= newAngle && i.end >= newAngle)\n      if (item) {\n        cursors.push(item.cursor)\n      }\n    })\n    setCursors(cursors)\n  }, [info.rotate])\n\n  useEffect(() => {\n    calcCursors()\n  }, [calcCursors])\n\n  return <BorderEl \n    style={{\n      width: info.width * scale,\n      height: info.height * scale,\n      transform: `translate(${info.position.x * scale}px, ${info.position.y * scale}px) rotate(${info.rotate}deg)`\n    }}\n    className={['border-control', isMoving ? 'moving' : ''].join(' ')}\n  >\n    {info.isLocked ?\n      <LockIcon icon={lockIcon} rotate={info.rotate} /> :\n      <>\n        <PointBR style={{ cursor: cursors[0] }} onMouseDown={e => resize(e, POINT_TYPE.BR)} />\n        {info.width * scale > 30 && info.height * scale > 30 && <>\n            <PointTL style={{ cursor: cursors[0] }} onMouseDown={e => resize(e, POINT_TYPE.TL)} />\n            <PointTR style={{ cursor: cursors[2] }} onMouseDown={e => resize(e, POINT_TYPE.TR)} />\n            <PointBL style={{ cursor: cursors[2] }} onMouseDown={e => resize(e, POINT_TYPE.BL)} />\n            <PointL style={{ cursor: cursors[3] }} onMouseDown={e => resize(e, POINT_TYPE.L)} />\n            <PointR style={{ cursor: cursors[3] }} onMouseDown={e => resize(e, POINT_TYPE.R)} />\n            { info.type !== 'text' && <PointT style={{ cursor: cursors[1] }} onMouseDown={e => resize(e, POINT_TYPE.T)} /> }\n            { info.type !== 'text' && <PointB style={{ cursor: cursors[1] }} onMouseDown={e => resize(e, POINT_TYPE.B)} /> }\n          </>\n        }\n        <RotateIcon className='rotate-point' icon={rotateIcon} onMouseDown={rotate} />\n      </>\n    }\n  </BorderEl>\n})\n\nconst BorderEl = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n\n  &.moving .rotate-point {\n    opacity: 0;\n  }\n\n  &.moving span {\n    opacity: 0;\n  }\n\n  &:after {\n    content: '';\n    position: absolute;\n    top: -1px;\n    left: -1px;\n    right: -1px;\n    bottom: -1px;\n    border: 2px solid #00c4cc;\n  }\n`\n\nconst Point = styled.span`\n  position: absolute;\n  display: block;\n  background: transparent;\n  z-index: 1;\n  pointer-events: auto;\n  width: 18px;\n  height: 18px;\n  user-select: none;\n  transition: opacity 200ms;\n\n  ::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    border-radius: 6px;\n    background: #fff;\n    box-shadow: 0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(53 71 90 / 20%);\n  }\n`\n\nconst PointTL = styled(Point)`\n  top: -9px;\n  left: -9px;\n  cursor: nwse-resize;\n`\n\nconst PointTR = styled(Point)`\n  top: -9px;\n  right: -9px;\n  cursor: nesw-resize;\n`\n\nconst PointBL = styled(Point)`\n  bottom: -9px;\n  left: -9px;\n  cursor: nesw-resize;\n`\n\nconst PointBR = styled(Point)`\n  bottom: -9px;\n  right: -9px;\n  cursor: nwse-resize;\n`\n\nconst PointT = styled(Point)`\n  width: calc(100% - 24px);\n  height: 12px;\n  top: -6px;\n  left: 12px;\n  cursor: ns-resize;\n\n  ::before {\n    width: 16px;\n    height: 4px;\n  }\n`\n\nconst PointB = styled(Point)`\n  width: calc(100% - 24px);\n  height: 12px;\n  bottom: -6px;\n  left: 12px;\n  cursor: ns-resize;\n\n  ::before {\n    width: 16px;\n    height: 4px;\n  }\n`\n\nconst PointL = styled(Point)`\n  width: 12px;\n  height: calc(100% - 24px);\n  top: 12px;\n  left: -6px;\n  cursor: ew-resize;\n\n  ::before {\n    width: 4px;\n    height: 16px;\n  }\n`\n\nconst PointR = styled(Point)`\n  width: 12px;\n  height: calc(100% - 24px);\n  top: 12px;\n  right: -6px;\n  cursor: ew-resize;\n\n  ::before {\n    width: 4px;\n    height: 16px;\n  }\n`\n\nconst RotateIcon = styled.div<{icon: string}>(\n  {\n    position: 'absolute',\n    left: '50%',\n    bottom: '-50px',\n    width: '20px',\n    height: '20px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    transform: 'translate(-50%, -50%)',\n    pointerEvents: 'auto',\n    borderRadius: '50%',\n    boxShadow: '0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(57 76 96 / 15%)',\n    userSelect: 'none',\n    cursor: 'grab'\n  },\n  props => ({\n    background: `#fff url(${props.icon}) no-repeat center / 18px 18px`\n  })\n)\n\nconst LockIcon = styled.div<{icon: string; rotate: number}>(\n  {\n    position: 'absolute',\n    right: '0',\n    bottom: '0',\n    width: '20px',\n    height: '20px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    pointerEvents: 'auto',\n    borderRadius: '50%',\n    boxShadow: '0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(57 76 96 / 15%)',\n    userSelect: 'none',\n    zIndex: '1'\n  },\n  props => ({\n    background: `#fff url(${props.icon}) no-repeat center / 13px 13px`,\n    transform: `translate(50%, 50%) rotate(${-props.rotate}deg)`\n  })\n)","export default __webpack_public_path__ + \"static/media/lock.7263c59f.svg\";","import { useContext } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { Layer } from 'types';\nimport { ScaleContext } from 'store/context';\n\nexport default function HoverBorder ({ info }: { info: Layer; }) {\n  const scale = useContext(ScaleContext)\n\n  return <BorderEl \n    style={{\n      width: info.width * scale,\n      height: info.height * scale,\n      transform: `translate(${info.position.x * scale}px, ${info.position.y * scale}px) rotate(${info.rotate}deg)`\n    }}\n  />\n}\n\nconst BorderEl = styled.div`\nposition: absolute;\ntop: 0;\nleft: 0;\npointer-events: none;\n\n&:after {\n  content: '';\n  position: absolute;\n  top: -1px;\n  left: -1px;\n  right: -1px;\n  bottom: -1px;\n  border: 2px solid #00c4cc;\n}\n`","import { MouseEvent as MouseEventType, useContext } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport styled from \"@emotion/styled\";\nimport { Layer as LayerType } from 'types';\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport { MouseEvents } from 'utils/mouseEvent';\nimport { helpLine } from 'utils/helpLine'\nimport Border from \"./Border\";\nimport HoverBorder from \"./HoverBorder\";\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { cloneDeep } from \"lodash\";\n\n// 图层\nexport default observer(({ children, info }: { children: JSX.Element, info: LayerType }) => {\n  const scale = useContext(ScaleContext)\n  const { template, layers, setLayer, selectLayer, hoverLayer, isMoving, setIsMoving } = templateStore\n\n  // 设置背景选中状态\n  const { setIsSelectedBackground } = useContext(BackgroundContext)\n\n  // 辅助线\n  const { getRect: helpLineRect, init: initHelpLine, move: helpLinePipe } = helpLine()\n\n  // 更新图层位置\n  const updatePosition = ({ diff }: { diff: { x: number; y: number; } }) => {\n    const layer = cloneDeep(info)\n\n    const newPosition = helpLinePipe({\n      x: helpLineRect().x + diff.x / scale,\n      y: helpLineRect().y + diff.y / scale\n    })\n\n    layer.position = newPosition\n\n    setLayer(layer)\n    setIsMoving(true)\n  }\n\n  // 隐藏辅助线\n  const hideLine = () => {\n    const vLineEl = document.querySelector('#verticalLine') as HTMLElement\n    vLineEl.style.visibility = 'hidden'\n    const hLineEl = document.querySelector('#horizontalLine') as HTMLElement\n    hLineEl.style.visibility = 'hidden'\n    setIsMoving(false)\n  }\n\n  // 选中图层\n  const onSelectLayer = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    if (info.isEditing) return\n    selectLayer(info.id)\n    setIsSelectedBackground(false)\n    // 锁定了就不给拖动\n    if (info.isLocked) return\n    // 初始化拖拽事件\n    new MouseEvents(e, updatePosition, hideLine)\n    // 初始化辅助线数据\n    initHelpLine({\n      ...info.position,\n      width: info.width,\n      height: info.height,\n      rotate: info.rotate\n    }, info.id, layers, scale, { ...template.global })\n  }\n\n  // 鼠标移入图层\n  const onLayerMouseEnter = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    hoverLayer(info.id)\n  }\n\n  // 鼠标移出图层\n  const onLayerMouseOut = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    hoverLayer()\n  }\n\n  return <LayerWrapper\n    style={{\n      width: info.width,\n      height: info.height,\n      transform: `translate(${info.position.x}px, ${info.position.y}px) rotate(${info.rotate}deg)`,\n      opacity: info.opacity,\n      zIndex: info.zIndex\n    }}\n    onMouseDown={onSelectLayer}\n    onMouseEnter={onLayerMouseEnter}\n    onMouseOut={onLayerMouseOut}\n    className={[isMoving ? 'moving' : '', info.isEditing ? 'edit' : ''].join(' ')}\n  >\n    {/* 图层内容 */}\n    <LayerContent style={{transform: `scale(${info.reverse?.x || 1}, ${info.reverse?.y || 1})`}}>\n      { children }\n    </LayerContent>\n    {/* 拖拽边框 */}\n    {info.isSelected && <TransportBorder>\n      <Border info={info} />\n    </TransportBorder>}\n    {/* 鼠标移入边框 */}\n    {!info.isSelected && !isMoving && info.isHover && <TransportBorder>\n      <HoverBorder info={info} />\n    </TransportBorder>}\n  </LayerWrapper>\n})\n\n// 传送门\nfunction TransportBorder ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#layerControl') as HTMLDivElement\n  )\n}\n\nconst LayerWrapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: auto;\n  user-select: none;\n  cursor: default;\n\n  &.moving {\n    cursor: all-scroll;\n  }\n\n  &.edit {\n    cursor: text;\n  }\n`\n\nconst LayerContent = styled.div`\n  width: 100%;\n  height: 100%;\n  transition: transform 250ms;\n`","import { Layer } from 'types';\n\ninterface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  rotate: number;\n}\n\ninterface RealRect extends Omit<Rect, 'rotate'> {}\n\ninterface Size {\n  width: number;\n  height: number;\n}\n\ninterface Coord {\n  x: number;\n  y: number;\n}\n\nexport function helpLine () {\n  // 当前图层位置信息\n  let rect: Rect = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n    rotate: 0\n  }\n\n  // 当前图层实际DOM的位置信息\n  let realRect: RealRect = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n  }\n\n  // 当前图层ID\n  let layerId = ''\n  // 所有的图层数据\n  let allLayers: Layer[] = []\n  // 缩放值\n  let scale = 1\n  // 画布尺寸\n  let canvasSize: Size = {\n    width: 0,\n    height: 0\n  }\n  // 吸附距离\n  let diff = 4\n\n  const vLineEl = document.querySelector('#verticalLine') as HTMLElement\n  const hLineEl = document.querySelector('#horizontalLine') as HTMLElement\n  let vType: 0 | 1 | 2 = 0 // 垂直线位置-0左1中2右\n  let hType: 0 | 1 | 2 = 0 // 水平线位置-0上1中2下\n\n  // 初始化数据\n  const init = (data: Rect, id: string, layers: Layer[], scl: number, size: Size) => {\n    rect = data\n    layerId = id\n    allLayers = layers\n    scale = scl\n    diff = 4 / scale\n    canvasSize = size\n\n    // 获取旋转后的真实元素位置信息\n    const rad = rect.rotate * Math.PI / 180\n    const newWidth = Math.abs(rect.width * Math.cos(rad)) + Math.abs(rect.height * Math.sin(rad))\n    const newHeight = Math.abs(rect.height * Math.cos(rad)) + Math.abs(rect.width * Math.sin(rad))\n    realRect.width = newWidth\n    realRect.height = newHeight\n    realRect.x = rect.x + (rect.width - newWidth) / 2\n    realRect.y = rect.y - (newHeight - rect.height) / 2\n  }\n\n  // 移动吸附\n  const move = ({ x, y }: Coord): Coord => {\n    rect.x = x\n    rect.y = y\n\n    const res: Coord = {\n      x: rect.x,\n      y: rect.y\n    }\n\n    // 更新真实元素位置信息\n    realRect.x = rect.x + (rect.width - realRect.width) / 2\n    realRect.y = rect.y - (realRect.height - rect.height) / 2\n\n    // 遍历所有图层，与当前图层两两对比\n    allLayers.forEach(l => {\n      // 获取其他图层真实的元素定位\n      const rad = l.rotate * Math.PI / 180\n      const newWidth = Math.abs(l.width * Math.cos(rad)) + Math.abs(l.height * Math.sin(rad))\n      const newHeight = Math.abs(l.height * Math.cos(rad)) + Math.abs(l.width * Math.sin(rad))\n      const newX = l.position.x + (l.width - newWidth) / 2\n      const newY = l.position.y - (newHeight - l.height) / 2\n\n      if (l.id !== layerId) {\n        // x 垂直线\n        vLineHandle(newX + newWidth, res) // 对象图层右\n        vLineHandle(newX + newWidth / 2, res) // 对象图层中\n        vLineHandle(newX, res) // 对象图层左\n\n        // y 水平线\n        hLineHandle(newY + newHeight, res) // 对象图层下\n        hLineHandle(newY + newHeight / 2, res) // 对象图层中\n        hLineHandle(newY, res) // 对象图层上\n      }\n    })\n\n    // 与画布对齐\n    // x 垂直线\n    vLineHandle(canvasSize.width, res) // 画布右\n    vLineHandle(canvasSize.width / 2, res) // 画布中\n    vLineHandle(0, res) // 画布左\n    // y 水平线\n    hLineHandle(canvasSize.height, res) // 画布下\n    hLineHandle(canvasSize.height / 2, res) // 画布中\n    hLineHandle(0, res) // 画布上\n\n    // 渲染辅助线DOM\n    renderLine(res)\n\n    return res\n  }\n\n  // 垂直线\n  const vLineHandle = (targetX: number, res: Coord) => {\n    // 右\n    if (Math.abs(targetX - (realRect.x + realRect.width)) <= diff) {\n      res.x = targetX - rect.width \n      res.x += (rect.width - realRect.width) / 2\n      vType = 2\n    }\n    // 中\n    if (Math.abs(targetX - (realRect.x + realRect.width / 2)) <= diff) {\n      res.x = targetX - rect.width / 2\n      vType = 1\n    }\n    // 左\n    if (Math.abs(targetX - realRect.x) <= diff) {\n      res.x = targetX\n      res.x -= (rect.width - realRect.width) / 2\n      vType = 0\n    }\n  }\n\n  // 水平线\n  const hLineHandle = (targetY: number, res: Coord) => {\n    // 下\n    if (Math.abs(targetY - (realRect.y + realRect.height)) <= diff) {\n      res.y = targetY - rect.height\n      res.y -= (realRect.height - rect.height) / 2\n      hType = 2\n    }\n    // 中\n    if (Math.abs(targetY - (realRect.y + realRect.height / 2)) <= diff) {\n      res.y = targetY - rect.height / 2\n      hType = 1\n    }\n    // 上\n    if (Math.abs(targetY - realRect.y) <= diff) {\n      res.y = targetY\n      res.y += (realRect.height - rect.height) / 2\n      hType = 0\n    }\n  }\n\n  // 渲染辅助线DOM\n  const renderLine = (res: Coord) => {\n    if (vLineEl && hLineEl) {\n      // TODO: 当前位置刚好在线上，条件不满足\n      if (res.x !== rect.x) {\n        let vLine = 0\n        if (vType === 0) vLine = res.x + (rect.width - realRect.width) / 2\n        if (vType === 1) vLine = res.x + rect.width / 2\n        if (vType === 2) vLine = res.x + (rect.width - realRect.width) / 2 + realRect.width\n        vLineEl.style.transform = `translateX(${vLine * scale}px)`\n        vLineEl.style.visibility = 'visible'\n      } else {\n        vLineEl.style.visibility = 'hidden'\n      }\n      if (res.y !== rect.y) {\n        let hLine = 0\n        if (hType === 0) hLine = res.y - (realRect.height - rect.height) / 2\n        if (hType === 1) hLine = res.y + rect.height / 2\n        if (hType === 2) hLine = res.y - (realRect.height - rect.height) / 2 + realRect.height\n        hLineEl.style.transform = `translateY(${hLine * scale}px)`\n        hLineEl.style.visibility = 'visible'\n      } else {\n        hLineEl.style.visibility = 'hidden'\n      }\n    }\n  }\n\n  const getRect = () => {\n    return rect\n  }\n\n  return {\n    getRect,\n    init,\n    move\n  }\n}","import 'quill/dist/quill.core.css';\nimport 'quill/dist/quill.snow.css';\nimport Quill from 'quill';\nimport { observer } from 'mobx-react';\nimport styled from \"@emotion/styled\";\nimport { FontStyle } from 'types';\nimport { Layer } from 'types';\nimport { useCallback, useEffect, useRef, useState, useContext } from 'react';\nimport { templateStore } from 'store/template';\nimport { cloneDeep } from 'lodash';\nimport { ScaleContext } from 'store/context';\n\nexport default observer(({ layer }: { layer: Layer }) => {\n  const editorRef = useRef<HTMLDivElement>(null)\n\n  const { editTextLayer, setLayer, needUpdateLayerHeight, setNeedUpdateLayerHeight, isMoving } = templateStore\n  const scale = useContext(ScaleContext)\n\n  // quill实例\n  let [editor, setEditor] = useState<Quill | null>(null)\n\n  // 画布的DOM信息\n  const canvasRect = (document.querySelector('#textControl') as HTMLElement)?.getBoundingClientRect()\n\n  // 文本内容变化\n  const onTextChange = useCallback(() => {\n    if (editor) {\n      const _layer = cloneDeep(layer)\n      const text = editor.getText()\n      _layer.source.content = text\n\n      if (editorRef.current) {\n        // 文本换行了，更新图层最新高度和位置\n        const rect = editorRef.current.getBoundingClientRect()\n        const rad = (layer.rotate % 180) * Math.PI / 180\n        const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n        // 高度不一致表示换行/减行\n        if (newHeight / scale !== layer.height) {\n          _layer.height = newHeight / scale\n\n          const center = {\n            x: rect.left + rect.width / 2 - canvasRect.left,\n            y: rect.top + rect.height / 2 - canvasRect.top\n          }\n          const newX = center.x / scale - (layer.width / 2)\n          const newY = (center.y - (newHeight / 2)) / scale\n\n          _layer.position = {\n            x: newX,\n            y: newY\n          }\n        }\n      }\n      setLayer(_layer)\n    }\n  }, [editor, layer, setLayer, scale, canvasRect])\n\n  // 字体大小改变了，高度也要更新\n  useEffect(() => {\n    if (needUpdateLayerHeight && editorRef.current) {\n      const _layer = cloneDeep(layer)\n      const rect = editorRef.current.getBoundingClientRect()\n      const rad = (layer.rotate % 180) * Math.PI / 180\n      const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n      // 高度不一致表示换行/减行\n      if (newHeight / scale !== layer.height) {\n        _layer.height = newHeight / scale\n\n        const center = {\n          x: rect.left + rect.width / 2 - canvasRect.left,\n          y: rect.top + rect.height / 2 - canvasRect.top\n        }\n        const newX = center.x / scale - (layer.width / 2)\n        const newY = (center.y - (newHeight / 2)) / scale\n\n        _layer.position = {\n          x: newX,\n          y: newY\n        }\n        setLayer(_layer)\n      }\n      setNeedUpdateLayerHeight(false)\n    }\n  }, [canvasRect, layer, needUpdateLayerHeight, scale, setLayer, setNeedUpdateLayerHeight])\n\n  // 拖拽改变文本框宽度时，更新图层最新高度\n  // TODO: 位置会偏移\n  useEffect(() => {\n    // isMoving表示拖拽\n    if (isMoving && editorRef.current) {\n      const rect = editorRef.current.getBoundingClientRect()\n      const rad = (layer.rotate % 180) * Math.PI / 180\n      const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n      // 高度不一致表示换行/减行\n      if (Math.abs(newHeight / scale - layer.height) > 1) {\n        const _layer = cloneDeep(layer)\n        _layer.height = newHeight / scale\n        setLayer(_layer)\n      }\n    }\n  }, [layer, scale, isMoving, canvasRect, setLayer])\n\n  // 进入编辑状态\n  const onEditText = () => {\n    editTextLayer(layer.id)\n  }\n\n  // 初始化quill实例\n  useEffect(() => {\n    if (editorRef.current && !editor) {\n      const instance = new Quill(editorRef.current)\n      setEditor(instance)\n    }\n  }, [editor])\n\n  // 设置文本内容\n  useEffect(() => {\n    if (editor && layer.source.content && editor.getText() !== layer.source.content) {\n      editor.setText(layer.source.content)\n    }\n  }, [editor, layer.source.content])\n\n  // 设置编辑状态\n  useEffect(() => {\n    if (editor) {\n      editor.enable(layer.isEditing)\n      layer.isEditing && editor.setSelection(0, 1000)\n    }\n  }, [editor, layer.isEditing])\n\n  useEffect(() => {\n    if (editor) {\n      editor.on('text-change', onTextChange)\n    }\n    return () => {\n      editor?.off('text-change', onTextChange)\n    }\n  }, [editor, onTextChange])\n\n  return <TextWrapper\n    style={{\n      transform: `scale(${layer.scale})`,\n      width: `${layer.width / (layer.scale || 1)}px`,\n      height: `${layer.height / (layer.scale || 1)}px`\n    }}\n  >\n    <Text\n      data={layer.style as FontStyle}\n      onDoubleClick={onEditText}\n    >\n      <Editor ref={editorRef} spellCheck=\"false\" />\n    </Text>\n  </TextWrapper>\n})\n\nconst TextWrapper = styled.div`\n  transform-origin: 0 0;\n`\n\nconst Text = styled.div<{data: FontStyle}>(\n  {},\n  props => ({\n    fontFamily: `\"${props.data.font}\"`,\n    fontSize: props.data.fontSize,\n    color: props.data.color,\n    lineHeight: props.data.lineHeight,\n    textAlign: props.data.textAlign,\n    fontWeight: props.data.fontWeight,\n    textDecorationLine: props.data.underline ? 'underline' : 'none'\n  })\n)\n\nconst Editor = styled.div`\n  font-family: inherit;\n  font-size: inherit;\n\n  .ql-editor {\n    padding: 0;\n    overflow: visible;\n    font-family: inherit;\n    line-height: inherit;\n    text-align: inherit;\n    white-space: break-spaces;\n    /* user-select: text; */\n    line-break: anywhere;\n\n    &>* {\n      cursor: inherit;\n    }\n  }\n`","import React, { useContext, MouseEvent, DragEvent } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport Layer from './layer/Layer';\nimport { LAYER_TYPE, Layer as LayerType } from 'types'\nimport { ImageItem } from \"types/image\";\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport TextEditor from './layer/TextEditor';\nimport { createPortal } from \"react-dom\";\n\ninterface Props {\n  width: number;\n  height: number;\n  scale: number;\n}\n\n// 拖拽图片时鼠标的位置\nconst dragCursorPosition = {\n  x: 0,\n  y: 0\n}\n\n// 画布\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus, setLayerType } = templateStore\n  const { global, background } = template\n\n  const scale = useContext(ScaleContext)\n  const {isSelectedBackground, setIsSelectedBackground} = useContext<{\n    isSelectedBackground: boolean;\n    setIsSelectedBackground: React.Dispatch<React.SetStateAction<boolean>>\n  }>(BackgroundContext)\n\n  // 选中背景\n  const selectBackground = (e: MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation()\n    setIsSelectedBackground(true)\n    resetSelectStatus()\n    setLayerType(LAYER_TYPE.BACKGROUND)\n  }\n\n  // 图片拖拽释放\n  const onDropCapture = (e: DragEvent<HTMLDivElement>) => {\n    e.preventDefault()\n    const onUseImage = (width: number, height: number, url: string) => {\n      const canvasRect = (document.querySelector('#layerControl') as HTMLElement)?.getBoundingClientRect()\n      const x = dragCursorPosition.x - canvasRect.left\n      const y = dragCursorPosition.y - canvasRect.top\n      const newLayer: LayerType = {\n        id: String(Date.now()),\n        type: 'image',\n        width: width,\n        height: height,\n        position: {\n          x: x / scale - width / 2,\n          y: y / scale - height / 2\n        },\n        rotate: 0,\n        reverse: {\n          x: 1,\n          y: 1\n        },\n        source: {\n          imageUrl: url\n        },\n        opacity: 1,\n        zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n        isSelected: true,\n        isEditing: false,\n        isLocked: false,\n        scale: 1\n      }\n      resetSelectStatus()\n      addLayer(newLayer)\n    }\n\n    // 本地图片拖拽\n    if (e.dataTransfer.files.length > 0) {\n      const files = e.dataTransfer.files\n      if (!/image\\//.test(files[0].type)) return\n      const reader = new FileReader()\n      reader.readAsDataURL(files[0])\n      reader.onload = el => {\n        const url = el.target?.result\n        if (typeof url === 'string') {\n          const img = new Image()\n          img.src = url\n          img.onload = () => {\n            onUseImage(img.width, img.height, url)\n          }\n        }\n      }\n    } else { // 侧边栏图片\n      let image: ImageItem | null = null\n      try {\n        image = JSON.parse(e.dataTransfer?.getData('image'))\n      } catch (e) {}\n      // 使用图片\n      if (image) {\n        onUseImage(image.webformatWidth, image.webformatHeight, image.webformatURL)\n      }\n    }\n  }\n\n  const onDragOver = (e: DragEvent<HTMLDivElement>) => {\n    e.preventDefault()\n    dragCursorPosition.x = e.pageX\n    dragCursorPosition.y = e.pageY\n  }\n\n  return <Wrapper width={global.width} height={global.height} scale={scale}>\n    <CanvasContent\n      id=\"canvasContent\"\n      style={{ width: global.width, height: global.height, transform: `scale(${scale})` }}\n      onDrop={onDropCapture} onDragOver={onDragOver}>\n      <Background color={background.color} onClick={selectBackground} />\n      {\n        template.layers.map(layer => {\n          // 图片\n          if (layer.type === 'image') {\n            return <Layer key={layer.id} info={layer}>\n              <Img src={toJS(layer.source.imageUrl)} draggable=\"false\" />\n            </Layer>\n          }\n          // 文字\n          if (layer.type === 'text') {\n            return layer.isEditing ?\n            <TransportEditor key={layer.id}>\n              <Layer info={layer}>\n                <TextEditor layer={toJS(layer)} />\n              </Layer>\n            </TransportEditor>\n            :\n            <Layer key={layer.id} info={layer}>\n              <TextEditor layer={toJS(layer)} />\n            </Layer>\n          }\n          return <></>\n        })\n      }\n    </CanvasContent>\n    {/* 编辑框传送点 */}\n    <LayerControl id=\"layerControl\" width={global.width} height={global.height} scale={scale}>\n        {isSelectedBackground && <BackgroundBorder />}\n        {/* 垂直辅助线 */}\n        <VLine id=\"verticalLine\" />\n        {/* 水平辅助线 */}\n        <HLine id=\"horizontalLine\" />\n    </LayerControl>\n    {/* 点前编辑的文本传送点 */}\n    <TextControl id=\"textControl\" style={{ width: global.width, height: global.height, transform: `scale(${scale})` }} />\n  </Wrapper>\n})\n\n// 传送门\nfunction TransportEditor ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#textControl') as HTMLDivElement\n  )\n}\n\nconst Img = styled.img`\n  width: 100%;\n  height: 100%;\n`\n\nconst Background = styled.div<{ color: string; }>(\n  {\n    position: 'relative',\n    zIndex: -1,\n    width: '100%',\n    height: '100%'\n  },\n  props => ({\n    backgroundColor: props.color\n  })\n)\n\nconst Wrapper = styled.div<Props>(\n  {\n    flex: 'none',\n    position: 'relative',\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    margin: 'auto',\n    pointerEvents: 'none'\n  },\n  props => ({\n    width: props.width * props.scale + 100,\n    height: props.height * props.scale + 100\n  })\n)\n\nconst CanvasContent = styled.div`\n  flex: none;\n  position: relative;\n  overflow: hidden;\n  background-color: #fff;\n  user-select: none;\n  pointer-events: auto;\n`\n\nconst TextControl = styled(CanvasContent)`\n  position: absolute;\n  top: 50;\n  left: 50;\n  z-index: 1;\n  pointer-events: none;\n  overflow: visible;\n  background-color: transparent;\n`\n\nconst LayerControl = styled.div<Props>(\n  {\n    position: 'absolute',\n    top: 50,\n    left: 50,\n    zIndex: 2,\n    pointerEvents: 'none'\n  },\n  props => ({\n    width: props.width * props.scale,\n    height: props.height * props.scale\n  })\n)\n\nconst BackgroundBorder = styled.div`\n  position: absolute;\n  top: -1px;\n  left: -1px;\n  right: -1px;\n  bottom: -1px;\n  border: 2px solid #00c4cc;\n  background: transparent;\n  pointer-events: none;\n`\n\nconst VLine = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 0;\n  height: 100%;\n  border-left: 1px dashed #c228ff;\n  visibility: hidden;\n  z-index: 2;\n`\n\nconst HLine = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 0;\n  border-top: 1px dashed #c228ff;\n  visibility: hidden;\n  z-index: 2;\n`","export default __webpack_public_path__ + \"static/media/opacity.6dad8d31.svg\";","\n// 预设字体列表\nexport const FONT_LIST: Array<{\n  name: string;\n  value: string\n}> = [\n  {\n    name: '宋体',\n    value: 'SimSun'\n  },\n  {\n    name: '黑体',\n    value: 'SimHei'\n  },\n  {\n    name: '微软雅黑',\n    value: 'Microsoft Yahei'\n  },\n  {\n    name: '楷体',\n    value: 'KaiTi'\n  },\n  {\n    name: '华文楷体',\n    value: 'STKaiti'\n  },\n  {\n    name: '翩翩体-简',\n    value: 'Hanzipen SC'\n  },\n  {\n    name: '娃娃体-简',\n    value: 'Wawati SC'\n  },\n  {\n    name: '圆体-简',\n    value: 'Yuanti SC'\n  },\n  {\n    name: '兰亭黑-简',\n    value: 'Lantinghei SC'\n  }\n]\n\n// 字体大小\nexport const FONTSIZE_LIST = [6,8,10,12,14,16,18,20,22,24,28,32,36,42,48,56,64,72,80,88,96,104,120,144]\n\nexport const CANVAS_SIZE_LIST = [\n  {\n    width: 1280,\n    height: 720,\n    label: '1280px × 720px',\n    value: '1'\n  },\n  {\n    width: 720,\n    height: 1280,\n    label: '720px × 1280px',\n    value: '2'\n  },\n  {\n    width: 1024,\n    height: 768,\n    label: '1024px × 768px',\n    value: '3'\n  },\n  {\n    width: 768,\n    height: 1024,\n    label: '768px × 1024px',\n    value: '4'\n  },\n  {\n    width: 1920,\n    height: 1080,\n    label: '1920px × 1080px',\n    value: '5'\n  },\n]","import styled from \"@emotion/styled\";\nimport { observer } from 'mobx-react';\nimport { templateStore } from 'store/template'\nimport { LAYER_TYPE, Align } from 'types'\nimport {\n  Popover,\n  Select,\n  Dropdown,\n  Menu,\n  Slider,\n  Popconfirm,\n  Radio,\n  Space,\n  InputNumber,\n  RadioChangeEvent\n} from 'antd';\nimport {\n  DeleteOutlined,\n  AlignLeftOutlined,\n  AlignCenterOutlined,\n  AlignRightOutlined,\n  SwapOutlined,\n  BoldOutlined,\n  UnderlineOutlined,\n  LockOutlined,\n  UnlockOutlined\n} from '@ant-design/icons';\nimport opacityIcon from 'assets/opacity.svg'\nimport { ChromePicker, ColorResult } from 'react-color';\nimport { cloneDeep, isNumber } from \"lodash\";\nimport { FONT_LIST, FONTSIZE_LIST, CANVAS_SIZE_LIST } from 'utils/const'\nimport { useEffect, useState } from \"react\";\n\nconst { Option } = Select;\n\nexport default observer(() => {\n  const {\n    template,\n    layerType,\n    layers,\n    setCanvasSize,\n    setLayer,\n    setLayers,\n    setLayerLevel,\n    removeLayer,\n    setLayerLock,\n    setBackgroundColor,\n    setNeedUpdateLayerHeight\n  } = templateStore\n\n  const [selectValue, setSelectValue] = useState('1')\n\n  const activeLayer = layers.find(l => l.isSelected)\n  const layerScale = activeLayer?.scale || 1\n\n  // 当前颜色\n  let color = ''\n  if (layerType === LAYER_TYPE.TEXT) {\n    color = activeLayer?.style?.color || ''\n  } else if (layerType === LAYER_TYPE.BACKGROUND) {\n    color = template.background.color\n  }\n\n  // 当前字体\n  const font = activeLayer?.style?.font || ''\n  // 当前字体\n  const fontSize = activeLayer?.style?.fontSize || 0\n  // 文字水平对齐\n  const textAlign = activeLayer?.style?.textAlign || 'left'\n  // 当前字体粗细\n  const fontWeight = activeLayer?.style?.fontWeight || 400\n  // 当前字体是否有下划线\n  const hasUnderline = activeLayer?.style?.underline || false\n\n  // 透明度\n  const opacity = activeLayer?.opacity\n  \n  // 图层是否被锁定了\n  const isLocked = activeLayer?.isLocked || false\n  // 图层的层级关系\n  const levelInfo = {\n    min: 1,\n    max: 100,\n    current: 1\n  }\n  if (activeLayer) {\n    levelInfo.current = layers.findIndex(l => l.id === activeLayer.id) + 1\n    levelInfo.max = layers.length\n  }\n\n  const canvasWidth = template.global.width\n  const canvasHeight = template.global.height\n\n  useEffect(() => {\n    const res = CANVAS_SIZE_LIST.find(i => i.width === canvasWidth && i.height === canvasHeight && i.value !== selectValue)\n    if (res) {\n      setSelectValue(res.value)\n    } else if (selectValue !== '6') {\n      setSelectValue('6')\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // 选择颜色\n  const onColorChange = (clr: ColorResult) => {\n    const rgba = `rgba(${clr.rgb.r}, ${clr.rgb.g}, ${clr.rgb.b}, ${clr.rgb.a})`\n    // 文本\n    if (layerType === LAYER_TYPE.TEXT) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.type === 'text' && layer.style) {\n        layer.style.color = rgba\n        setLayer(layer)\n      }\n    }\n    // 背景\n    if (layerType === LAYER_TYPE.BACKGROUND) {\n      setBackgroundColor(rgba)\n    }\n  }\n\n  // 选择字体\n  const onFontChange = (val: string) => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.font = val\n      setLayer(layer)\n    }\n  }\n\n  // 改变字体大小\n  const onFontsizeChange = (val: string) => {\n    const size = Number(val)\n    if (!isNaN(size)) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.type === 'text' && layer.style) {\n        layer.style.fontSize = size / layerScale\n        setLayer(layer)\n        setNeedUpdateLayerHeight(true)\n      }\n    }\n  }\n\n  // 改变字体粗细\n  const onWeightChange = () => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.fontWeight = layer.style.fontWeight === 700 ? 400 : 700\n      setLayer(layer)\n    }\n  }\n\n  // 设置下划线\n  const onUnderlineChange = () => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.underline = !layer.style.underline\n      setLayer(layer)\n    }\n  }\n\n  // 改变文本水平对齐\n  const onTextAlignChange = () => {\n    let align: Align = 'left'\n    if (textAlign === 'left') align = 'center'\n    if (textAlign === 'center') align = 'right'\n    if (textAlign === 'right') align = 'left'\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.textAlign = align\n      setLayer(layer)\n    }\n  }\n\n  // 翻转图片\n  const onReverseImage = (direction: 'x' | 'y') => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.reverse) {\n      if (direction === 'x') {\n        layer.reverse.x = layer.reverse.x === 1 ? -1 : 1\n      }\n      if (direction === 'y') {\n        layer.reverse.y = layer.reverse.y === 1 ? -1 : 1\n      }\n      setLayer(layer)\n    }\n  }\n\n  // 改变层级\n  const onLevelChange = (val: number) => {\n    // 下 -> 上\n    if (val > levelInfo.current) {\n      layers.forEach((l, idx) => {\n        if (idx + 1 > levelInfo.current && idx + 1 <= val) {\n          setLayerLevel(l.id, l.zIndex - 1)\n        }\n      })\n      activeLayer && setLayerLevel(activeLayer.id, activeLayer.zIndex + (val - levelInfo.current))\n    } else { // 上 -> 下\n      layers.forEach((l, idx) => {\n        if (idx + 1 >= val && idx + 1 < levelInfo.current) {\n          setLayerLevel(l.id, l.zIndex + 1)\n        }\n      })\n      activeLayer && setLayerLevel(activeLayer.id, activeLayer.zIndex - (levelInfo.current - val))\n    }\n    setLayers(cloneDeep(layers).sort((a, b) => a.zIndex - b.zIndex))\n  }\n\n  const onOpacityChange = (val: number) => {\n    const layer = cloneDeep(activeLayer)\n    if (layer) {\n      layer.opacity = val\n      setLayer(layer)\n    }\n  }\n\n  // 切换图层锁定状态\n  const onToggleLayerLock = () => {\n    if (activeLayer) {\n      setLayerLock(activeLayer.id, !activeLayer.isLocked)\n    }\n  }\n\n  // 删除图层\n  const onRemove = () => {\n    const layer = layers.find(layer => layer.isSelected)\n    if (layer) {\n      removeLayer(layer.id)\n    }\n  }\n\n  // 清空画布\n  const onClear = () => {\n    setLayers([])\n  }\n\n  // 选择画布尺寸\n  const onCanvasSizeChange = (e: RadioChangeEvent) => {\n    setSelectValue(e.target.value)\n    const res = CANVAS_SIZE_LIST.find(i => i.value === e.target.value)\n    if (res) {\n      setCanvasSize({\n        width: res.width,\n        height: res.height\n      })\n    }\n  }\n\n  // 画布宽度修改\n  const onChangeWidth = (val: number) => {\n    if (isNumber(val) && val > 0) {\n      setCanvasSize({\n        width: val,\n        height: canvasHeight\n      })\n    }\n  }\n\n  // 画布高度修改\n  const onChangeHeight = (val: number) => {\n    if (isNumber(val) && val > 0) {\n      setCanvasSize({\n        width: canvasWidth,\n        height: val\n      })\n    }\n  }\n\n  // 画布尺寸列表\n  const CanvasSizeOptions = (\n    <>\n      <Radio.Group onChange={onCanvasSizeChange} value={selectValue}>\n        <Space direction=\"vertical\">\n          {CANVAS_SIZE_LIST.map(i => <Radio key={i.value} value={i.value}>{i.label}</Radio>)}\n          <Radio value={'6'}>\n            自定义\n            {selectValue === '6' ? <div style={{ marginTop: 10 }}>\n              <InputNumber value={canvasWidth} size=\"small\" placeholder=\"宽\" style={{ width: 100, marginRight: 10 }} onChange={onChangeWidth} />×\n              <InputNumber value={canvasHeight} size=\"small\" placeholder=\"高\" style={{ width: 100, marginLeft: 10, marginRight: 10 }} onChange={onChangeHeight} /> 像素\n            </div> : null}\n          </Radio>\n        </Space>\n      </Radio.Group>\n    </>\n  )\n\n  return <ToolBarWrapper>\n    <ItemGroup className={isLocked ? 'locked' : ''}>\n      {/* 画布尺寸 */}\n      {[LAYER_TYPE.EMPTY].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={CanvasSizeOptions}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <span className=\"text\">画布尺寸</span>\n          </Popover>\n        </ToolItem>\n      }\n      {/* 颜色 */}\n      {[LAYER_TYPE.BACKGROUND, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={<ChromePicker color={color} onChange={onColorChange} />}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <ColorItem style={{ backgroundColor: color }} />\n          </Popover>\n        </ToolItem>\n      }\n      {/* 字体 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Select\n            value={font}\n            style={{ width: 140 }}\n            placeholder=\"选择字体\"\n            onChange={onFontChange}\n          >\n            {FONT_LIST.map(f => <Option key={f.value} value={f.value}><span style={{ fontFamily: f.value }}>{f.name}</span></Option>)}\n          </Select>\n        </ToolItem>\n      }\n      {/* 字体大小 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Select\n            value={(fontSize * layerScale).toFixed(0)}\n            style={{ width: 100, textAlign: 'center' }}\n            placeholder=\"字体大小\"\n            onChange={onFontsizeChange}\n          >\n            {FONTSIZE_LIST.map(size => <Option key={size} value={size}>{size}</Option>)}\n          </Select>\n        </ToolItem>\n      }\n      {/* 加粗 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem className={fontWeight === 700 ? 'active' : ''} onClick={onWeightChange}>\n          <BoldOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 下划线 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem className={hasUnderline ? 'active' : ''} onClick={onUnderlineChange}>\n          <UnderlineOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 水平对齐 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem onClick={onTextAlignChange}>\n          {textAlign === 'left' && <AlignLeftOutlined style={{ fontSize: 24 }} />}\n          {textAlign === 'center' && <AlignCenterOutlined style={{ fontSize: 24 }} />}\n          {textAlign === 'right' && <AlignRightOutlined style={{ fontSize: 24 }} />}\n        </ToolItem>\n      }\n      {/* 图片翻转 */}\n      {[LAYER_TYPE.IMAGE].includes(layerType) &&\n        <ToolItem>\n          <Dropdown \n            overlay={\n              <Menu style={{ width: 120 }}>\n                <Menu.Item\n                  key=\"x\"\n                  style={{ padding: '10px' }}\n                  icon={<SwapOutlined />}\n                  onClick={() => onReverseImage('x')}\n                >\n                  水平翻转\n                </Menu.Item>\n                <Menu.Item\n                  key=\"y\"\n                  style={{ padding: '10px' }}\n                  icon={<SwapOutlined style={{ transform: 'rotate(90deg)' }} />}\n                  onClick={() => onReverseImage('y')}\n                >\n                  垂直翻转\n                </Menu.Item>\n              </Menu>\n            }\n            trigger={['click']}\n          >\n            <span className=\"text\">翻转</span>\n          </Dropdown>\n        </ToolItem>\n      }\n    </ItemGroup>\n    <ItemGroup className={isLocked ? 'locked' : ''}>\n      {/* 图层层级 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={\n              <Slider\n                value={levelInfo.current}\n                min={levelInfo.min}\n                max={levelInfo.max}\n                style={{ width: 180 }}\n                onChange={onLevelChange}\n              />\n            }\n            trigger=\"click\"\n            placement=\"bottomRight\"\n          >\n            <span className=\"text\">层级调整</span>\n          </Popover>\n        </ToolItem>\n      }\n      {/* 透明度 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={\n              <Slider\n                value={opacity}\n                min={0}\n                max={1}\n                step={0.01}\n                style={{ width: 180 }}\n                onChange={onOpacityChange}\n              />\n            }\n            trigger=\"click\"\n            placement=\"bottomRight\"\n          >\n            <img src={opacityIcon} width=\"24\" height=\"24\" alt=\"\" />\n          </Popover>\n        </ToolItem>\n      }\n      {/* 图层锁定 */}\n      {[LAYER_TYPE.TEXT, LAYER_TYPE.IMAGE].includes(layerType) &&\n        <ToolItem className={[\"item-lock\", isLocked ? 'active' : ''].join(' ')} onClick={onToggleLayerLock}>\n          {isLocked ? <LockOutlined style={{ fontSize: 24 }} /> : <UnlockOutlined style={{ fontSize: 24 }} />}\n        </ToolItem>\n      }\n      {/* 删除 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem onClick={onRemove}>\n          <DeleteOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 清空画布 */}\n      {[LAYER_TYPE.EMPTY].includes(layerType) &&\n        <ToolItem>\n          <Popconfirm\n            placement=\"bottomRight\"\n            title=\"确定清空画布？\"\n            onConfirm={onClear}\n            okText=\"清空\"\n            cancelText=\"取消\"\n          >\n            <span className=\"text\">清空画布</span>\n          </Popconfirm>\n        </ToolItem>\n      }\n    </ItemGroup>\n  </ToolBarWrapper>\n})\n\nconst ToolBarWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  height: 46px;\n  padding: 0 10px;\n  background-color: #fff;\n  border-bottom: 1px solid #ddd;\n  user-select: none;\n`\n\nconst ItemGroup = styled.div`\n  display: flex;\n  align-items: center;\n\n  &.locked>div:not(.item-lock) {\n    display: none;\n  }\n`\n\nconst ToolItem = styled.div`\n  display: flex;\n  align-items: center;\n  margin-right: 10px;\n  padding: 4px;\n  border-radius: 4px;\n  cursor: pointer;\n\n  &.active {\n    background-color: rgba(57,76,96,.15);\n  }\n\n  &:hover {\n    background-color: rgba(64,87,109,.07);\n  }\n\n  .text {\n    padding: 0 10px;\n    font-size: 16px;\n  }\n\n  input[type=\"search\"] {\n    text-align: center;\n  }\n`\n\nconst ColorItem = styled.div`\n  width: 28px;\n  height: 28px;\n  border: 2px solid #666;\n  border-radius: 4px;\n`","import React, { MouseEvent, useCallback, useEffect, useRef, useState } from \"react\";\nimport styled from \"@emotion/styled\";\nimport Footer from \"./Footer\";\nimport Canvas from \"./Canvas\";\nimport ToolBar from \"./tool-bar/Index\"\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { Layer } from 'types'\nimport { cloneDeep } from \"lodash\";\nimport undoRedo from 'utils/undoRedo';\n\nconst { undo, redo } = undoRedo()\n\n// 暂存复制的图层\nlet copyLayer: Partial<Layer> = {}\n\n// 编辑器\nexport default observer(() => {\n  // 画布缩放值\n  const [scale, setScale] = useState(1)\n  // 画布父级容器dom ref\n  const canvasWrapperRef = useRef<HTMLDivElement>(null)\n  // 获取模板数据\n  const { template, resetSelectStatus, removeLayer, addLayer } = templateStore\n\n  // 是否选中背景\n  const [isSelectedBackground, setIsSelectedBackground] = useState(false)\n\n  // 首次渲染画布尺寸适配\n  useEffect(() => {\n    const wrapperEl = canvasWrapperRef.current\n    const canvasWidth = template.global.width\n    const canvasHeight = template.global.height\n    let scale = 1\n    if (wrapperEl && wrapperEl.clientWidth < canvasWidth + 100) {\n      scale = (wrapperEl.clientWidth - 100) / canvasWidth\n    }\n    if (wrapperEl && wrapperEl.clientHeight < (canvasHeight * scale + 100)) {\n      scale = (wrapperEl.clientHeight - 100) / canvasHeight\n    }\n    setScale(scale)\n  }, [template.global.width, template.global.height])\n\n  // 键盘事件监听\n  const onKeyboardListener = useCallback((e: KeyboardEvent) => {\n    // 页面失焦\n    if (document.activeElement === document.body || document.activeElement === null) {\n      // 删除\n      if (e.key === 'Backspace' || e.key === 'Delete') {\n        const layer = template.layers.find(layer => layer.isSelected)\n        if (layer) {\n          removeLayer(layer.id)\n        }\n      }\n      // 复制\n      if (e.key === 'c' && (e.metaKey || e.ctrlKey)) {\n        const layer = template.layers.find(layer => layer.isSelected)\n        if (layer && !template.layers.some(l => l.isEditing)) {\n          copyLayer = cloneDeep(layer)\n        }\n      }\n      // 粘贴\n      if (e.key === 'v' && (e.metaKey || e.ctrlKey)) {\n        if (!template.layers.some(l => l.isEditing)) {\n          if (copyLayer) {\n            copyLayer.position && (copyLayer.position.x += 10)\n            copyLayer.position && (copyLayer.position.y += 10)\n            copyLayer.id = String(Date.now())\n            copyLayer.zIndex = template.layers.length ? template.layers[template.layers.length - 1].zIndex + 1 : 1\n            resetSelectStatus()\n            addLayer(copyLayer as Layer)\n          }\n        }\n      }\n      // 撤销\n      if (e.key === 'z' && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n        undo()\n      }\n      // 重做\n      if (e.key === 'z' && (e.metaKey || e.ctrlKey) && e.shiftKey) {\n        redo()\n      }\n    }\n  }, [addLayer, removeLayer, resetSelectStatus, template.layers])\n\n  useEffect(() => {\n    document.addEventListener('keydown', onKeyboardListener)\n    return () => { document.removeEventListener('keydown', onKeyboardListener) }\n  }, [onKeyboardListener])\n\n  // 取消所有图层的选中状态包括背景\n  const resetStatus = (e: MouseEvent<HTMLElement>) => {\n    // self\n    if ((e.target as HTMLElement).id === 'CanvasWrapper') {\n      resetSelectStatus()\n      setIsSelectedBackground(false)\n    }\n  }\n\n  return <Wrapper>\n    <ToolBar />\n    <CanvasWrapper ref={canvasWrapperRef} id=\"CanvasWrapper\" onMouseDown={resetStatus}>\n      <BackgroundContext.Provider value={{ isSelectedBackground, setIsSelectedBackground }}>\n        <ScaleContext.Provider value={scale}>\n          <Canvas />\n        </ScaleContext.Provider>\n      </BackgroundContext.Provider>\n    </CanvasWrapper>\n    <Footer scale={scale} setScale={(num) => setScale(num)} />\n  </Wrapper>\n})\n\nconst Wrapper = styled.div`\n  position: relative;\n  flex: 1;\n  overflow: hidden;\n`\n\nconst CanvasWrapper = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: calc(100% - 88px);\n  overflow: scroll;\n\n  ::-webkit-scrollbar {\n    width: 8px;\n    background: #eef2f8;\n\n    &:horizontal {\n      height: 8px;\n    }\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #eef2f8;\n  }\n\n  ::-webkit-scrollbar-corner {\n    background: #eef2f8;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #c4c4c4;\n    border: 8px solid rgba(0, 0, 0, 0);\n    border-radius: 9999px;\n\n    &:hover {\n      background: #adadad;\n    }\n  }\n`","import React from \"react\";\nimport styled from \"@emotion/styled\";\nimport Sidebar from \"./side-bar/Sidebar\";\nimport Editor from \"./Editor\";\n\nexport default function Main () {\n  return <MainBody>\n    <Sidebar />\n    <Editor />\n  </MainBody>\n}\n\nconst MainBody = styled.main`\n  display: flex;\n  height: calc(100vh - 56px);\n  background-color: #eef2f8;\n  overflow: hidden;\n`\n","import React from 'react';\nimport Nav from 'components/Nav'\nimport Main from 'components/Main'\nimport './App.css';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Nav />\n      <Main />\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from 'pages/App';\nimport reportWebVitals from './reportWebVitals';\nimport 'antd/dist/antd.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}