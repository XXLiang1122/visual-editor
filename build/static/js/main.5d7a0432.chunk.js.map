{"version":3,"sources":["components/Nav.tsx","services/base.ts","types/index.ts","utils/initData.ts","utils/undoRedo.ts","store/template.ts","components/side-bar/ImageItem.tsx","components/side-bar/TextItem.tsx","components/side-bar/UploadImage.tsx","components/side-bar/Sidebar.tsx","services/common.ts","components/Footer.tsx","assets/undo.png","assets/redo.png","store/context.ts","utils/mouseEvent.ts","utils/index.ts","components/layer/Border.tsx","assets/rotate.svg","assets/lock.svg","components/layer/HoverBorder.tsx","components/layer/Layer.tsx","utils/helpLine.ts","components/layer/TextEditor.tsx","components/Canvas.tsx","utils/const.ts","components/tool-bar/Index.tsx","components/Editor.tsx","components/Main.tsx","pages/App.tsx","reportWebVitals.ts","index.tsx"],"names":["Nav","Header","Img","src","styled","header","img","service","axios","create","baseURL","timeout","interceptors","response","use","data","LAYER_TYPE","defaultTemplate","global","width","height","background","color","layers","id","type","position","x","y","rotate","reverse","source","imageUrl","zIndex","content","style","font","fontSize","lineHeight","textAlign","fontWeight","underline","historyCache","pointer","isUndoOrRedo","undoRedo","setCanUseUndo","templateStore","setCanUseRedo","init","template","push","pushHistory","_template","cloneDeep","map","l","isSelected","isEditing","isHover","splice","length","shift","undo","setTemplate","setLayerType","EMPTY","redo","Object","assign","layer","isLocked","scale","localTemplateCache","localStorage","getItem","JSON","parse","observable","layerType","needUpdateLayerHeight","isMoving","canUseUndo","canUseRedo","this","getTemplate","val","setCanvasSize","size","setLayers","setLayer","idx","findIndex","addLayer","IMAGE","TEXT","removeLayer","setLayerLevel","level","selectLayer","forEach","document","dispatchEvent","Event","hoverLayer","editTextLayer","some","setLayerLock","resetSelectStatus","resetEditStatus","setBackgroundColor","setNeedUpdateLayerHeight","setIsMoving","action","bound","reaction","join","replaceAll","stringify","setItem","save","delay","observer","image","flexBasis","webformatWidth","webformatHeight","onClick","newLayer","String","Date","now","webformatURL","alt","Image","div","onUseImage","url","UploadButton","htmlFor","accept","display","onChange","e","reader","FileReader","readAsDataURL","target","files","onload","el","result","label","Panel","Collapse","Search","Input","ajaxLock","isLoadMore","Sidebar","useState","list","setList","page","per_page","image_type","q","orientation","safesearch","query","setQuery","showFilter","setShowFilter","useEffect","params","ajax","key","lang","then","concat","hits","finally","Side","defaultActiveKey","collapsible","extra","onSearch","preventDefault","placeholder","title","trigger","visible","onVisibleChange","FilterOutlined","stopPropagation","FilterPanel","ListContent","UploadImage","ImageItem","marginTop","TextItem","aside","setScale","FooterBar","SliderWrapper","className","tipFormatter","defaultValue","min","max","Math","round","UndoRedo","ToolItem","footer","ScaleContext","createContext","BackgroundContext","MouseEvents","handleMove","handleUp","payload","startCoords","preCoords","mouseUp","onmousemove","onmouseup","mouseMove","event","diffX","clientX","diffY","clientY","diff","curCoords","mouseDown","POINT_TYPE","getCenterCoords","p1","p2","calcRotatedCoords","point","center","PI","cos","sin","MIN_SIZE","INIT_ANGLE","ANGLE_TO_CURSOR","start","end","cursor","info","useContext","cursors","setCursors","resize","whRatio","newX","newY","newWidth","newHeight","TL","TR","BL","BR","T","B","L","R","resizeNormal","pointRect","getBoundingClientRect","canvasRect","querySelector","pointCenter","left","Number","top","symmetricPoint","curPoint","oldHeight","newCenterPoint","newOriginCurPoint","newOriginSymmetricPoint","abs","latestOriginCurPoint","latestCurPoint","sqrt","newCenter","isReverse","angle","resizeWithRotate","calcCursors","useCallback","a","newAngle","item","find","i","BorderEl","transform","LockIcon","icon","lockIcon","PointBR","onMouseDown","PointTL","PointTR","PointBL","PointL","PointR","PointT","PointB","RotateIcon","rotateIcon","borderEl","closest","rect","rotateCenterPoint","offsetY","offsetX","atan2","Point","span","bottom","alignItems","justifyContent","pointerEvents","borderRadius","boxShadow","userSelect","props","right","HoverBorder","children","setIsSelectedBackground","realRect","layerId","allLayers","canvasSize","vLineEl","hLineEl","vType","hType","vLineHandle","targetX","res","hLineHandle","targetY","renderLine","vLine","visibility","hLine","getRect","scl","rad","move","helpLine","helpLineRect","initHelpLine","helpLinePipe","updatePosition","newPosition","hideLine","LayerWrapper","onMouseEnter","onMouseOut","LayerContent","TransportBorder","Border","createPortal","editorRef","useRef","editor","setEditor","onTextChange","_layer","text","getText","current","instance","Quill","setText","enable","setSelection","on","off","TextWrapper","Text","onDoubleClick","Editor","ref","spellCheck","fontFamily","textDecorationLine","isSelectedBackground","Wrapper","CanvasContent","Background","BACKGROUND","Layer","toJS","draggable","TransportEditor","TextEditor","LayerControl","BackgroundBorder","VLine","HLine","TextControl","backgroundColor","flex","margin","overflow","FONT_LIST","name","value","FONTSIZE_LIST","CANVAS_SIZE_LIST","Option","Select","selectValue","setSelectValue","activeLayer","layerScale","hasUnderline","levelInfo","canvasWidth","canvasHeight","onReverseImage","direction","CanvasSizeOptions","Group","marginRight","isNumber","marginLeft","ToolBarWrapper","ItemGroup","includes","placement","clr","rgba","rgb","r","g","b","ColorItem","f","toFixed","isNaN","BoldOutlined","UnderlineOutlined","align","AlignLeftOutlined","AlignCenterOutlined","AlignRightOutlined","overlay","Item","padding","SwapOutlined","sort","LockOutlined","UnlockOutlined","DeleteOutlined","onConfirm","okText","cancelText","copyLayer","canvasWrapperRef","wrapperEl","clientWidth","clientHeight","onKeyboardListener","activeElement","body","metaKey","ctrlKey","shiftKey","addEventListener","removeEventListener","CanvasWrapper","Provider","Canvas","Footer","num","Main","MainBody","main","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.5d7a0432.chunk.js","sourcesContent":["import styled from \"@emotion/styled\";\n\nexport default function Nav () {\n  return <Header>\n    <Img src=\"/logo.png\" />\n  </Header>\n}\n\nconst Header = styled.header`\n  height: 56px;\n  display: flex;\n  align-items: center;\n  padding-left: 20px;\n  background-color: #fff;\n  border-bottom: 1px solid #ddd;\n`\n\nconst Img = styled.img`\n  width: 48px;\n  height: 48px;\n  object-fit: cover;\n`","import axios from 'axios'\n\nconst service = axios.create({\n  baseURL: 'https://pixabay.com/api',\n  timeout: 10000\n})\n\nservice.interceptors.response.use((response) => {\n  return response.data\n})\n\nexport default service","export interface TemplateInfo {\n  global: {\n    width: number;\n    height: number;\n  },\n  background: {\n    color: string;\n  },\n  layers: Layer[];\n}\n\nexport interface Layer {\n  id: string;\n  type: LayerType;\n  width: number;\n  height: number;\n  position: {\n    x: number;\n    y: number;\n  };\n  rotate: number;\n  reverse?: {\n    x: number;\n    y: number;\n  },\n  source: {\n    imageUrl?: string;\n    content?: string;\n  };\n  style?: FontStyle;\n  zIndex: number;\n  isSelected?: boolean;\n  isHover?: boolean;\n  isEditing?: boolean;\n  isLocked?: boolean;\n  scale?: number;\n}\n\nexport interface FontStyle {\n  font: string;\n  fontSize: number;\n  lineHeight: number;\n  color: string;\n  textAlign: Align;\n  fontWeight: number;\n  underline: boolean;\n}\n\nexport type LayerType = 'image' | 'text'\nexport type Align = 'left' | 'center' | 'right' | 'justify'\n\nexport enum LAYER_TYPE {\n  EMPTY = 'empty',\n  IMAGE = 'image',\n  TEXT = 'text',\n  BACKGROUND = 'background'\n}","import { TemplateInfo } from 'types'\n\nexport const defaultTemplate: TemplateInfo = {\n  global: {\n    width: 1280,\n    height: 720\n  },\n  background: {\n    color: '#fff'\n  },\n  layers: [\n    {\n      id: '1',\n      type: 'image',\n      width: 510,\n      height: 340,\n      position: {\n        x: 100,\n        y: 100\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: 'https://cdn.pixabay.com/photo/2014/04/13/20/49/cat-323262__340.jpg'\n      },\n      zIndex: 1\n    },\n    {\n      id: '2',\n      type: 'text',\n      width: 380,\n      height: 72,\n      position: {\n        x: 100,\n        y: 500\n      },\n      rotate: 0,\n      source: {\n        content: '双击编辑文字'\n      },\n      style: {\n        font: 'Microsoft Yahei',\n        fontSize: 60,\n        lineHeight: 1.2,\n        color: '#000',\n        textAlign: 'left',\n        fontWeight: 400,\n        underline: false\n      },\n      zIndex: 2\n    }\n  ]\n}","import { cloneDeep } from 'lodash'\nimport { templateStore } from 'store/template'\nimport { TemplateInfo, LAYER_TYPE } from 'types'\n\nconst historyCache: TemplateInfo[] = []\nlet pointer = 0\nlet isUndoOrRedo = false\n\nexport default function undoRedo () {\n  const { setCanUseUndo, setCanUseRedo } = templateStore\n\n  const init = (template: TemplateInfo) => {\n    historyCache.push(template)\n  }\n\n  // 缓存历史记录\n  const pushHistory = () => {\n    if (isUndoOrRedo) {\n      isUndoOrRedo = false\n      return\n    }\n\n    const _template = cloneDeep(templateStore.template)\n    _template.layers = _template.layers.map(l => {\n      l.isSelected = false\n      l.isEditing = false\n      l.isHover = false\n      return l\n    })\n    pointer++\n    historyCache[pointer] = _template\n    historyCache.splice(pointer + 1, historyCache.length)\n    setCanUseUndo(true)\n    setCanUseRedo(false)\n    if (historyCache.length > 100) {\n      historyCache.shift()\n      pointer--\n    }\n  }\n\n  // 撤销\n  const undo = () => {\n    if (historyCache[pointer - 1]) {\n      isUndoOrRedo = true\n      pointer--\n      const _template = historyCache[pointer]\n      templateStore.setTemplate(cloneDeep(_template))\n      templateStore.setLayerType(LAYER_TYPE.EMPTY)\n      setCanUseRedo(true)\n      if (!historyCache[pointer - 1]) {\n        setCanUseUndo(false)\n      }\n    }\n  }\n\n  // 重做\n  const redo = () => {\n    if (historyCache[pointer + 1]) {\n      isUndoOrRedo = true\n      pointer++\n      const _template = historyCache[pointer]\n      templateStore.setTemplate(cloneDeep(_template))\n      templateStore.setLayerType(LAYER_TYPE.EMPTY)\n      setCanUseUndo(true)\n      if (!historyCache[pointer + 1]) {\n        setCanUseRedo(false)\n      }\n    }\n  }\n\n  return {\n    init,\n    pushHistory,\n    undo,\n    redo\n  }\n}","import { observable, action, reaction } from 'mobx'\nimport { defaultTemplate } from 'utils/initData'\nimport { TemplateInfo, Layer, LAYER_TYPE } from 'types'\nimport { cloneDeep } from 'lodash'\nimport undoRedo from 'utils/undoRedo'\n\nlet template: TemplateInfo = Object.assign(defaultTemplate, {\n  layers: defaultTemplate.layers.map(layer => { return {...layer, isSelected: false, isEditing: false, isHover: false, isLocked: false, scale: 1} })\n})\n\nconst localTemplateCache = localStorage.getItem('TEMPLATE')\nif (localTemplateCache) {\n  template = JSON.parse(localTemplateCache)\n}\n\n// 模板store\nexport const templateStore = observable({\n  // 模板\n  template: template,\n  // 当前编辑图层类型\n  layerType: LAYER_TYPE.EMPTY,\n  // 是否需要重新计算图层的高度，比如改变字体大小时需要\n  needUpdateLayerHeight: false,\n  // 图层是否正在移动\n  isMoving: false,\n  canUseUndo: false,\n  canUseRedo: false,\n\n  get layers (): Layer[] {\n    return this.template.layers\n  },\n\n  // 获取最新的模板\n  getTemplate () {\n    const _template = cloneDeep(templateStore.template)\n    _template.layers = _template.layers.map(l => {\n      if (l.type === 'text' && l.style && l.scale) {\n        l.style.fontSize *= l.scale\n      }\n      delete l.isSelected\n      delete l.isEditing\n      delete l.scale\n      return l\n    })\n    return _template\n  },\n\n  // 修改整体模板\n  setTemplate (val: TemplateInfo) {\n    this.template = val\n  },\n\n  // 修改画布尺寸\n  setCanvasSize (size: { width: number; height: number }) {\n    this.template.global.width = size.width\n    this.template.global.height = size.height\n  },\n\n  // 修改全部图层\n  setLayers (layers: Layer[]) {\n    this.template.layers = layers\n  },\n\n  // 修改单个图层\n  setLayer (layer: Layer) {\n    const idx = this.layers.findIndex(l => l.id === layer.id)\n    if (idx > -1 && !this.layers[idx].isLocked) {\n      this.layers[idx] = layer\n    }\n  },\n\n  // 新增单个图层\n  addLayer (layer: Layer) {\n    this.layers.push(layer)\n    if (layer.type === 'image') {\n      this.setLayerType(LAYER_TYPE.IMAGE)\n    } else if (layer.type === 'text') {\n      this.setLayerType(LAYER_TYPE.TEXT)\n    }\n  },\n\n  // 移除单个图层\n  removeLayer (id: string) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1 && !this.layers[idx].isLocked) {\n      this.layers.splice(idx, 1)\n      this.setLayerType(LAYER_TYPE.EMPTY)\n    }\n  },\n\n  // 设置图层层级\n  setLayerLevel (id: string, level: number) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1) {\n      this.layers[idx].zIndex = level\n    }\n  },\n\n  // 选择图层\n  selectLayer (id: string) {\n    this.layers.forEach(layer => {\n      layer.isSelected = layer.id === id\n      if (layer.isSelected) {\n        if (layer.type === 'image') {\n          this.setLayerType(LAYER_TYPE.IMAGE)\n        } else if (layer.type === 'text') {\n          this.setLayerType(LAYER_TYPE.TEXT)\n        }\n      }\n    })\n    // 隐藏一些下拉组件\n    document.dispatchEvent(new Event('mousedown'))\n  },\n\n  // 鼠标经过图层\n  hoverLayer (id?: string) {\n    this.layers.forEach(layer => {\n      layer.isHover = id ? layer.id === id : false\n    })\n  },\n\n  // 设置当前选择的图层类型\n  setLayerType (type: LAYER_TYPE) {\n    this.layerType = type\n  },\n\n  // 设置文字图层编辑状态\n  editTextLayer (id: string) {\n    if (this.layers.some(l => l.id === id && l.isLocked)) return\n    this.layers.forEach(layer => {\n      layer.isEditing = layer.id === id\n    })\n  },\n\n  // 设置图层锁定状态\n  setLayerLock (id: string, isLocked: boolean) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1) {\n      this.layers[idx].isLocked = isLocked\n      this.layers[idx].isEditing = false\n    }\n  },\n\n  // 重置所有图层选中状态\n  resetSelectStatus () {\n    this.layers.forEach(layer => {\n      layer.isSelected = false\n    })\n    this.setLayerType(LAYER_TYPE.EMPTY)\n  },\n\n  // 重置所有文字图层编辑状态\n  resetEditStatus () {\n    this.layers.forEach(layer => {\n      layer.isEditing = false\n    })\n  },\n\n  // 设置背景色\n  setBackgroundColor (color: string) {\n    this.template.background.color = color\n  },\n\n  // 设置needUpdateLayerHeight\n  setNeedUpdateLayerHeight (val: boolean) {\n    this.needUpdateLayerHeight = val\n  },\n\n  // 设置isMoving\n  setIsMoving (val: boolean) {\n    this.isMoving = val\n  },\n\n  setCanUseUndo (val: boolean) {\n    this.canUseUndo = val\n  },\n\n  setCanUseRedo (val: boolean) {\n    this.canUseRedo = val\n  },\n}, {\n  setTemplate: action.bound,\n  getTemplate: action.bound,\n  setCanvasSize: action.bound,\n  setLayers: action.bound,\n  setLayer: action.bound,\n  addLayer: action.bound,\n  removeLayer: action.bound,\n  selectLayer: action.bound,\n  setLayerLevel: action.bound,\n  hoverLayer: action.bound,\n  setLayerType: action.bound,\n  editTextLayer: action.bound,\n  setLayerLock: action.bound,\n  resetSelectStatus: action.bound,\n  resetEditStatus: action.bound,\n  setBackgroundColor: action.bound,\n  setNeedUpdateLayerHeight: action.bound,\n  setIsMoving: action.bound,\n  setCanUseUndo: action.bound,\n  setCanUseRedo: action.bound\n})\n\n// 切换图层时重置文字编辑状态\n// 清空空文字图层\nreaction(\n  () => templateStore.layers.map(l => l.isSelected).join(''),\n  () => {\n    templateStore.resetEditStatus()\n    const idx = templateStore.layers.findIndex(l => l.type === 'text' && !l.source.content?.replaceAll(/\\n/g, ''))\n    if (idx > -1) {\n      templateStore.removeLayer(templateStore.layers[idx].id)\n    }\n  }\n)\n\n// 撤销重做\nconst { init, pushHistory } = undoRedo()\ninit(template)\n\n// 保存到本地\nconst save = () => {\n  const template = cloneDeep(templateStore.template)\n  template.layers = template.layers.map(l => {\n    l.isSelected = false\n    l.isEditing = false\n    l.isHover = false\n    return l\n  })\n  localStorage.setItem('TEMPLATE', JSON.stringify(template))\n}\n\n// 侦听保存\nreaction(\n  () => {\n    const template = cloneDeep(templateStore.template)\n    template.layers = template.layers.map(l => {\n      delete l.isSelected\n      delete l.isEditing\n      delete l.isHover\n      return l\n    })\n    return JSON.stringify(template)\n  },\n  () => { save(); pushHistory() },\n  {\n    delay: 500\n  }\n)\n","import styled from \"@emotion/styled\";\nimport { ImageItem as ImageInfo } from \"types/image\";\nimport { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { observer } from 'mobx-react';\n\nexport default observer(({ image }: { image: ImageInfo }) => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n\n  // 使用图片\n  const onUseImage = () => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'image',\n      width: image.webformatWidth,\n      height: image.webformatHeight,\n      position: {\n        x: (template.global.width - image.webformatWidth) / 2,\n        y: (template.global.height - image.webformatHeight) / 2\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: image.webformatURL\n      },\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n\n  return <Image\n    style={{\n      flexBasis: `${100 * image.webformatWidth / image.webformatHeight}px`\n    }}\n    onClick={onUseImage}\n  >\n    <img src={image.webformatURL} alt=\"\" />\n  </Image>\n})\n\nconst Image = styled.div`\n  position: relative;\n  margin: 0 10px 10px 0;\n  background-color: #f0f1f4;\n  overflow: hidden;\n  flex-grow: 1;\n\n  img {\n    min-width: 100%;\n    height: 100px;\n    object-fit: cover;\n  }\n`","import { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { Button } from 'antd';\nimport { observer } from 'mobx-react';\n\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus, editTextLayer } = templateStore\n\n  // 新增文本\n  const onUseImage = () => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'text',\n      width: 380,\n      height: 72,\n      position: {\n        x: (template.global.width - 300) / 2,\n        y: (template.global.height - 72) / 2\n      },\n      rotate: 0,\n      source: {\n        content: '双击编辑文字'\n      },\n      style: {\n        font: '微软雅黑',\n        fontSize: 60,\n        lineHeight: 1.2,\n        color: '#000',\n        textAlign: 'left',\n        fontWeight: 400,\n        underline: false\n      },\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: true,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n    editTextLayer(newLayer.id)\n  }\n\n  return <Button size=\"large\" style={{ width: '100%' }} onClick={onUseImage}>\n    添加文本\n  </Button>\n})","import styled from \"@emotion/styled\";\nimport { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { Button } from 'antd';\nimport { observer } from 'mobx-react';\n\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n\n  // 选择图片\n  const uploadImage = (e: any) => {\n    const reader = new FileReader()\n    reader.readAsDataURL(e.target.files[0])\n    reader.onload = el => {\n      const url = el.target?.result\n      if (typeof url === 'string') {\n        const img = new Image()\n        img.src = url\n        img.onload = () => {\n          onUseImage(img.width, img.height, url)\n        }\n      }\n    }\n  }\n\n  // 使用图片\n  const onUseImage = (width: number, height: number, url: string) => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'image',\n      width: width,\n      height: height,\n      position: {\n        x: (template.global.width - width) / 2,\n        y: (template.global.height - height) / 2\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: url\n      },\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n\n  return <>\n    <UploadButton htmlFor=\"uploadImage\">\n      <Button size=\"large\">\n        选择本地图片\n      </Button>\n    </UploadButton>\n    <input type=\"file\" id=\"uploadImage\" accept=\"image/*\" style={{ display: 'none' }} onChange={uploadImage} />\n  </>\n})\n\nconst UploadButton = styled.label`\n  display: block;\n  width: 100%;\n  margin-bottom: 16px;\n  cursor: pointer;\n\n  button {\n    width: 100%;\n    pointer-events: none;\n  }\n`","import styled from \"@emotion/styled\";\nimport { useState, useEffect } from \"react\";\nimport { ImageItem as ImageInfo, SearchQuery } from \"types/image\";\nimport { getImages } from \"services/common\";\nimport { Collapse } from 'antd';\nimport { FilterOutlined } from '@ant-design/icons';\nimport { Popover, Input, Button } from 'antd';\nimport ImageItem from './ImageItem'\nimport TextItem from './TextItem'\nimport UploadImage from \"./UploadImage\";\n\nconst { Panel } = Collapse\nconst { Search } = Input\n\nlet ajaxLock = false\nlet isLoadMore = false\n\nexport default function Sidebar () {\n  // 图片列表\n  const [list, setList] = useState<ImageInfo[]>([])\n  // 图片查询参数\n  const [query, setQuery] = useState<Partial<SearchQuery>>({\n    page: 1,\n    per_page: 20,\n    image_type: 'all',\n    q: '',\n    orientation: 'all',\n    safesearch: true\n  })\n\n  const [showFilter, setShowFilter] = useState(false)\n\n  useEffect(() => {\n    getImages(query).then((data: any) => {\n      if (isLoadMore) {\n        setList(list => list.concat(data.hits))\n      } else {\n        setList(data.hits)\n      }\n    }).finally(() => {\n      ajaxLock = false\n    })\n  }, [query])\n\n  // 加载更多图片\n  const onLoadMore = () => {\n    if (ajaxLock) return\n    ajaxLock = true\n    const page = query.page\n    isLoadMore = true\n    setQuery(Object.assign({}, query, {\n      page: page ? page + 1 : 1\n    }))\n  }\n\n  // 图片筛选面板\n  const FilterPanel = () => {\n    const onSearch = (val: string, e: any) => {\n      e.preventDefault()\n      if (val) {\n        isLoadMore = false\n        setQuery(Object.assign({}, query, {\n          q: val,\n          page: 1\n        }))\n      }\n    }\n\n    const Content = () => {\n      return <>\n        <Search placeholder=\"搜索\" onSearch={onSearch} style={{ width: 200 }} />\n      </>\n    }\n\n    return <Popover\n      content={Content}\n      title=\"筛选\"\n      trigger=\"click\"\n      visible={showFilter}\n      onVisibleChange={visible => setShowFilter(visible)}\n    >\n      <FilterOutlined onClick={(e) => { e.stopPropagation(); setShowFilter(true) }} />\n    </Popover>\n  }\n\n  return <Side>\n    <Collapse defaultActiveKey={['1']} collapsible=\"header\">\n      <Panel header={<div style={{ width: '300px' }}>图片</div>} key=\"1\" extra={FilterPanel()}>\n        <ListContent>\n          <UploadImage />\n          {list.map(image => <ImageItem key={image.id} image={image} />)}\n          <Button style={{ width: '100%', marginTop: '20px' }} onClick={onLoadMore}>加载更多</Button>\n      </ListContent>\n      </Panel>\n      <Panel header={<div style={{ width: '300px' }}>文字</div>} key=\"2\">\n        <ListContent>\n          <TextItem />\n        </ListContent>\n      </Panel>\n    </Collapse>\n  </Side>\n}\n\nconst Side = styled.aside`\n  flex: none;\n  display: flex;\n  flex-direction: column;\n  width: 400px;\n  height: 100%;\n  background-color: #fff;\n  border-right: 1px solid #ddd;\n  overflow-y: scroll;\n\n  ::-webkit-scrollbar {\n    width: 8px;\n    background: #fff;\n\n    &:horizontal {\n      height: 8px;\n    }\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #fff;\n  }\n\n  ::-webkit-scrollbar-corner {\n    background: #fff;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #c4c4c4;\n    border: 8px solid rgba(0, 0, 0, 0);\n    border-radius: 9999px;\n\n    &:hover {\n      background: #adadad;\n    }\n  }\n\n  .ant-collapse {\n    border: 0;\n    background-color: #fff;\n  }\n`\n\nconst ListContent = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  padding-left: 10px;\n  user-select: none;\n\n  &:after {\n    content: '';\n    display: block;\n    flex-grow: 99999;\n  }\n`\n","import ajax from './base'\n\nconst key = '24178889-8dbe9fccf0c585814c1dcb342'\n\nexport const getImages = (params: any): any => {\n  return ajax({\n    url: '/',\n    params: {\n      key,\n      lang: 'zh',\n      ...params\n    }\n  })\n}\n","import styled from \"@emotion/styled\";\nimport { Slider } from \"antd\";\nimport UndoIcon from \"assets/undo.png\";\nimport RedoIcon from \"assets/redo.png\";\nimport undoRedo from 'utils/undoRedo'\nimport { templateStore } from 'store/template'\nimport { observer } from 'mobx-react';\n\nconst { undo, redo } = undoRedo()\n\nexport default observer(({ scale, setScale }: { scale: number; setScale: (n: number) => void }) => {\n  const { canUseUndo, canUseRedo } = templateStore\n\n  const scaleChange = (val: number) => {\n    setScale(val / 100)\n  }\n\n  return <FooterBar>\n    <SliderWrapper>\n      <Slider\n        className=\"slider\"\n        tipFormatter={null}\n        defaultValue={scale * 100}\n        min={10} max={500}\n        onChange={scaleChange}\n      />\n      <div className=\"scale\">{Math.round(scale * 100)}%</div>\n    </SliderWrapper>\n    <UndoRedo>\n      <ToolItem className={ canUseUndo ? 'active' : '' } onClick={undo}><img src={UndoIcon} alt=\"\" /></ToolItem>\n      <ToolItem className={ canUseRedo ? 'active' : '' } onClick={redo}><img src={RedoIcon} alt=\"\" /></ToolItem>\n    </UndoRedo>\n  </FooterBar>\n})\n\nconst FooterBar = styled.footer`\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  width: 100%;\n  height: 44px;\n  padding: 0 40px;\n  background-color: #fff;\n  border-top: 1px solid #ddd;\n\n  .slider {\n    width: 240px;\n  }\n\n  .scale {\n    width: 100px;\n    padding-left: 20px;\n  }\n`\n\nconst SliderWrapper = styled.div`\n  display: flex;\n  align-items: center;\n`\n\nconst UndoRedo = styled.div`\n  display: flex;\n  justify-content: space-around;\n  width: 120px;\n\n  img {\n    width: 22px;\n    height: 22px;\n    pointer-events: none;\n    user-select: none;\n  }\n`\n\nconst ToolItem = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 6px 8px;\n  border-radius: 4px;\n  cursor: not-allowed;\n  opacity: .5;\n\n  &:hover {\n    background-color: rgba(64,87,109,.07);\n  }\n\n  &.active {\n    opacity: 1;\n    cursor: pointer;\n  }\n`","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAArRJREFUWEfFl09rE1EQwGfyB/SgKOjBQz1IIeBBEPsB6tFL8uZBCiIIgiiKigcpiKDtwYJ4kFpQiAh68WDovrdRWMGDfoAW9KBURRCUigoe9BJD3o5syZbNZje7G5P4IITMmzfzezPzZgjCf16Yxj8RXQWAeWae11rPpTmTVicRQAhxGREXfIPDhugLQESXAOBm8DaI+MCyrBNpb5ikFwtARBcAYDFk4I3rujO2bb9NMpx2PxJACHEGEe+M2rlnvwdASnmSme+Nw3kPABEdB4CHEeHzIvKtIzfM7HqrUCgY79v7DQCe/Hur1friOM6vzCkQQhxFxEdpDyborSGicl13WWu92k93IwXVanWy3W5/GJLzLjOIWDPGLMYV7mYNENFjj2UUEAAQ+3q6ijAOwms+acAQcQIASp3PrjSF3PMKoiAG6X5CiNuIeD4JIrIPDBFiGhFfhDppzbKs076sXyeMqolZpVRXa05KTblcLuXz+bWgHjNP+a8jaRb0QLiue8y27UzPVQgxi4g3Nm+NeMWyrI0BlzgNw+kYdBgR0U8A2NmBeKWUOpgKwFMKQDxn5lNa609JoQ/vE9EKABzy5caY7Y1G43diBPwDQoi5YrG4UK/XW1mdhy7hHy8ppd6nBhjEafCMdwFEvObLmPmw1vrl2ACIaBkAZABgUmv9cWwAUsrXzHzAB2g2m1scx/kzFoBKpTKRy+XeAcDWDsAzpdSR1K/gX/MvpVxi5nOB8J/VWt8dCwAReRPWa2j+WkfEKcuyvo4cQEp5i5kvhtpw13+LodeAEGJHoVDYb4y5DgDTofTVlVIzQVlmgGq1utsYc5+Zt0XUxl4A2BdTMz3OB0qBEKJnxKYo0kjn4wBYZeaa1roWB5k5BVLKPcy8HmPwBwB8RsQVZn6ilHqaFJ3MAEkGs+7/BQfySDDlTlsQAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAqtJREFUWEfFljGrE0EQx2duQ0yjiKA2TxBEfWjhg2dno1gdaLJzD2MlKOLDRkUtLCx8tqIgPEGwULASD243ATvB9wVEsBCEh4qChQqKFlpcMrIhd1wul9wuOXEhhGRn5v+7uZ2ZRfjPC6vWl1KuIOINAGgrpcKy+JUCZMQT3VKISgGCIHjEzKdzTz0VolKAVqu1z/O8pwCw3xaiUgAj6gpROYArhBOA7/ub6vX6HCJuAwCBiJ5ZcRwL821+m/8NBDNvB4D7BVUwciZKAaSUi57nLTEzAcB8WVlZ7qcQEwHMuxRCXGLmZcugTma1Wm13GIbrhQDDg/QMAHY6RbU3DpVSbWM+BiClPIyILwpifQOAt+bDzJ9stIYdMW+aio8BSCkXhuKbs17MvKq1vmgjmtgUdEWzNSI+BkBEpomcyIkf0VqvuYgT0RUAuJPzGRMfASCiMwDwMOvU6/Xmu92uSbv1IqJzAPDARnwEIAiCx8x8KnFk5mta61vWygAQBMFJZn5iK57PwPvMqf+ulNriIm5sC4ZRYdqzcQdV0Gw2NwohfmY2XiqlDroC5OZAqXiaASLaMyyxRNPKuQjQQCBiW2u9YvMAgwzka5+Zb9oGsBGZZpMA7ELE9YxhpJRamjW4jf8AwPf9DY1G40/igIivoyg6YBNgVpu0FRPRKwBYGAb83e/393Y6HauWOwtEFsDM7vOZLNyLoujCLMFtfFMAKeVRRHyecyq91dqIlB7CxEBKeRsRr440CsS7URRdnlVokv/YOM6dhcRvTQhxPY7jN1rrH1XCFF5IiOgLAGydIPQOAD7m9xDxlxDibBiGX10AJ17JikZzWWBmdh7dUy+lUsplRDR3wsUycbNfOUAiSkTHEPE4M5sBtWPC6/nMzIe01h9sYNNydzH+F7Z/AWqi/yEtgkl8AAAAAElFTkSuQmCC\"","import { createContext } from \"react\";\nexport const ScaleContext = createContext<number>(1)\nexport const BackgroundContext = createContext<any>(null)","import { MouseEvent as MouseEventType } from \"react\";\n\nexport class MouseEvents {\n  constructor (e: MouseEventType<HTMLElement>, handleMove: (payload: any) => void, handleUp?: () => void) {\n    this.mouseDown(e)\n    this.handleMove = handleMove\n    handleUp && (this.handleUp = handleUp)\n  }\n  \n  private handleMove = (payload: any) => {}\n  private handleUp = () => {}\n\n  private startCoords = {\n    x: 0,\n    y: 0\n  }\n\n  private preCoords = {\n    x: 0,\n    y: 0\n  }\n\n  private mouseUp = () => {\n    document.onmousemove = null\n    document.onmouseup = null\n    this.handleUp()\n  }\n\n  private mouseMove = (event: any) => {\n    const diffX = event.clientX - this.preCoords.x\n    const diffY = event.clientY - this.preCoords.y\n    this.preCoords = {\n      x: event.clientX,\n      y: event.clientY\n    }\n    this.handleMove({\n      diff: {\n        x: diffX,\n        y: diffY\n      },\n      startCoords: this.startCoords,\n      curCoords: this.preCoords\n    })\n  }\n\n  private mouseDown = (e: MouseEventType<HTMLElement>) => {\n    this.startCoords = {\n      x: e.clientX,\n      y: e.clientY\n    }\n    this.preCoords = {\n      x: e.clientX,\n      y: e.clientY\n    }\n    document.onmousemove = this.mouseMove\n    document.onmouseup = this.mouseUp\n  }\n}","interface Coords {\n  x: number;\n  y: number;\n}\n\n// 求两点之间的中点坐标\nexport const getCenterCoords = (p1: Coords, p2: Coords): Coords => {\n  return {\n    x: p1.x + ((p2.x - p1.x) / 2),\n    y: p1.y + ((p2.y - p1.y) / 2)\n  }\n}\n\n/**\n * 计算根据圆心旋转后的点的坐标\n * @param point 旋转前的点坐标\n * @param center 旋转中心\n * @param rotate 旋转的角度\n * @return 旋转后的坐标\n */\n export const calcRotatedCoords = (point: Coords, center: Coords, rotate: number): Coords => {\n  rotate /= 180 / Math.PI\n  return {\n    x: (point.x - center.x) * Math.cos(rotate) - (point.y - center.y) * Math.sin(rotate) + center.x,\n    y: (point.x - center.x) * Math.sin(rotate) + (point.y - center.y) * Math.cos(rotate) + center.y\n  }\n}","import { Layer } from 'types';\nimport { MouseEvent, useContext, useState, useEffect, useCallback } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { ScaleContext } from 'store/context';\nimport { MouseEvents } from 'utils/mouseEvent';\nimport { getCenterCoords, calcRotatedCoords } from 'utils';\nimport rotateIcon from 'assets/rotate.svg';\nimport lockIcon from 'assets/lock.svg';\nimport { templateStore } from 'store/template';\nimport { cloneDeep } from 'lodash';\nimport { observer } from 'mobx-react';\n\nenum POINT_TYPE {\n  TL = 'topLeft',\n  TR = 'topRight',\n  BL = 'bottomLeft',\n  BR = 'bottomRight',\n  T = 'top',\n  B = 'bottom',\n  L = 'left',\n  R = 'right'\n}\n\ninterface Coords {\n  x: number;\n  y: number;\n}\n\nconst MIN_SIZE = {\n  width: 10,\n  height: 10\n}\n\n// 初始的指针角度（左上、上、右上、右）\nconst INIT_ANGLE = [0, 45, 90, 135]\n// 角度范围对应的指针样式\nconst ANGLE_TO_CURSOR = [\n  { start: 0, end: 23, cursor: 'nwse-resize' },\n  { start: 338, end: 360, cursor: 'nwse-resize' },\n  { start: 23, end: 68, cursor: 'ns-resize' },\n  { start: 68, end: 113, cursor: 'nesw-resize' },\n  { start: 113, end: 158, cursor: 'ew-resize' },\n  { start: 158, end: 203, cursor: 'nwse-resize' },\n  { start: 203, end: 248, cursor: 'ns-resize' },\n  { start: 248, end: 293, cursor: 'nesw-resize' },\n  { start: 293, end: 338, cursor: 'ew-resize' }\n]\n\n// 编辑框\nexport default observer(({ info }: { info: Layer; }) => {\n  const scale = useContext(ScaleContext)\n\n  const { layers, setLayer, isMoving, setIsMoving } = templateStore\n\n  // 鼠标样式\n  const [cursors, setCursors] = useState<string[]>([])\n\n  // 调整大小 无旋转\n  const resizeNormal = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    const idx = layers.findIndex(layer => layer.id === info.id)\n    // const layer = cloneDeep(layers[idx])\n\n    if (idx > -1) {\n      new MouseEvents(e, (payload) => {\n        const layer = cloneDeep(layers[idx])\n\n        const { x, y } = payload.diff\n        const whRatio = layer.width / layer.height\n        let { x: newX, y: newY } = layer.position\n        let { width: newWidth, height: newHeight } = layer\n        switch (point) {\n          case POINT_TYPE.TL: {\n            const height = layer.height\n            newWidth -= x / scale\n            newX += x / scale\n            newHeight = newWidth / whRatio\n            newY -= newHeight - height\n            break\n          }\n          case POINT_TYPE.TR: {\n            const height = layer.height\n            newWidth += x / scale\n            newHeight = newWidth / whRatio\n            newY -= newHeight - height\n            break\n          }\n          case POINT_TYPE.BL: {\n            newWidth -= x / scale\n            newX += x / scale\n            newHeight = newWidth / whRatio\n            break\n          }\n          case POINT_TYPE.BR: {\n            newWidth += x / scale\n            newHeight = newWidth / whRatio\n            break\n          }\n          case POINT_TYPE.T: {\n            newHeight -= y / scale\n            newY += y / scale\n            break\n          }\n          case POINT_TYPE.B: {\n            newHeight += y / scale\n            break\n          }\n          case POINT_TYPE.L: {\n            newWidth -= x / scale\n            newX += x / scale\n            break\n          }\n          case POINT_TYPE.R: {\n            newWidth += x / scale\n            break\n          }\n        }\n\n        if ((newWidth > MIN_SIZE.width && newHeight > MIN_SIZE.height) || newWidth > layer.width || newHeight > layer.height) {\n          if (layer.type === 'text') {\n            if (layer.height !== newHeight && layer.scale) {\n              layer.scale *= newHeight / layer.height\n            }\n          }\n\n          layer.width = newWidth\n          layer.height = newHeight\n          layer.position.x = newX\n          layer.position.y = newY\n        }\n\n        setLayer(layer)\n        setIsMoving(true)\n      }, () => {\n        setIsMoving(false)\n      })\n    }\n  }\n\n  // 调整大小 有旋转\n  const resizeWithRotate = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    // 图层相对于画布左上角的中心点\n    const center = {\n      x: (info.position.x + info.width / 2) * scale,\n      y: (info.position.y + info.height / 2) * scale\n    }\n\n    // 获取边框圆点中心点\n    const pointRect = (e.target as HTMLElement)?.getBoundingClientRect()\n    const canvasRect = (document.querySelector('#layerControl') as HTMLElement)?.getBoundingClientRect()\n    const pointCenter = {\n      x: pointRect.left - Number(canvasRect.left) + pointRect.width / 2,\n      y: pointRect.top - Number(canvasRect.top) + pointRect.height / 2\n    }\n\n    // 获取对称点\n    const symmetricPoint = {\n      x: center.x - (pointCenter.x - center.x),\n      y: center.y - (pointCenter.y - center.y)\n    }\n\n    const whRatio = info.width / info.height\n    const idx = layers.findIndex(layer => layer.id === info.id)\n    // const layer = cloneDeep(layers[idx])\n\n    new MouseEvents(e, ({ curCoords }: { curCoords: Coords }) => {\n      const layer = cloneDeep(layers[idx])\n\n      const curPoint = {\n        x: curCoords.x - Number(canvasRect.left),\n        y: curCoords.y - Number(canvasRect.top)\n      }\n\n      const oldHeight = layer.height\n\n      switch (point) {\n        case POINT_TYPE.TL: {\n          // 根据鼠标当前位置和对称点获取最新中心点\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的左上角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          // 获取旋转前的对称点坐标\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          let newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          // 获取等比缩放计算后的坐标\n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x += Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y += Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          // 由于现在求的未旋转前的坐标是以没按比例缩减宽高前的坐标来计算的\n          // 所以缩减宽高后，需要按照原来的中心点旋转回去，获得缩减宽高并旋转后对应的坐标\n          // 然后以这个坐标和对称点获得新的中心点，并重新计算未旋转前的坐标\n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginCurPoint.y / scale\n            layer.position.x = newOriginCurPoint.x / scale\n          }\n          break\n        }\n\n        case POINT_TYPE.TR: {\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的右上角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          let newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x -= Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y += Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginCurPoint.y / scale\n            layer.position.x = newOriginSymmetricPoint.x / scale\n          }\n          break\n        }\n  \n        case POINT_TYPE.BR: {\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的右下角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          let newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x -= Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y -= Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n          newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginSymmetricPoint.y / scale\n            layer.position.x = newOriginSymmetricPoint.x / scale\n          }\n          break\n        }\n  \n        case POINT_TYPE.BL: {\n          let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n          // 获取旋转前的左下角坐标\n          let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n          let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          let newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          let newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / newHeight > whRatio) {\n            newOriginCurPoint.x += Math.abs(newWidth - newHeight * whRatio)\n          } else {\n            newOriginCurPoint.y -= Math.abs(newHeight - newWidth / whRatio)\n          }\n  \n          const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n          newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n          newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n          newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n  \n          newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n          newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n  \n          if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n            layer.width = newWidth / scale\n            layer.height = newHeight / scale\n            layer.position.y = newOriginSymmetricPoint.y / scale\n            layer.position.x = newOriginCurPoint.x / scale\n          }\n          break\n        }\n  \n        case POINT_TYPE.T:\n        case POINT_TYPE.B: {\n          // 由于用户拉伸时是以任意角度拉伸的，所以在求得旋转前的坐标时，只取 y 坐标（这里的 x 坐标可能是任意值），x 坐标用 pointCenter 的。\n          // 这个中心点（第二个参数）用 pointCenter, center, symmetricPoint 都可以，只要他们在一条直线上就行\n          const newOriginCurPoint = calcRotatedCoords(curPoint, pointCenter, -info.rotate)\n  \n          // 算出旋转前 y 坐标，再用 initCurPoint 的 x 坐标，重新计算它们旋转后对应的坐标\n          const latestCurPoint = calcRotatedCoords({\n            x: pointCenter.x,\n            y: newOriginCurPoint.y\n          }, pointCenter, info.rotate)\n  \n          // 用旋转后的坐标和对称点算出新的高度（勾股定理）\n          const newHeight = Math.sqrt((latestCurPoint.x - symmetricPoint.x) ** 2 + (latestCurPoint.y - symmetricPoint.y) ** 2)\n  \n          const newCenter = {\n            x: latestCurPoint.x - (latestCurPoint.x - symmetricPoint.x) / 2,\n            y: latestCurPoint.y + (symmetricPoint.y - latestCurPoint.y) / 2\n          }\n  \n          // 是否反向拉伸了\n          let isReverse = false\n          const angle = (info.rotate + 360) % 360\n          // 禁止反向拉伸\n          if (point === POINT_TYPE.T) {\n            if ((angle >= 0 && angle <= 90) || (angle >= 270 && angle <= 360)) {\n              if (latestCurPoint.y >= symmetricPoint.y) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.y <= symmetricPoint.y) {\n              isReverse = true\n            }\n          }\n          if (point === POINT_TYPE.B) {\n            if (angle >= 90 && angle <= 270) {\n              if (latestCurPoint.y >= symmetricPoint.y) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.y <= symmetricPoint.y) {\n              isReverse = true\n            }\n          }\n  \n          if (newHeight / scale > MIN_SIZE.height && !isReverse) {\n            layer.height = newHeight / scale\n            layer.position.y = (newCenter.y - (newHeight / 2)) / scale\n            layer.position.x = newCenter.x / scale - (layer.width / 2)\n          }\n          break\n        }\n  \n        case POINT_TYPE.L:\n        case POINT_TYPE.R: {\n          const newOriginCurPoint = calcRotatedCoords(curPoint, pointCenter, -info.rotate)\n  \n          const latestCurPoint = calcRotatedCoords({\n            x: newOriginCurPoint.x,\n            y: pointCenter.y\n          }, pointCenter, info.rotate)\n  \n          const newWidth = Math.sqrt((latestCurPoint.x - symmetricPoint.x) ** 2 + (latestCurPoint.y - symmetricPoint.y) ** 2)\n  \n          const newCenter = {\n            x: latestCurPoint.x - (latestCurPoint.x - symmetricPoint.x) / 2,\n            y: latestCurPoint.y + (symmetricPoint.y - latestCurPoint.y) / 2\n          }\n  \n          // 是否反向拉伸了\n          let isReverse = false\n          const angle = (info.rotate + 360) % 360\n          // 禁止反向拉伸\n          if (point === POINT_TYPE.L) {\n            if ((angle >= 0 && angle <= 90) || (angle >= 270 && angle <= 360)) {\n              if (latestCurPoint.x >= symmetricPoint.x) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.x <= symmetricPoint.x) {\n              isReverse = true\n            }\n          }\n          if (point === POINT_TYPE.R) {\n            if (angle >= 90 && angle <= 270) {\n              if (latestCurPoint.x >= symmetricPoint.x) {\n                isReverse = true\n              }\n            } else if (latestCurPoint.x <= symmetricPoint.x) {\n              isReverse = true\n            }\n          }\n  \n          if (newWidth / scale > MIN_SIZE.width && !isReverse) {\n            layer.width = newWidth / scale\n            layer.position.y = newCenter.y / scale - (layer.height / 2)\n            layer.position.x = (newCenter.x - (newWidth / 2)) / scale\n          }\n          break\n        }\n      }\n\n      if (layer.type === 'text') {\n        if (layer.height !== oldHeight && layer.scale) {\n          layer.scale *= layer.height / oldHeight\n        }\n      }\n\n      setLayer(layer)\n      setIsMoving(true)\n    }, () => {\n      setIsMoving(false)\n    })\n  }\n\n  // 调整大小\n  const resize = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    e.stopPropagation()\n    if (info.rotate === 0) {\n      resizeNormal(e, point)\n    } else {\n      resizeWithRotate(e, point)\n    }\n  }\n\n  // 旋转\n  const rotate = (e: MouseEvent<HTMLElement>) => {\n    e.stopPropagation()\n    const borderEl = (e.target as HTMLElement).closest('.border-control')\n    if (borderEl) {\n      const rect = borderEl.getBoundingClientRect()\n      const rotateCenterPoint = {\n        x: rect.left + rect.width / 2,\n        y: rect.top + rect.height / 2\n      }\n      new MouseEvents(e, ({ curCoords }: { curCoords: Coords }) => {\n        const offsetY = curCoords.y - rotateCenterPoint.y\n        const offsetX = curCoords.x - rotateCenterPoint.x\n        // 当前距离x轴的角度(x轴起逆时针方向至该边)\n        const angle = Math.atan2(offsetY, offsetX) * 180 / Math.PI\n\n        const idx = layers.findIndex(layer => layer.id === info.id)\n        const layer = cloneDeep(layers[idx])\n        layer.rotate = (angle - 90 + 360) % 360\n\n        setLayer(layer)\n        setIsMoving(true)\n      }, () => {\n        setIsMoving(false)\n      })\n    }\n  }\n\n  // 计算8个圆点的指针样式，按顺序分别为 左上（右下）、上（下）、右上（左下）、右（左）\n  const calcCursors = useCallback(() => {\n    let angle = info.rotate\n    if (angle < 0) {\n      angle += 360\n    }\n    const cursors: string[] = []\n    INIT_ANGLE.forEach((a) => {\n      const newAngle = (a + angle) % 360\n      const item = ANGLE_TO_CURSOR.find(i => i.start <= newAngle && i.end >= newAngle)\n      if (item) {\n        cursors.push(item.cursor)\n      }\n    })\n    setCursors(cursors)\n  }, [info.rotate])\n\n  useEffect(() => {\n    calcCursors()\n  }, [calcCursors])\n\n  return <BorderEl \n    style={{\n      width: info.width * scale,\n      height: info.height * scale,\n      transform: `translate(${info.position.x * scale}px, ${info.position.y * scale}px) rotate(${info.rotate}deg)`\n    }}\n    className={['border-control', isMoving ? 'moving' : ''].join(' ')}\n  >\n    {info.isLocked ?\n      <LockIcon icon={lockIcon} rotate={info.rotate} /> :\n      <>\n        <PointBR style={{ cursor: cursors[0] }} onMouseDown={e => resize(e, POINT_TYPE.BR)} />\n        {info.width * scale > 30 && info.height * scale > 30 && <>\n            <PointTL style={{ cursor: cursors[0] }} onMouseDown={e => resize(e, POINT_TYPE.TL)} />\n            <PointTR style={{ cursor: cursors[2] }} onMouseDown={e => resize(e, POINT_TYPE.TR)} />\n            <PointBL style={{ cursor: cursors[2] }} onMouseDown={e => resize(e, POINT_TYPE.BL)} />\n            <PointL style={{ cursor: cursors[3] }} onMouseDown={e => resize(e, POINT_TYPE.L)} />\n            <PointR style={{ cursor: cursors[3] }} onMouseDown={e => resize(e, POINT_TYPE.R)} />\n            { info.type !== 'text' && <PointT style={{ cursor: cursors[1] }} onMouseDown={e => resize(e, POINT_TYPE.T)} /> }\n            { info.type !== 'text' && <PointB style={{ cursor: cursors[1] }} onMouseDown={e => resize(e, POINT_TYPE.B)} /> }\n          </>\n        }\n        <RotateIcon className='rotate-point' icon={rotateIcon} onMouseDown={rotate} />\n      </>\n    }\n  </BorderEl>\n})\n\nconst BorderEl = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n\n  &.moving .rotate-point {\n    opacity: 0;\n  }\n\n  &.moving span {\n    opacity: 0;\n  }\n\n  &:after {\n    content: '';\n    position: absolute;\n    top: -1px;\n    left: -1px;\n    right: -1px;\n    bottom: -1px;\n    border: 2px solid #00c4cc;\n  }\n`\n\nconst Point = styled.span`\n  position: absolute;\n  display: block;\n  background: transparent;\n  z-index: 1;\n  pointer-events: auto;\n  width: 18px;\n  height: 18px;\n  user-select: none;\n  transition: opacity 200ms;\n\n  ::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    border-radius: 6px;\n    background: #fff;\n    box-shadow: 0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(53 71 90 / 20%);\n  }\n`\n\nconst PointTL = styled(Point)`\n  top: -9px;\n  left: -9px;\n  cursor: nwse-resize;\n`\n\nconst PointTR = styled(Point)`\n  top: -9px;\n  right: -9px;\n  cursor: nesw-resize;\n`\n\nconst PointBL = styled(Point)`\n  bottom: -9px;\n  left: -9px;\n  cursor: nesw-resize;\n`\n\nconst PointBR = styled(Point)`\n  bottom: -9px;\n  right: -9px;\n  cursor: nwse-resize;\n`\n\nconst PointT = styled(Point)`\n  width: calc(100% - 24px);\n  height: 12px;\n  top: -6px;\n  left: 12px;\n  cursor: ns-resize;\n\n  ::before {\n    width: 16px;\n    height: 4px;\n  }\n`\n\nconst PointB = styled(Point)`\n  width: calc(100% - 24px);\n  height: 12px;\n  bottom: -6px;\n  left: 12px;\n  cursor: ns-resize;\n\n  ::before {\n    width: 16px;\n    height: 4px;\n  }\n`\n\nconst PointL = styled(Point)`\n  width: 12px;\n  height: calc(100% - 24px);\n  top: 12px;\n  left: -6px;\n  cursor: ew-resize;\n\n  ::before {\n    width: 4px;\n    height: 16px;\n  }\n`\n\nconst PointR = styled(Point)`\n  width: 12px;\n  height: calc(100% - 24px);\n  top: 12px;\n  right: -6px;\n  cursor: ew-resize;\n\n  ::before {\n    width: 4px;\n    height: 16px;\n  }\n`\n\nconst RotateIcon = styled.div<{icon: string}>(\n  {\n    position: 'absolute',\n    left: '50%',\n    bottom: '-50px',\n    width: '20px',\n    height: '20px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    transform: 'translate(-50%, -50%)',\n    pointerEvents: 'auto',\n    borderRadius: '50%',\n    boxShadow: '0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(57 76 96 / 15%)',\n    userSelect: 'none',\n    cursor: 'grab'\n  },\n  props => ({\n    background: `#fff url(${props.icon}) no-repeat center / 18px 18px`\n  })\n)\n\nconst LockIcon = styled.div<{icon: string; rotate: number}>(\n  {\n    position: 'absolute',\n    right: '0',\n    bottom: '0',\n    width: '20px',\n    height: '20px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    pointerEvents: 'auto',\n    borderRadius: '50%',\n    boxShadow: '0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(57 76 96 / 15%)',\n    userSelect: 'none',\n    zIndex: '1'\n  },\n  props => ({\n    background: `#fff url(${props.icon}) no-repeat center / 13px 13px`,\n    transform: `translate(50%, 50%) rotate(${-props.rotate}deg)`\n  })\n)","export default __webpack_public_path__ + \"static/media/rotate.a7cc796d.svg\";","export default __webpack_public_path__ + \"static/media/lock.7263c59f.svg\";","import { useContext } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { Layer } from 'types';\nimport { ScaleContext } from 'store/context';\n\nexport default function HoverBorder ({ info }: { info: Layer; }) {\n  const scale = useContext(ScaleContext)\n\n  return <BorderEl \n    style={{\n      width: info.width * scale,\n      height: info.height * scale,\n      transform: `translate(${info.position.x * scale}px, ${info.position.y * scale}px) rotate(${info.rotate}deg)`\n    }}\n  />\n}\n\nconst BorderEl = styled.div`\nposition: absolute;\ntop: 0;\nleft: 0;\npointer-events: none;\n\n&:after {\n  content: '';\n  position: absolute;\n  top: -1px;\n  left: -1px;\n  right: -1px;\n  bottom: -1px;\n  border: 2px solid #00c4cc;\n}\n`","import { MouseEvent as MouseEventType, useContext } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport styled from \"@emotion/styled\";\nimport { Layer as LayerType } from 'types';\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport { MouseEvents } from 'utils/mouseEvent';\nimport { helpLine } from 'utils/helpLine'\nimport Border from \"./Border\";\nimport HoverBorder from \"./HoverBorder\";\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { cloneDeep } from \"lodash\";\n\n// 图层\nexport default observer(({ children, info }: { children: JSX.Element, info: LayerType }) => {\n  const scale = useContext(ScaleContext)\n  const { template, layers, setLayer, selectLayer, hoverLayer, isMoving, setIsMoving } = templateStore\n\n  // 设置背景选中状态\n  const { setIsSelectedBackground } = useContext(BackgroundContext)\n\n  // 辅助线\n  const { getRect: helpLineRect, init: initHelpLine, move: helpLinePipe } = helpLine()\n\n  // 更新图层位置\n  const updatePosition = ({ diff }: { diff: { x: number; y: number; } }) => {\n    const layer = cloneDeep(info)\n\n    const newPosition = helpLinePipe({\n      x: helpLineRect().x + diff.x / scale,\n      y: helpLineRect().y + diff.y / scale\n    })\n\n    layer.position = newPosition\n\n    setLayer(layer)\n    setIsMoving(true)\n  }\n\n  // 隐藏辅助线\n  const hideLine = () => {\n    const vLineEl = document.querySelector('#verticalLine') as HTMLElement\n    vLineEl.style.visibility = 'hidden'\n    const hLineEl = document.querySelector('#horizontalLine') as HTMLElement\n    hLineEl.style.visibility = 'hidden'\n    setIsMoving(false)\n  }\n\n  // 选中图层\n  const onSelectLayer = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    if (info.isEditing) return\n    selectLayer(info.id)\n    setIsSelectedBackground(false)\n    // 锁定了就不给拖动\n    if (info.isLocked) return\n    // 初始化拖拽事件\n    new MouseEvents(e, updatePosition, hideLine)\n    // 初始化辅助线数据\n    initHelpLine({\n      ...info.position,\n      width: info.width,\n      height: info.height,\n      rotate: info.rotate\n    }, info.id, layers, scale, { ...template.global })\n  }\n\n  // 鼠标移入图层\n  const onLayerMouseEnter = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    hoverLayer(info.id)\n  }\n\n  // 鼠标移出图层\n  const onLayerMouseOut = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    hoverLayer()\n  }\n\n  return <LayerWrapper\n    style={{\n      width: info.width,\n      height: info.height,\n      transform: `translate(${info.position.x}px, ${info.position.y}px) rotate(${info.rotate}deg)`,\n      zIndex: info.zIndex\n    }}\n    onMouseDown={onSelectLayer}\n    onMouseEnter={onLayerMouseEnter}\n    onMouseOut={onLayerMouseOut}\n    className={[isMoving ? 'moving' : '', info.isEditing ? 'edit' : ''].join(' ')}\n  >\n    {/* 图层内容 */}\n    <LayerContent style={{transform: `scale(${info.reverse?.x || 1}, ${info.reverse?.y || 1})`}}>\n      { children }\n    </LayerContent>\n    {/* 拖拽边框 */}\n    {info.isSelected && <TransportBorder>\n      <Border info={info} />\n    </TransportBorder>}\n    {/* 鼠标移入边框 */}\n    {!info.isSelected && !isMoving && info.isHover && <TransportBorder>\n      <HoverBorder info={info} />\n    </TransportBorder>}\n  </LayerWrapper>\n})\n\n// 传送门\nfunction TransportBorder ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#layerControl') as HTMLDivElement\n  )\n}\n\nconst LayerWrapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: auto;\n  user-select: none;\n  cursor: default;\n\n  &.moving {\n    cursor: all-scroll;\n  }\n\n  &.edit {\n    cursor: text;\n  }\n`\n\nconst LayerContent = styled.div`\n  width: 100%;\n  height: 100%;\n  transition: transform 250ms;\n`","import { Layer } from 'types';\n\ninterface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  rotate: number;\n}\n\ninterface RealRect extends Omit<Rect, 'rotate'> {}\n\ninterface Size {\n  width: number;\n  height: number;\n}\n\ninterface Coord {\n  x: number;\n  y: number;\n}\n\nexport function helpLine () {\n  // 当前图层位置信息\n  let rect: Rect = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n    rotate: 0\n  }\n\n  // 当前图层实际DOM的位置信息\n  let realRect: RealRect = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n  }\n\n  // 当前图层ID\n  let layerId = ''\n  // 所有的图层数据\n  let allLayers: Layer[] = []\n  // 缩放值\n  let scale = 1\n  // 画布尺寸\n  let canvasSize: Size = {\n    width: 0,\n    height: 0\n  }\n  // 吸附距离\n  let diff = 4\n\n  const vLineEl = document.querySelector('#verticalLine') as HTMLElement\n  const hLineEl = document.querySelector('#horizontalLine') as HTMLElement\n  let vType: 0 | 1 | 2 = 0 // 垂直线位置-0左1中2右\n  let hType: 0 | 1 | 2 = 0 // 水平线位置-0上1中2下\n\n  // 初始化数据\n  const init = (data: Rect, id: string, layers: Layer[], scl: number, size: Size) => {\n    rect = data\n    layerId = id\n    allLayers = layers\n    scale = scl\n    diff = 4 / scale\n    canvasSize = size\n\n    // 获取旋转后的真实元素位置信息\n    const rad = rect.rotate * Math.PI / 180\n    const newWidth = Math.abs(rect.width * Math.cos(rad)) + Math.abs(rect.height * Math.sin(rad))\n    const newHeight = Math.abs(rect.height * Math.cos(rad)) + Math.abs(rect.width * Math.sin(rad))\n    realRect.width = newWidth\n    realRect.height = newHeight\n    realRect.x = rect.x + (rect.width - newWidth) / 2\n    realRect.y = rect.y - (newHeight - rect.height) / 2\n  }\n\n  // 移动吸附\n  const move = ({ x, y }: Coord): Coord => {\n    rect.x = x\n    rect.y = y\n\n    const res: Coord = {\n      x: rect.x,\n      y: rect.y\n    }\n\n    // 更新真实元素位置信息\n    realRect.x = rect.x + (rect.width - realRect.width) / 2\n    realRect.y = rect.y - (realRect.height - rect.height) / 2\n\n    // 遍历所有图层，与当前图层两两对比\n    allLayers.forEach(l => {\n      // 获取其他图层真实的元素定位\n      const rad = l.rotate * Math.PI / 180\n      const newWidth = Math.abs(l.width * Math.cos(rad)) + Math.abs(l.height * Math.sin(rad))\n      const newHeight = Math.abs(l.height * Math.cos(rad)) + Math.abs(l.width * Math.sin(rad))\n      const newX = l.position.x + (l.width - newWidth) / 2\n      const newY = l.position.y - (newHeight - l.height) / 2\n\n      if (l.id !== layerId) {\n        // x 垂直线\n        vLineHandle(newX + newWidth, res) // 对象图层右\n        vLineHandle(newX + newWidth / 2, res) // 对象图层中\n        vLineHandle(newX, res) // 对象图层左\n\n        // y 水平线\n        hLineHandle(newY + newHeight, res) // 对象图层下\n        hLineHandle(newY + newHeight / 2, res) // 对象图层中\n        hLineHandle(newY, res) // 对象图层上\n      }\n    })\n\n    // 与画布对齐\n    // x 垂直线\n    vLineHandle(canvasSize.width, res) // 画布右\n    vLineHandle(canvasSize.width / 2, res) // 画布中\n    vLineHandle(0, res) // 画布左\n    // y 水平线\n    hLineHandle(canvasSize.height, res) // 画布下\n    hLineHandle(canvasSize.height / 2, res) // 画布中\n    hLineHandle(0, res) // 画布上\n\n    // 渲染辅助线DOM\n    renderLine(res)\n\n    return res\n  }\n\n  // 垂直线\n  const vLineHandle = (targetX: number, res: Coord) => {\n    // 右\n    if (Math.abs(targetX - (realRect.x + realRect.width)) <= diff) {\n      res.x = targetX - rect.width \n      res.x += (rect.width - realRect.width) / 2\n      vType = 2\n    }\n    // 中\n    if (Math.abs(targetX - (realRect.x + realRect.width / 2)) <= diff) {\n      res.x = targetX - rect.width / 2\n      vType = 1\n    }\n    // 左\n    if (Math.abs(targetX - realRect.x) <= diff) {\n      res.x = targetX\n      res.x -= (rect.width - realRect.width) / 2\n      vType = 0\n    }\n  }\n\n  // 水平线\n  const hLineHandle = (targetY: number, res: Coord) => {\n    // 下\n    if (Math.abs(targetY - (realRect.y + realRect.height)) <= diff) {\n      res.y = targetY - rect.height\n      res.y -= (realRect.height - rect.height) / 2\n      hType = 2\n    }\n    // 中\n    if (Math.abs(targetY - (realRect.y + realRect.height / 2)) <= diff) {\n      res.y = targetY - rect.height / 2\n      hType = 1\n    }\n    // 上\n    if (Math.abs(targetY - realRect.y) <= diff) {\n      res.y = targetY\n      res.y += (realRect.height - rect.height) / 2\n      hType = 0\n    }\n  }\n\n  // 渲染辅助线DOM\n  const renderLine = (res: Coord) => {\n    if (vLineEl && hLineEl) {\n      // TODO: 当前位置刚好在线上，条件不满足\n      if (res.x !== rect.x) {\n        let vLine = 0\n        if (vType === 0) vLine = res.x + (rect.width - realRect.width) / 2\n        if (vType === 1) vLine = res.x + rect.width / 2\n        if (vType === 2) vLine = res.x + (rect.width - realRect.width) / 2 + realRect.width\n        vLineEl.style.transform = `translateX(${vLine * scale}px)`\n        vLineEl.style.visibility = 'visible'\n      } else {\n        vLineEl.style.visibility = 'hidden'\n      }\n      if (res.y !== rect.y) {\n        let hLine = 0\n        if (hType === 0) hLine = res.y - (realRect.height - rect.height) / 2\n        if (hType === 1) hLine = res.y + rect.height / 2\n        if (hType === 2) hLine = res.y - (realRect.height - rect.height) / 2 + realRect.height\n        hLineEl.style.transform = `translateY(${hLine * scale}px)`\n        hLineEl.style.visibility = 'visible'\n      } else {\n        hLineEl.style.visibility = 'hidden'\n      }\n    }\n  }\n\n  const getRect = () => {\n    return rect\n  }\n\n  return {\n    getRect,\n    init,\n    move\n  }\n}","import 'quill/dist/quill.core.css';\nimport 'quill/dist/quill.snow.css';\nimport Quill from 'quill';\nimport { observer } from 'mobx-react';\nimport styled from \"@emotion/styled\";\nimport { FontStyle } from 'types';\nimport { Layer } from 'types';\nimport { useCallback, useEffect, useRef, useState, useContext } from 'react';\nimport { templateStore } from 'store/template';\nimport { cloneDeep } from 'lodash';\nimport { ScaleContext } from 'store/context';\n\nexport default observer(({ layer }: { layer: Layer }) => {\n  const editorRef = useRef<HTMLDivElement>(null)\n\n  const { editTextLayer, setLayer, needUpdateLayerHeight, setNeedUpdateLayerHeight, isMoving } = templateStore\n  const scale = useContext(ScaleContext)\n\n  // quill实例\n  let [editor, setEditor] = useState<Quill | null>(null)\n\n  // 画布的DOM信息\n  const canvasRect = (document.querySelector('#textControl') as HTMLElement)?.getBoundingClientRect()\n\n  // 文本内容变化\n  const onTextChange = useCallback(() => {\n    if (editor) {\n      const _layer = cloneDeep(layer)\n      const text = editor.getText()\n      _layer.source.content = text\n\n      if (editorRef.current) {\n        // 文本换行了，更新图层最新高度和位置\n        const rect = editorRef.current.getBoundingClientRect()\n        const rad = (layer.rotate % 180) * Math.PI / 180\n        const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n        // 高度不一致表示换行/减行\n        if (newHeight / scale !== layer.height) {\n          _layer.height = newHeight / scale\n\n          const center = {\n            x: rect.left + rect.width / 2 - canvasRect.left,\n            y: rect.top + rect.height / 2 - canvasRect.top\n          }\n          const newX = center.x / scale - (layer.width / 2)\n          const newY = (center.y - (newHeight / 2)) / scale\n\n          _layer.position = {\n            x: newX,\n            y: newY\n          }\n        }\n      }\n      setLayer(_layer)\n    }\n  }, [editor, layer, setLayer, scale, canvasRect])\n\n  // 字体大小改变了，高度也要更新\n  useEffect(() => {\n    if (needUpdateLayerHeight && editorRef.current) {\n      const _layer = cloneDeep(layer)\n      const rect = editorRef.current.getBoundingClientRect()\n      const rad = (layer.rotate % 180) * Math.PI / 180\n      const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n      // 高度不一致表示换行/减行\n      if (newHeight / scale !== layer.height) {\n        _layer.height = newHeight / scale\n\n        const center = {\n          x: rect.left + rect.width / 2 - canvasRect.left,\n          y: rect.top + rect.height / 2 - canvasRect.top\n        }\n        const newX = center.x / scale - (layer.width / 2)\n        const newY = (center.y - (newHeight / 2)) / scale\n\n        _layer.position = {\n          x: newX,\n          y: newY\n        }\n        setLayer(_layer)\n      }\n      setNeedUpdateLayerHeight(false)\n    }\n  }, [canvasRect, layer, needUpdateLayerHeight, scale, setLayer, setNeedUpdateLayerHeight])\n\n  // 拖拽改变文本框宽度时，更新图层最新高度\n  // TODO: 位置会偏移\n  useEffect(() => {\n    // isMoving表示拖拽\n    if (isMoving && editorRef.current) {\n      const rect = editorRef.current.getBoundingClientRect()\n      const rad = (layer.rotate % 180) * Math.PI / 180\n      const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n      // 高度不一致表示换行/减行\n      if (Math.abs(newHeight / scale - layer.height) > 1) {\n        const _layer = cloneDeep(layer)\n        _layer.height = newHeight / scale\n        setLayer(_layer)\n      }\n    }\n  }, [layer, scale, isMoving, canvasRect, setLayer])\n\n  // 进入编辑状态\n  const onEditText = () => {\n    editTextLayer(layer.id)\n  }\n\n  // 初始化quill实例\n  useEffect(() => {\n    if (editorRef.current && !editor) {\n      const instance = new Quill(editorRef.current)\n      setEditor(instance)\n    }\n  }, [editor])\n\n  // 设置文本内容\n  useEffect(() => {\n    if (editor && layer.source.content && editor.getText() !== layer.source.content) {\n      editor.setText(layer.source.content)\n    }\n  }, [editor, layer.source.content])\n\n  // 设置编辑状态\n  useEffect(() => {\n    if (editor) {\n      editor.enable(layer.isEditing)\n      layer.isEditing && editor.setSelection(0, 1000)\n    }\n  }, [editor, layer.isEditing])\n\n  useEffect(() => {\n    if (editor) {\n      editor.on('text-change', onTextChange)\n    }\n    return () => {\n      editor?.off('text-change', onTextChange)\n    }\n  }, [editor, onTextChange])\n\n  return <TextWrapper\n    style={{\n      transform: `scale(${layer.scale})`,\n      width: `${layer.width / (layer.scale || 1)}px`,\n      height: `${layer.height / (layer.scale || 1)}px`\n    }}\n  >\n    <Text\n      data={layer.style as FontStyle}\n      onDoubleClick={onEditText}\n    >\n      <Editor ref={editorRef} spellCheck=\"false\" />\n    </Text>\n  </TextWrapper>\n})\n\nconst TextWrapper = styled.div`\n  transform-origin: 0 0;\n`\n\nconst Text = styled.div<{data: FontStyle}>(\n  {},\n  props => ({\n    fontFamily: `\"${props.data.font}\"`,\n    fontSize: props.data.fontSize,\n    color: props.data.color,\n    lineHeight: props.data.lineHeight,\n    textAlign: props.data.textAlign,\n    fontWeight: props.data.fontWeight,\n    textDecorationLine: props.data.underline ? 'underline' : 'none'\n  })\n)\n\nconst Editor = styled.div`\n  font-family: inherit;\n  font-size: inherit;\n\n  .ql-editor {\n    padding: 0;\n    overflow: visible;\n    font-family: inherit;\n    line-height: inherit;\n    text-align: inherit;\n    white-space: break-spaces;\n    /* user-select: text; */\n    line-break: anywhere;\n\n    &>* {\n      cursor: inherit;\n    }\n  }\n`","import React, { useContext, MouseEvent } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport Layer from './layer/Layer';\nimport { LAYER_TYPE } from 'types'\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport TextEditor from './layer/TextEditor';\nimport { createPortal } from \"react-dom\";\n\ninterface Props {\n  width: number;\n  height: number;\n  scale: number;\n}\n\n// 画布\nexport default observer(() => {\n  const { template, resetSelectStatus, setLayerType } = templateStore\n  const { global, background } = template\n\n  const scale = useContext(ScaleContext)\n  const {isSelectedBackground, setIsSelectedBackground} = useContext<{\n    isSelectedBackground: boolean;\n    setIsSelectedBackground: React.Dispatch<React.SetStateAction<boolean>>\n  }>(BackgroundContext)\n\n  // 选中背景\n  const selectBackground = (e: MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation()\n    setIsSelectedBackground(true)\n    resetSelectStatus()\n    setLayerType(LAYER_TYPE.BACKGROUND)\n  }\n\n  return <Wrapper width={global.width} height={global.height} scale={scale}>\n    <CanvasContent width={global.width} height={global.height} scale={scale}>\n      <Background color={background.color} onClick={selectBackground} />\n      {\n        template.layers.map(layer => {\n          // 图片\n          if (layer.type === 'image') {\n            return <Layer key={layer.id} info={layer}>\n              <Image src={toJS(layer.source.imageUrl)} draggable=\"false\" />\n            </Layer>\n          }\n          // 文字\n          if (layer.type === 'text') {\n            return layer.isEditing ?\n            <TransportEditor key={layer.id}>\n              <Layer info={layer}>\n                <TextEditor layer={toJS(layer)} />\n              </Layer>\n            </TransportEditor>\n            :\n            <Layer key={layer.id} info={layer}>\n              <TextEditor layer={toJS(layer)} />\n            </Layer>\n          }\n          return <></>\n        })\n      }\n    </CanvasContent>\n    {/* 编辑框传送点 */}\n    <LayerControl id=\"layerControl\" width={global.width} height={global.height} scale={scale}>\n        {isSelectedBackground && <BackgroundBorder />}\n        {/* 垂直辅助线 */}\n        <VLine id=\"verticalLine\" />\n        {/* 水平辅助线 */}\n        <HLine id=\"horizontalLine\" />\n    </LayerControl>\n    {/* 点前编辑的文本传送点 */}\n    <TextControl id=\"textControl\" width={global.width} height={global.height} scale={scale} />\n  </Wrapper>\n})\n\n// 传送门\nfunction TransportEditor ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#textControl') as HTMLDivElement\n  )\n}\n\nconst Image = styled.img`\n  width: 100%;\n  height: 100%;\n`\n\nconst Background = styled.div<{ color: string; }>(\n  {\n    position: 'relative',\n    zIndex: -1,\n    width: '100%',\n    height: '100%'\n  },\n  props => ({\n    backgroundColor: props.color\n  })\n)\n\nconst Wrapper = styled.div<Props>(\n  {\n    flex: 'none',\n    position: 'relative',\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    margin: 'auto',\n    pointerEvents: 'none'\n  },\n  props => ({\n    width: props.width * props.scale + 100,\n    height: props.height * props.scale + 100\n  })\n)\n\nconst CanvasContent = styled.div<Props>(\n  {\n    flex: 'none',\n    position: 'relative',\n    overflow: 'hidden',\n    backgroundColor: '#fff',\n    userSelect: 'none',\n    pointerEvents: 'auto'\n  },\n  props => ({\n    width: props.width,\n    height: props.height,\n    transform: `scale(${props.scale})`\n  })\n)\n\nconst TextControl = styled(CanvasContent)`\n  position: absolute;\n  top: 50;\n  left: 50;\n  z-index: 1;\n  pointer-events: none;\n  overflow: visible;\n  background-color: transparent;\n`\n\nconst LayerControl = styled.div<Props>(\n  {\n    position: 'absolute',\n    top: 50,\n    left: 50,\n    zIndex: 2,\n    pointerEvents: 'none'\n  },\n  props => ({\n    width: props.width * props.scale,\n    height: props.height * props.scale\n  })\n)\n\nconst BackgroundBorder = styled.div`\n  position: absolute;\n  top: -1px;\n  left: -1px;\n  right: -1px;\n  bottom: -1px;\n  border: 2px solid #00c4cc;\n  background: transparent;\n  pointer-events: none;\n`\n\nconst VLine = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 0;\n  height: 100%;\n  border-left: 1px dashed #c228ff;\n  visibility: hidden;\n  z-index: 2;\n`\n\nconst HLine = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 0;\n  border-top: 1px dashed #c228ff;\n  visibility: hidden;\n  z-index: 2;\n`","\n// 预设字体列表\nexport const FONT_LIST: Array<{\n  name: string;\n  value: string\n}> = [\n  {\n    name: '宋体',\n    value: 'SimSun'\n  },\n  {\n    name: '黑体',\n    value: 'SimHei'\n  },\n  {\n    name: '微软雅黑',\n    value: 'Microsoft Yahei'\n  },\n  {\n    name: '楷体',\n    value: 'KaiTi'\n  },\n  {\n    name: '华文楷体',\n    value: 'STKaiti'\n  },\n  {\n    name: '翩翩体-简',\n    value: 'Hanzipen SC'\n  },\n  {\n    name: '娃娃体-简',\n    value: 'Wawati SC'\n  },\n  {\n    name: '圆体-简',\n    value: 'Yuanti SC'\n  },\n  {\n    name: '兰亭黑-简',\n    value: 'Lantinghei SC'\n  }\n]\n\n// 字体大小\nexport const FONTSIZE_LIST = [6,8,10,12,14,16,18,20,22,24,28,32,36,42,48,56,64,72,80,88,96,104,120,144]\n\nexport const CANVAS_SIZE_LIST = [\n  {\n    width: 1280,\n    height: 720,\n    label: '1280px × 720px',\n    value: '1'\n  },\n  {\n    width: 720,\n    height: 1280,\n    label: '720px × 1280px',\n    value: '2'\n  },\n  {\n    width: 1024,\n    height: 768,\n    label: '1024px × 768px',\n    value: '3'\n  },\n  {\n    width: 768,\n    height: 1024,\n    label: '768px × 1024px',\n    value: '4'\n  },\n  {\n    width: 1920,\n    height: 1080,\n    label: '1920px × 1080px',\n    value: '5'\n  },\n]","import styled from \"@emotion/styled\";\nimport { observer } from 'mobx-react';\nimport { templateStore } from 'store/template'\nimport { LAYER_TYPE, Align } from 'types'\nimport {\n  Popover,\n  Select,\n  Dropdown,\n  Menu,\n  Slider,\n  Popconfirm,\n  Radio,\n  Space,\n  InputNumber,\n  RadioChangeEvent\n} from 'antd';\nimport {\n  DeleteOutlined,\n  AlignLeftOutlined,\n  AlignCenterOutlined,\n  AlignRightOutlined,\n  SwapOutlined,\n  BoldOutlined,\n  UnderlineOutlined,\n  LockOutlined,\n  UnlockOutlined\n} from '@ant-design/icons';\nimport { ChromePicker, ColorResult } from 'react-color';\nimport { cloneDeep, isNumber } from \"lodash\";\nimport { FONT_LIST, FONTSIZE_LIST, CANVAS_SIZE_LIST } from 'utils/const'\nimport { useEffect, useState } from \"react\";\n\nconst { Option } = Select;\n\nexport default observer(() => {\n  const {\n    template,\n    layerType,\n    layers,\n    setCanvasSize,\n    setLayer,\n    setLayers,\n    setLayerLevel,\n    removeLayer,\n    setLayerLock,\n    setBackgroundColor,\n    setNeedUpdateLayerHeight\n  } = templateStore\n\n  const [selectValue, setSelectValue] = useState('1')\n\n  const activeLayer = layers.find(l => l.isSelected)\n  const layerScale = activeLayer?.scale || 1\n\n  // 当前颜色\n  let color = ''\n  if (layerType === LAYER_TYPE.TEXT) {\n    color = activeLayer?.style?.color || ''\n  } else if (layerType === LAYER_TYPE.BACKGROUND) {\n    color = template.background.color\n  }\n\n  // 当前字体\n  const font = activeLayer?.style?.font || ''\n  // 当前字体\n  const fontSize = activeLayer?.style?.fontSize || 0\n  // 文字水平对齐\n  const textAlign = activeLayer?.style?.textAlign || 'left'\n  // 当前字体粗细\n  const fontWeight = activeLayer?.style?.fontWeight || 400\n  // 当前字体是否有下划线\n  const hasUnderline = activeLayer?.style?.underline || false\n  \n  // 图层是否被锁定了\n  const isLocked = activeLayer?.isLocked || false\n  // 图层的层级关系\n  const levelInfo = {\n    min: 1,\n    max: 100,\n    current: 1\n  }\n  if (activeLayer) {\n    levelInfo.current = layers.findIndex(l => l.id === activeLayer.id) + 1\n    levelInfo.max = layers.length\n  }\n\n  const canvasWidth = template.global.width\n  const canvasHeight = template.global.height\n\n  useEffect(() => {\n    const res = CANVAS_SIZE_LIST.find(i => i.width === canvasWidth && i.height === canvasHeight && i.value !== selectValue)\n    if (res) {\n      setSelectValue(res.value)\n    } else if (selectValue !== '6') {\n      setSelectValue('6')\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // 选择颜色\n  const onColorChange = (clr: ColorResult) => {\n    const rgba = `rgba(${clr.rgb.r}, ${clr.rgb.g}, ${clr.rgb.b}, ${clr.rgb.a})`\n    // 文本\n    if (layerType === LAYER_TYPE.TEXT) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.type === 'text' && layer.style) {\n        layer.style.color = rgba\n        setLayer(layer)\n      }\n    }\n    // 背景\n    if (layerType === LAYER_TYPE.BACKGROUND) {\n      setBackgroundColor(rgba)\n    }\n  }\n\n  // 选择字体\n  const onFontChange = (val: string) => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.font = val\n      setLayer(layer)\n    }\n  }\n\n  // 改变字体大小\n  const onFontsizeChange = (val: string) => {\n    const size = Number(val)\n    if (!isNaN(size)) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.type === 'text' && layer.style) {\n        layer.style.fontSize = size / layerScale\n        setLayer(layer)\n        setNeedUpdateLayerHeight(true)\n      }\n    }\n  }\n\n  // 改变字体粗细\n  const onWeightChange = () => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.fontWeight = layer.style.fontWeight === 700 ? 400 : 700\n      setLayer(layer)\n    }\n  }\n\n  // 设置下划线\n  const onUnderlineChange = () => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.underline = !layer.style.underline\n      setLayer(layer)\n    }\n  }\n\n  // 改变文本水平对齐\n  const onTextAlignChange = () => {\n    let align: Align = 'left'\n    if (textAlign === 'left') align = 'center'\n    if (textAlign === 'center') align = 'right'\n    if (textAlign === 'right') align = 'left'\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.textAlign = align\n      setLayer(layer)\n    }\n  }\n\n  // 翻转图片\n  const onReverseImage = (direction: 'x' | 'y') => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.reverse) {\n      if (direction === 'x') {\n        layer.reverse.x = layer.reverse.x === 1 ? -1 : 1\n      }\n      if (direction === 'y') {\n        layer.reverse.y = layer.reverse.y === 1 ? -1 : 1\n      }\n      setLayer(layer)\n    }\n  }\n\n  // 改变层级\n  const onLevelChange = (val: number) => {\n    // 下 -> 上\n    if (val > levelInfo.current) {\n      layers.forEach((l, idx) => {\n        if (idx + 1 > levelInfo.current && idx + 1 <= val) {\n          setLayerLevel(l.id, l.zIndex - 1)\n        }\n      })\n      activeLayer && setLayerLevel(activeLayer.id, activeLayer.zIndex + (val - levelInfo.current))\n    } else { // 上 -> 下\n      layers.forEach((l, idx) => {\n        if (idx + 1 >= val && idx + 1 < levelInfo.current) {\n          setLayerLevel(l.id, l.zIndex + 1)\n        }\n      })\n      activeLayer && setLayerLevel(activeLayer.id, activeLayer.zIndex - (levelInfo.current - val))\n    }\n    setLayers(cloneDeep(layers).sort((a, b) => a.zIndex - b.zIndex))\n  }\n\n  // 切换图层锁定状态\n  const onToggleLayerLock = () => {\n    if (activeLayer) {\n      setLayerLock(activeLayer.id, !activeLayer.isLocked)\n    }\n  }\n\n  // 删除图层\n  const onRemove = () => {\n    const layer = layers.find(layer => layer.isSelected)\n    if (layer) {\n      removeLayer(layer.id)\n    }\n  }\n\n  // 清空画布\n  const onClear = () => {\n    setLayers([])\n  }\n\n  // 选择画布尺寸\n  const onCanvasSizeChange = (e: RadioChangeEvent) => {\n    setSelectValue(e.target.value)\n    const res = CANVAS_SIZE_LIST.find(i => i.value === e.target.value)\n    if (res) {\n      setCanvasSize({\n        width: res.width,\n        height: res.height\n      })\n    }\n  }\n\n  // 画布宽度修改\n  const onChangeWidth = (val: number) => {\n    if (isNumber(val) && val > 0) {\n      setCanvasSize({\n        width: val,\n        height: canvasHeight\n      })\n    }\n  }\n\n  // 画布高度修改\n  const onChangeHeight = (val: number) => {\n    if (isNumber(val) && val > 0) {\n      setCanvasSize({\n        width: canvasWidth,\n        height: val\n      })\n    }\n  }\n\n  // 画布尺寸列表\n  const CanvasSizeOptions = (\n    <>\n      <Radio.Group onChange={onCanvasSizeChange} value={selectValue}>\n        <Space direction=\"vertical\">\n          {CANVAS_SIZE_LIST.map(i => <Radio key={i.value} value={i.value}>{i.label}</Radio>)}\n          <Radio value={'6'}>\n            自定义\n            {selectValue === '6' ? <div style={{ marginTop: 10 }}>\n              <InputNumber value={canvasWidth} size=\"small\" placeholder=\"宽\" style={{ width: 100, marginRight: 10 }} onChange={onChangeWidth} />×\n              <InputNumber value={canvasHeight} size=\"small\" placeholder=\"高\" style={{ width: 100, marginLeft: 10, marginRight: 10 }} onChange={onChangeHeight} /> 像素\n            </div> : null}\n          </Radio>\n        </Space>\n      </Radio.Group>\n    </>\n  )\n\n  return <ToolBarWrapper>\n    <ItemGroup className={isLocked ? 'locked' : ''}>\n      {/* 画布尺寸 */}\n      {[LAYER_TYPE.EMPTY].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={CanvasSizeOptions}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <span className=\"text\">画布尺寸</span>\n          </Popover>\n        </ToolItem>\n      }\n      {/* 颜色 */}\n      {[LAYER_TYPE.BACKGROUND, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={<ChromePicker color={color} onChange={onColorChange} />}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <ColorItem style={{ backgroundColor: color }} />\n          </Popover>\n        </ToolItem>\n      }\n      {/* 字体 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Select\n            value={font}\n            style={{ width: 140 }}\n            placeholder=\"选择字体\"\n            onChange={onFontChange}\n          >\n            {FONT_LIST.map(f => <Option key={f.value} value={f.value}><span style={{ fontFamily: f.value }}>{f.name}</span></Option>)}\n          </Select>\n        </ToolItem>\n      }\n      {/* 字体大小 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Select\n            value={(fontSize * layerScale).toFixed(0)}\n            style={{ width: 100, textAlign: 'center' }}\n            placeholder=\"字体大小\"\n            onChange={onFontsizeChange}\n          >\n            {FONTSIZE_LIST.map(size => <Option key={size} value={size}>{size}</Option>)}\n          </Select>\n        </ToolItem>\n      }\n      {/* 加粗 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem className={fontWeight === 700 ? 'active' : ''} onClick={onWeightChange}>\n          <BoldOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 下划线 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem className={hasUnderline ? 'active' : ''} onClick={onUnderlineChange}>\n          <UnderlineOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 水平对齐 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem onClick={onTextAlignChange}>\n          {textAlign === 'left' && <AlignLeftOutlined style={{ fontSize: 24 }} />}\n          {textAlign === 'center' && <AlignCenterOutlined style={{ fontSize: 24 }} />}\n          {textAlign === 'right' && <AlignRightOutlined style={{ fontSize: 24 }} />}\n        </ToolItem>\n      }\n      {/* 图片翻转 */}\n      {[LAYER_TYPE.IMAGE].includes(layerType) &&\n        <ToolItem>\n          <Dropdown \n            overlay={\n              <Menu style={{ width: 120 }}>\n                <Menu.Item\n                  key=\"x\"\n                  style={{ padding: '10px' }}\n                  icon={<SwapOutlined />}\n                  onClick={() => onReverseImage('x')}\n                >\n                  水平翻转\n                </Menu.Item>\n                <Menu.Item\n                  key=\"y\"\n                  style={{ padding: '10px' }}\n                  icon={<SwapOutlined style={{ transform: 'rotate(90deg)' }} />}\n                  onClick={() => onReverseImage('y')}\n                >\n                  垂直翻转\n                </Menu.Item>\n              </Menu>\n            }\n            trigger={['click']}\n          >\n            <span className=\"text\">翻转</span>\n          </Dropdown>\n        </ToolItem>\n      }\n    </ItemGroup>\n    <ItemGroup className={isLocked ? 'locked' : ''}>\n      {/* 图层层级 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={\n              <Slider\n                value={levelInfo.current}\n                min={levelInfo.min}\n                max={levelInfo.max}\n                style={{ width: 180 }}\n                onChange={onLevelChange}\n              />\n            }\n            trigger=\"click\"\n            placement=\"bottomRight\"\n          >\n            <span className=\"text\">层级调整</span>\n          </Popover>\n        </ToolItem>\n      }\n      {/* 图层锁定 */}\n      {[LAYER_TYPE.TEXT, LAYER_TYPE.IMAGE].includes(layerType) &&\n        <ToolItem className={[\"item-lock\", isLocked ? 'active' : ''].join(' ')} onClick={onToggleLayerLock}>\n          {isLocked ? <LockOutlined style={{ fontSize: 24 }} /> : <UnlockOutlined style={{ fontSize: 24 }} />}\n        </ToolItem>\n      }\n      {/* 删除 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem onClick={onRemove}>\n          <DeleteOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 清空画布 */}\n      {[LAYER_TYPE.EMPTY].includes(layerType) &&\n        <ToolItem>\n          <Popconfirm\n            placement=\"bottomRight\"\n            title=\"确定清空画布？\"\n            onConfirm={onClear}\n            okText=\"清空\"\n            cancelText=\"取消\"\n          >\n            <span className=\"text\">清空画布</span>\n          </Popconfirm>\n        </ToolItem>\n      }\n    </ItemGroup>\n  </ToolBarWrapper>\n})\n\nconst ToolBarWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  height: 46px;\n  padding: 0 10px;\n  background-color: #fff;\n  border-bottom: 1px solid #ddd;\n  user-select: none;\n`\n\nconst ItemGroup = styled.div`\n  display: flex;\n  align-items: center;\n\n  &.locked>div:not(.item-lock) {\n    display: none;\n  }\n`\n\nconst ToolItem = styled.div`\n  display: flex;\n  align-items: center;\n  margin-right: 10px;\n  padding: 4px;\n  border-radius: 4px;\n  cursor: pointer;\n\n  &.active {\n    background-color: rgba(57,76,96,.15);\n  }\n\n  &:hover {\n    background-color: rgba(64,87,109,.07);\n  }\n\n  .text {\n    padding: 0 10px;\n    font-size: 16px;\n  }\n\n  input[type=\"search\"] {\n    text-align: center;\n  }\n`\n\nconst ColorItem = styled.div`\n  width: 28px;\n  height: 28px;\n  border: 2px solid #666;\n  border-radius: 4px;\n`","import React, { MouseEvent, useCallback, useEffect, useRef, useState } from \"react\";\nimport styled from \"@emotion/styled\";\nimport Footer from \"./Footer\";\nimport Canvas from \"./Canvas\";\nimport ToolBar from \"./tool-bar/Index\"\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { Layer } from 'types'\nimport { cloneDeep } from \"lodash\";\nimport undoRedo from 'utils/undoRedo';\n\nconst { undo, redo } = undoRedo()\n\n// 暂存复制的图层\nlet copyLayer: Partial<Layer> = {}\n\n// 编辑器\nexport default observer(() => {\n  // 画布缩放值\n  const [scale, setScale] = useState(1)\n  // 画布父级容器dom ref\n  const canvasWrapperRef = useRef<HTMLDivElement>(null)\n  // 获取模板数据\n  const { template, resetSelectStatus, removeLayer, addLayer } = templateStore\n\n  // 是否选中背景\n  const [isSelectedBackground, setIsSelectedBackground] = useState(false)\n\n  // 首次渲染画布尺寸适配\n  useEffect(() => {\n    const wrapperEl = canvasWrapperRef.current\n    const canvasWidth = template.global.width\n    const canvasHeight = template.global.height\n    let scale = 1\n    if (wrapperEl && wrapperEl.clientWidth < canvasWidth + 100) {\n      scale = (wrapperEl.clientWidth - 100) / canvasWidth\n    }\n    if (wrapperEl && wrapperEl.clientHeight < (canvasHeight * scale + 100)) {\n      scale = (wrapperEl.clientHeight - 100) / canvasHeight\n    }\n    setScale(scale)\n  }, [template.global.width, template.global.height])\n\n  // 键盘事件监听\n  const onKeyboardListener = useCallback((e: KeyboardEvent) => {\n    // 页面失焦\n    if (document.activeElement === document.body || document.activeElement === null) {\n      // 删除\n      if (e.key === 'Backspace' || e.key === 'Delete') {\n        const layer = template.layers.find(layer => layer.isSelected)\n        if (layer) {\n          removeLayer(layer.id)\n        }\n      }\n      // 复制\n      if (e.key === 'c' && (e.metaKey || e.ctrlKey)) {\n        const layer = template.layers.find(layer => layer.isSelected)\n        if (layer && !template.layers.some(l => l.isEditing)) {\n          copyLayer = cloneDeep(layer)\n        }\n      }\n      // 粘贴\n      if (e.key === 'v' && (e.metaKey || e.ctrlKey)) {\n        if (!template.layers.some(l => l.isEditing)) {\n          if (copyLayer) {\n            copyLayer.position && (copyLayer.position.x += 10)\n            copyLayer.position && (copyLayer.position.y += 10)\n            copyLayer.id = String(Date.now())\n            copyLayer.zIndex = template.layers.length ? template.layers[template.layers.length - 1].zIndex + 1 : 1\n            resetSelectStatus()\n            addLayer(copyLayer as Layer)\n          }\n        }\n      }\n      // 撤销\n      if (e.key === 'z' && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n        undo()\n      }\n      // 重做\n      if (e.key === 'z' && (e.metaKey || e.ctrlKey) && e.shiftKey) {\n        redo()\n      }\n    }\n  }, [addLayer, removeLayer, resetSelectStatus, template.layers])\n\n  useEffect(() => {\n    document.addEventListener('keydown', onKeyboardListener)\n    return () => { document.removeEventListener('keydown', onKeyboardListener) }\n  }, [onKeyboardListener])\n\n  // 取消所有图层的选中状态包括背景\n  const resetStatus = (e: MouseEvent<HTMLElement>) => {\n    // self\n    if ((e.target as HTMLElement).id === 'CanvasWrapper') {\n      resetSelectStatus()\n      setIsSelectedBackground(false)\n    }\n  }\n\n  return <Wrapper>\n    <ToolBar />\n    <CanvasWrapper ref={canvasWrapperRef} id=\"CanvasWrapper\" onMouseDown={resetStatus}>\n      <BackgroundContext.Provider value={{ isSelectedBackground, setIsSelectedBackground }}>\n        <ScaleContext.Provider value={scale}>\n          <Canvas />\n        </ScaleContext.Provider>\n      </BackgroundContext.Provider>\n    </CanvasWrapper>\n    <Footer scale={scale} setScale={(num) => setScale(num)} />\n  </Wrapper>\n})\n\nconst Wrapper = styled.div`\n  position: relative;\n  flex: 1;\n  overflow: hidden;\n`\n\nconst CanvasWrapper = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: calc(100% - 88px);\n  overflow: scroll;\n\n  ::-webkit-scrollbar {\n    width: 8px;\n    background: #eef2f8;\n\n    &:horizontal {\n      height: 8px;\n    }\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #eef2f8;\n  }\n\n  ::-webkit-scrollbar-corner {\n    background: #eef2f8;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #c4c4c4;\n    border: 8px solid rgba(0, 0, 0, 0);\n    border-radius: 9999px;\n\n    &:hover {\n      background: #adadad;\n    }\n  }\n`","import React from \"react\";\nimport styled from \"@emotion/styled\";\nimport Sidebar from \"./side-bar/Sidebar\";\nimport Editor from \"./Editor\";\n\nexport default function Main () {\n  return <MainBody>\n    <Sidebar />\n    <Editor />\n  </MainBody>\n}\n\nconst MainBody = styled.main`\n  display: flex;\n  height: calc(100vh - 56px);\n  background-color: #eef2f8;\n  overflow: hidden;\n`\n","import React from 'react';\nimport Nav from 'components/Nav'\nimport Main from 'components/Main'\nimport './App.css';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Nav />\n      <Main />\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from 'pages/App';\nimport reportWebVitals from './reportWebVitals';\nimport 'antd/dist/antd.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}