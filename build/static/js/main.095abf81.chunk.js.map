{"version":3,"sources":["utils/index.ts","components/Nav.tsx","assets/logo.png","services/base.ts","types/index.ts","utils/initData.ts","utils/undoRedo.ts","store/template.ts","components/side-bar/ImageItem.tsx","components/side-bar/TextItem.tsx","components/side-bar/Shapes.tsx","components/side-bar/UploadImage.tsx","components/side-bar/Sidebar.tsx","services/common.ts","components/Footer.tsx","assets/undo.png","assets/redo.png","store/context.ts","utils/mouseEvent.ts","utils/resizeLayer.ts","utils/clipImage.ts","assets/rotate.svg","assets/lock.svg","components/layer/Border.tsx","components/layer/HoverBorder.tsx","components/layer/Layer.tsx","utils/helpLine.ts","components/layer/TextEditor.tsx","components/layer/Image.tsx","assets/resize.svg","components/ClipImage.tsx","components/layer/shapes/Rect.tsx","components/layer/shapes/Circle.tsx","components/Canvas.tsx","assets/opacity.svg","assets/border-weight.svg","assets/border-style.svg","utils/const.ts","components/tool-bar/Index.tsx","components/Editor.tsx","components/Main.tsx","pages/App.tsx","reportWebVitals.ts","index.tsx"],"names":["getCenterCoords","p1","p2","x","y","calcRotatedCoords","point","center","rotate","Math","PI","cos","sin","getCoverImage","selector","a","el","document","querySelector","copyEl","cloneNode","style","transform","position","left","body","appendChild","querySelectorAll","forEach","img","setAttribute","opt","width","offsetWidth","height","offsetHeight","backgroundColor","useCORS","Promise","resolve","reject","html2canvas","then","canvas","res","toDataURL","catch","e","finally","removeChild","Nav","useState","loading","setLoading","exportImage","url","createElement","href","Date","now","click","remove","console","error","Header","Img","src","type","onClick","styled","header","service","axios","create","baseURL","timeout","interceptors","response","use","data","LAYER_TYPE","POINT_TYPE","defaultTemplate","global","background","color","layers","id","reverse","source","imageUrl","opacity","zIndex","content","font","fontSize","lineHeight","textAlign","fontWeight","underline","historyCache","pointer","isUndoOrRedo","undoRedo","setCanUseUndo","templateStore","setCanUseRedo","init","template","push","pushHistory","_template","cloneDeep","map","l","isSelected","isEditing","isHover","splice","length","shift","undo","setTemplate","setLayerType","EMPTY","redo","Object","assign","layer","isLocked","scale","localTemplateCache","localStorage","getItem","JSON","parse","observable","layerType","needUpdateLayerHeight","isMoving","canUseUndo","canUseRedo","this","getTemplate","clip","pre","val","setCanvasSize","size","setLayers","setLayer","idx","findIndex","addLayer","IMAGE","TEXT","removeLayer","setLayerLevel","level","selectLayer","RECT","CIRCLE","dispatchEvent","Event","hoverLayer","setEditStatus","some","setLayerLock","resetSelectStatus","resetEditStatus","setBackgroundColor","setNeedUpdateLayerHeight","setIsMoving","action","bound","reaction","join","replaceAll","stringify","setItem","save","delay","observer","image","flexBasis","webformatWidth","webformatHeight","draggable","newLayer","String","webformatURL","top","right","bottom","onDragStartCapture","dataTransfer","setData","alt","Image","div","Rect","RectItem","rectInfo","fill","borderWidth","borderColor","borderStyle","Circle","CircleItem","circleInfo","onUseImage","UploadButton","htmlFor","accept","display","onChange","reader","FileReader","readAsDataURL","target","files","onload","result","label","Panel","Collapse","Search","Input","ajaxLock","isLoadMore","Sidebar","list","setList","page","per_page","image_type","q","orientation","safesearch","query","setQuery","showFilter","setShowFilter","useEffect","params","ajax","key","lang","concat","hits","Side","defaultActiveKey","collapsible","extra","onSearch","preventDefault","placeholder","title","trigger","visible","onVisibleChange","FilterOutlined","stopPropagation","FilterPanel","ListContent","UploadImage","ImageItem","marginTop","TextItem","aside","setScale","responsive","FooterBar","SliderWrapper","className","tipFormatter","value","min","max","ToolItem","round","UndoRedo","footer","ScaleContext","createContext","BackgroundContext","MouseEvents","handleMove","handleUp","payload","startCoords","preCoords","mouseUp","onmousemove","onmouseup","mouseMove","event","diffX","clientX","diffY","clientY","diff","curCoords","mouseDown","MIN_SIZE","normalResize","lockRatio","whRatio","newX","newY","newWidth","newHeight","TL","TR","BL","BR","T","B","L","R","rotateResize","curPoint","symmetricPoint","pointCenter","info","newCenterPoint","newOriginCurPoint","newOriginSymmetricPoint","abs","latestOriginCurPoint","latestCurPoint","sqrt","newCenter","isReverse","angle","clipImage","oldWidth","oldHeight","imageWhRatio","ratio","updateImageClip","INIT_ANGLE","ANGLE_TO_CURSOR","start","end","cursor","useContext","cursors","setCursors","resize","resizeNormal","pointRect","getBoundingClientRect","canvasRect","Number","resizeWithRotate","calcCursors","useCallback","newAngle","item","find","i","BorderEl","LockIcon","icon","lockIcon","PointBR","onMouseDown","PointTL","PointTR","PointBL","PointL","PointR","PointT","PointB","RotateIcon","rotateIcon","borderEl","closest","rect","rotateCenterPoint","offsetY","offsetX","atan2","Point","span","alignItems","justifyContent","pointerEvents","borderRadius","boxShadow","userSelect","props","HoverBorder","children","setIsSelectedBackground","realRect","layerId","allLayers","canvasSize","vLineEl","hLineEl","vType","hType","vLineHandle","targetX","hLineHandle","targetY","renderLine","vLine","visibility","hLine","getRect","scl","rad","move","helpLine","helpLineRect","initHelpLine","helpLinePipe","updatePosition","newPosition","hideLine","LayerWrapper","onMouseEnter","onMouseOut","LayerContent","TransportBorder","Border","createPortal","editorRef","useRef","editor","setEditor","onTextChange","_layer","text","getText","current","instance","Quill","setText","enable","setSelection","on","off","TextWrapper","Text","onDoubleClick","Editor","ref","spellCheck","fontFamily","textDecorationLine","ImgWrapper","preLayer","setLayerInfo","confirm","clipHandle","handleTop","clipTop","handleLeft","clipLeft","handleRight","clipRight","handleBottom","clipBottom","Mask","Wrapper","CanvasContent","LayerControl","AngleTL","resizeIcon","AngleTR","AngleBL","AngleBR","Line1","Line2","Line3","Line4","newTop","newLeft","newRight","newBottom","overflow","border","TransportToolBar","ToolBar","CheckOutlined","CloseOutlined","Line","ResizeAngle","dragCursorPosition","isSelectedBackground","onDrop","test","getData","onDragOver","pageX","pageY","Background","BACKGROUND","TransportImage","ClipImage","toJS","Layer","TransportEditor","TextEditor","BackgroundBorder","VLine","HLine","TextControl","flex","margin","FONT_LIST","name","FONTSIZE_LIST","CANVAS_SIZE_LIST","Option","Select","selectValue","setSelectValue","activeLayer","layerScale","hasUnderline","shapeInfo","levelInfo","canvasWidth","canvasHeight","onBorderStyleChange","onReverseImage","direction","CanvasSizeOptions","Group","marginRight","isNumber","marginLeft","ToolBarWrapper","ItemGroup","includes","placement","clr","rgba","rgb","r","g","b","ColorItem","step","borderWidthIcon","overlay","Item","padding","BorderSolid","BorderDashed","BorderDotted","borderStyleIcon","f","toFixed","isNaN","BoldOutlined","UnderlineOutlined","align","AlignLeftOutlined","AlignCenterOutlined","AlignRightOutlined","SwapOutlined","sort","opacityIcon","LockOutlined","UnlockOutlined","DeleteOutlined","onConfirm","okText","cancelText","copyLayer","scrollWrapperRef","wrapperEl","clientWidth","clientHeight","onKeyboardListener","activeElement","metaKey","ctrlKey","shiftKey","addEventListener","removeEventListener","ScrollWrapper","Container","Provider","Canvas","Footer","num","Main","MainBody","main","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.095abf81.chunk.js","sourcesContent":["import html2canvas from 'html2canvas-stroke2'\n\ninterface Coords {\n  x: number;\n  y: number;\n}\n\n// 求两点之间的中点坐标\nexport const getCenterCoords = (p1: Coords, p2: Coords): Coords => {\n  return {\n    x: p1.x + ((p2.x - p1.x) / 2),\n    y: p1.y + ((p2.y - p1.y) / 2)\n  }\n}\n\n/**\n * 计算根据圆心旋转后的点的坐标\n * @param point 旋转前的点坐标\n * @param center 旋转中心\n * @param rotate 旋转的角度\n * @return 旋转后的坐标\n */\n export const calcRotatedCoords = (point: Coords, center: Coords, rotate: number): Coords => {\n  rotate /= 180 / Math.PI\n  return {\n    x: (point.x - center.x) * Math.cos(rotate) - (point.y - center.y) * Math.sin(rotate) + center.x,\n    y: (point.x - center.x) * Math.sin(rotate) + (point.y - center.y) * Math.cos(rotate) + center.y\n  }\n}\n\n/** 截取图片 */\nexport async function getCoverImage (selector: string): Promise<string> {\n  const el = document.querySelector(selector) as HTMLElement\n  const copyEl = el.cloneNode(true) as HTMLElement\n\n  copyEl.style.transform = ''\n  copyEl.style.position = 'fixed'\n  copyEl.style.left = '-9999px'\n  document.body.appendChild(copyEl)\n  copyEl.querySelectorAll('img').forEach((img) => {\n    // 图片跨域，服务端也要支持（图片服务器配置Access-Control-Allow-Origin）\n    img.setAttribute('crossOrigin', 'anonymous')\n  })\n  const opt = {\n    width: copyEl.offsetWidth, // canvas宽度\n    height: copyEl.offsetHeight,\n    backgroundColor: null, // 画出来的图片有白色的边框,不要可设置背景为透明色（null）\n    useCORS: true // 支持图片跨域\n  }\n\n  return new Promise((resolve, reject) => {\n    html2canvas(copyEl, opt).then((canvas: any) => {\n      const res = canvas.toDataURL('image/png')\n      resolve(res)\n    }).catch((e: any) => {\n      reject(e)\n    }).finally(() => {\n      document.body.removeChild(copyEl)\n    })\n  })\n}\n","import styled from \"@emotion/styled\";\nimport Logo from 'assets/logo.png'\nimport { Button } from 'antd'\nimport { getCoverImage } from 'utils'\nimport { useState } from \"react\";\n\nexport default function Nav () {\n  const [loading, setLoading] = useState(false)\n\n  const exportImage = async () => {\n    setLoading(true)\n    try {\n      const url = await getCoverImage('#canvasContent')\n      const a = document.createElement('a')\n      a.href = url\n      a.setAttribute('download', `${Date.now()}.png`)\n      a.click()\n      a.remove()\n    } catch (e) { console.error(e) }\n    setLoading(false)\n  }\n\n  return <Header>\n    <Img src={Logo} />\n    <Button loading={loading} type=\"primary\" onClick={exportImage}>导出图片</Button>\n  </Header>\n}\n\nconst Header = styled.header`\n  height: 56px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 20px;\n  background-color: #fff;\n  border-bottom: 1px solid #ddd;\n`\n\nconst Img = styled.img`\n  width: 48px;\n  height: 48px;\n  object-fit: cover;\n`","export default \"data:image/png;base64,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\"","import axios from 'axios'\n\nconst service = axios.create({\n  baseURL: 'https://pixabay.com/api',\n  timeout: 10000\n})\n\nservice.interceptors.response.use((response) => {\n  return response.data\n})\n\nexport default service","export interface TemplateInfo {\n  global: {\n    width: number;\n    height: number;\n  },\n  background: {\n    color: string;\n  },\n  layers: Layer[];\n}\n\nexport interface Layer {\n  id: string;\n  type: LayerType;\n  width: number;\n  height: number;\n  position: {\n    x: number;\n    y: number;\n  };\n  rotate: number;\n  reverse?: {\n    x: number;\n    y: number;\n  },\n  source: {\n    imageUrl?: string;\n    content?: string;\n  };\n  opacity: number;\n  style?: FontStyle;\n  clip?: ImageClip;\n  rectInfo?: RectShape;\n  circleInfo?: RectShape;\n  zIndex: number;\n  isSelected?: boolean;\n  isHover?: boolean;\n  isEditing?: boolean;\n  isLocked?: boolean;\n  scale?: number;\n}\n\nexport interface RectShape {\n  fill: string;\n  borderWidth: number;\n  borderColor: string;\n  borderStyle: string;\n}\n\nexport interface FontStyle {\n  font: string;\n  fontSize: number;\n  lineHeight: number;\n  color: string;\n  textAlign: Align;\n  fontWeight: number;\n  underline: boolean;\n}\n\nexport interface ImageClip {\n  width: number;\n  height: number;\n  top: number;\n  left: number;\n  right: number;\n  bottom: number;\n  pre: {\n    width: number;\n    height: number;\n    top: number;\n    left: number;\n    right: number;\n    bottom: number;\n  }\n}\n\nexport type LayerType = 'image' | 'text' | 'rect' | 'circle'\nexport type Align = 'left' | 'center' | 'right' | 'justify'\n\nexport enum LAYER_TYPE {\n  EMPTY = 'empty',\n  IMAGE = 'image',\n  TEXT = 'text',\n  RECT = 'rect',\n  CIRCLE = 'circle',\n  BACKGROUND = 'background'\n}\n\nexport enum POINT_TYPE {\n  TL = 'topLeft',\n  TR = 'topRight',\n  BL = 'bottomLeft',\n  BR = 'bottomRight',\n  T = 'top',\n  B = 'bottom',\n  L = 'left',\n  R = 'right'\n}\n\nexport interface Coords {\n  x: number;\n  y: number;\n}\n","import { TemplateInfo } from 'types'\n\nexport const defaultTemplate: TemplateInfo = {\n  global: {\n    width: 1280,\n    height: 720\n  },\n  background: {\n    color: '#fff'\n  },\n  layers: [\n    {\n      id: '1',\n      type: 'image',\n      width: 510,\n      height: 340,\n      position: {\n        x: 100,\n        y: 100\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: 'https://cdn.pixabay.com/photo/2014/04/13/20/49/cat-323262__340.jpg'\n      },\n      opacity: 1,\n      zIndex: 1\n    },\n    {\n      id: '2',\n      type: 'text',\n      width: 380,\n      height: 72,\n      position: {\n        x: 100,\n        y: 500\n      },\n      rotate: 0,\n      source: {\n        content: '双击编辑文字'\n      },\n      style: {\n        font: 'Microsoft Yahei',\n        fontSize: 60,\n        lineHeight: 1.2,\n        color: '#000',\n        textAlign: 'left',\n        fontWeight: 400,\n        underline: false\n      },\n      opacity: 1,\n      zIndex: 2\n    }\n  ]\n}","import { cloneDeep } from 'lodash'\nimport { templateStore } from 'store/template'\nimport { TemplateInfo, LAYER_TYPE } from 'types'\n\nconst historyCache: TemplateInfo[] = []\nlet pointer = 0\nlet isUndoOrRedo = false\n\nexport default function undoRedo () {\n  const { setCanUseUndo, setCanUseRedo } = templateStore\n\n  const init = (template: TemplateInfo) => {\n    historyCache.push(template)\n  }\n\n  // 缓存历史记录\n  const pushHistory = () => {\n    if (isUndoOrRedo) {\n      isUndoOrRedo = false\n      return\n    }\n\n    const _template = cloneDeep(templateStore.template)\n    _template.layers = _template.layers.map(l => {\n      l.isSelected = false\n      l.isEditing = false\n      l.isHover = false\n      return l\n    })\n    pointer++\n    historyCache[pointer] = _template\n    historyCache.splice(pointer + 1, historyCache.length)\n    setCanUseUndo(true)\n    setCanUseRedo(false)\n    if (historyCache.length > 50) {\n      historyCache.shift()\n      pointer--\n    }\n  }\n\n  // 撤销\n  const undo = () => {\n    if (historyCache[pointer - 1]) {\n      isUndoOrRedo = true\n      pointer--\n      const _template = historyCache[pointer]\n      templateStore.setTemplate(cloneDeep(_template))\n      templateStore.setLayerType(LAYER_TYPE.EMPTY)\n      setCanUseRedo(true)\n      if (!historyCache[pointer - 1]) {\n        setCanUseUndo(false)\n      }\n    }\n  }\n\n  // 重做\n  const redo = () => {\n    if (historyCache[pointer + 1]) {\n      isUndoOrRedo = true\n      pointer++\n      const _template = historyCache[pointer]\n      templateStore.setTemplate(cloneDeep(_template))\n      templateStore.setLayerType(LAYER_TYPE.EMPTY)\n      setCanUseUndo(true)\n      if (!historyCache[pointer + 1]) {\n        setCanUseRedo(false)\n      }\n    }\n  }\n\n  return {\n    init,\n    pushHistory,\n    undo,\n    redo\n  }\n}","import { observable, action, reaction } from 'mobx'\nimport { defaultTemplate } from 'utils/initData'\nimport { TemplateInfo, Layer, LAYER_TYPE } from 'types'\nimport { cloneDeep } from 'lodash'\nimport undoRedo from 'utils/undoRedo'\n\nlet template: TemplateInfo = Object.assign(defaultTemplate, {\n  layers: defaultTemplate.layers.map(layer => { return {...layer, isSelected: false, isEditing: false, isHover: false, isLocked: false, scale: 1} })\n})\n\nconst localTemplateCache = localStorage.getItem('TEMPLATE')\nif (localTemplateCache) {\n  template = JSON.parse(localTemplateCache)\n}\n\n// 模板store\nexport const templateStore = observable({\n  // 模板\n  template: template,\n  // 当前编辑图层类型\n  layerType: LAYER_TYPE.EMPTY,\n  // 是否需要重新计算图层的高度，比如改变字体大小时需要\n  needUpdateLayerHeight: false,\n  // 图层是否正在移动\n  isMoving: false,\n  canUseUndo: false,\n  canUseRedo: false,\n\n  get layers (): Layer[] {\n    return this.template.layers\n  },\n\n  // 获取最新的模板\n  getTemplate () {\n    const _template = cloneDeep(templateStore.template)\n    _template.layers = _template.layers.map(l => {\n      if (l.type === 'text' && l.style && l.scale) {\n        l.style.fontSize *= l.scale\n      }\n      delete l.isSelected\n      delete l.isEditing\n      delete l.scale\n      // @ts-ignore\n      delete l.clip?.pre\n      return l\n    })\n    return _template\n  },\n\n  // 修改整体模板\n  setTemplate (val: TemplateInfo) {\n    this.template = val\n  },\n\n  // 修改画布尺寸\n  setCanvasSize (size: { width: number; height: number }) {\n    this.template.global.width = size.width\n    this.template.global.height = size.height\n  },\n\n  // 修改全部图层\n  setLayers (layers: Layer[]) {\n    this.template.layers = layers\n  },\n\n  // 修改单个图层\n  setLayer (layer: Layer) {\n    const idx = this.layers.findIndex(l => l.id === layer.id)\n    if (idx > -1 && !this.layers[idx].isLocked) {\n      this.layers[idx] = layer\n    }\n  },\n\n  // 新增单个图层\n  addLayer (layer: Layer) {\n    this.layers.push(layer)\n    if (layer.type === 'image') {\n      this.setLayerType(LAYER_TYPE.IMAGE)\n    } else if (layer.type === 'text') {\n      this.setLayerType(LAYER_TYPE.TEXT)\n    }\n  },\n\n  // 移除单个图层\n  removeLayer (id: string) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1 && !this.layers[idx].isLocked) {\n      this.layers.splice(idx, 1)\n      this.setLayerType(LAYER_TYPE.EMPTY)\n    }\n  },\n\n  // 设置图层层级\n  setLayerLevel (id: string, level: number) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1) {\n      this.layers[idx].zIndex = level\n    }\n  },\n\n  // 选择图层\n  selectLayer (id: string) {\n    this.layers.forEach(layer => {\n      layer.isSelected = layer.id === id\n      if (layer.isSelected) {\n        switch (layer.type) {\n          case 'image': this.setLayerType(LAYER_TYPE.IMAGE); break;\n          case 'text': this.setLayerType(LAYER_TYPE.TEXT); break;\n          case 'rect': this.setLayerType(LAYER_TYPE.RECT); break;\n          case 'circle': this.setLayerType(LAYER_TYPE.CIRCLE); break;\n        }\n      }\n    })\n    // 隐藏一些下拉组件\n    document.dispatchEvent(new Event('mousedown'))\n  },\n\n  // 鼠标经过图层\n  hoverLayer (id?: string) {\n    this.layers.forEach(layer => {\n      layer.isHover = id ? layer.id === id : false\n    })\n  },\n\n  // 设置当前选择的图层类型\n  setLayerType (type: LAYER_TYPE) {\n    this.layerType = type\n  },\n\n  // 设置图层编辑状态(文字编辑、图片裁剪)\n  setEditStatus (id: string) {\n    if (this.layers.some(l => l.id === id && l.isLocked)) return\n    this.layers.forEach(layer => {\n      layer.isEditing = layer.id === id\n    })\n  },\n\n  // 设置图层锁定状态\n  setLayerLock (id: string, isLocked: boolean) {\n    const idx = this.layers.findIndex(l => l.id === id)\n    if (idx > -1) {\n      this.layers[idx].isLocked = isLocked\n      this.layers[idx].isEditing = false\n    }\n  },\n\n  // 重置所有图层选中状态\n  resetSelectStatus () {\n    this.layers.forEach(layer => {\n      layer.isSelected = false\n    })\n    this.setLayerType(LAYER_TYPE.EMPTY)\n  },\n\n  // 重置所有文字图层编辑状态\n  resetEditStatus () {\n    this.layers.forEach(layer => {\n      layer.isEditing = false\n    })\n  },\n\n  // 设置背景色\n  setBackgroundColor (color: string) {\n    this.template.background.color = color\n  },\n\n  // 设置needUpdateLayerHeight\n  setNeedUpdateLayerHeight (val: boolean) {\n    this.needUpdateLayerHeight = val\n  },\n\n  // 设置isMoving\n  setIsMoving (val: boolean) {\n    this.isMoving = val\n  },\n\n  setCanUseUndo (val: boolean) {\n    this.canUseUndo = val\n  },\n\n  setCanUseRedo (val: boolean) {\n    this.canUseRedo = val\n  },\n}, {\n  setTemplate: action.bound,\n  getTemplate: action.bound,\n  setCanvasSize: action.bound,\n  setLayers: action.bound,\n  setLayer: action.bound,\n  addLayer: action.bound,\n  removeLayer: action.bound,\n  selectLayer: action.bound,\n  setLayerLevel: action.bound,\n  hoverLayer: action.bound,\n  setLayerType: action.bound,\n  setEditStatus: action.bound,\n  setLayerLock: action.bound,\n  resetSelectStatus: action.bound,\n  resetEditStatus: action.bound,\n  setBackgroundColor: action.bound,\n  setNeedUpdateLayerHeight: action.bound,\n  setIsMoving: action.bound,\n  setCanUseUndo: action.bound,\n  setCanUseRedo: action.bound\n})\n\n// 切换图层时重置文字编辑状态\n// 清空空文字图层\nreaction(\n  () => templateStore.layers.map(l => l.isSelected).join(''),\n  () => {\n    templateStore.resetEditStatus()\n    const idx = templateStore.layers.findIndex(l => l.type === 'text' && !l.source.content?.replaceAll(/\\n/g, ''))\n    if (idx > -1) {\n      templateStore.removeLayer(templateStore.layers[idx].id)\n    }\n  }\n)\n\n// 撤销重做\nconst { init, pushHistory } = undoRedo()\ninit(template)\n\n// 保存到本地\nconst save = () => {\n  const template = cloneDeep(templateStore.template)\n  template.layers = template.layers.map(l => {\n    l.isSelected = false\n    l.isEditing = false\n    l.isHover = false\n    return l\n  })\n  localStorage.setItem('TEMPLATE', JSON.stringify(template))\n}\n\n// 侦听保存\nreaction(\n  () => {\n    const template = cloneDeep(templateStore.template)\n    template.layers = template.layers.map(l => {\n      delete l.isSelected\n      delete l.isEditing\n      delete l.isHover\n      return l\n    })\n    return JSON.stringify(template)\n  },\n  () => { save(); pushHistory() },\n  {\n    delay: 500\n  }\n)\n","import styled from \"@emotion/styled\";\nimport { ImageItem as ImageInfo } from \"types/image\";\nimport { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { observer } from 'mobx-react';\nimport { DragEvent } from 'react'\n\nexport default observer(({ image }: { image: ImageInfo }) => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n\n  // 使用图片\n  const onUseImage = () => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'image',\n      width: image.webformatWidth,\n      height: image.webformatHeight,\n      position: {\n        x: (template.global.width - image.webformatWidth) / 2,\n        y: (template.global.height - image.webformatHeight) / 2\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: image.webformatURL\n      },\n      clip: {\n        width: image.webformatWidth,\n        height: image.webformatHeight,\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        pre: {\n          width: image.webformatWidth,\n          height: image.webformatHeight,\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n        }\n      },\n      opacity: 1,\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n\n  // 拖拽图片\n  const onDragStartCapture = (e: DragEvent<HTMLDivElement>) => {\n    e.dataTransfer.setData('image', JSON.stringify(image))\n  }\n\n  return <Image\n    style={{\n      flexBasis: `${100 * image.webformatWidth / image.webformatHeight}px`\n    }}\n    draggable=\"true\"\n    onClick={onUseImage}\n    onDragStartCapture={onDragStartCapture}\n  >\n    <img src={image.webformatURL} alt=\"\" draggable=\"false\" />\n  </Image>\n})\n\nconst Image = styled.div`\n  position: relative;\n  margin: 0 10px 10px 0;\n  background-color: #f0f1f4;\n  overflow: hidden;\n  flex-grow: 1;\n\n  img {\n    min-width: 100%;\n    height: 100px;\n    object-fit: cover;\n  }\n`","import { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { Button } from 'antd';\nimport { observer } from 'mobx-react';\n\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus, setEditStatus } = templateStore\n\n  // 新增文本\n  const onUseText = () => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'text',\n      width: 380,\n      height: 72,\n      position: {\n        x: (template.global.width - 300) / 2,\n        y: (template.global.height - 72) / 2\n      },\n      rotate: 0,\n      source: {\n        content: '双击编辑文字'\n      },\n      style: {\n        font: '微软雅黑',\n        fontSize: 60,\n        lineHeight: 1.2,\n        color: '#000',\n        textAlign: 'left',\n        fontWeight: 400,\n        underline: false\n      },\n      opacity: 1,\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: true,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n    setEditStatus(newLayer.id)\n  }\n\n  return <Button size=\"large\" style={{ width: '100%' }} onClick={onUseText}>\n    添加文本\n  </Button>\n})","import styled from \"@emotion/styled\";\nimport { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { observer } from 'mobx-react';\n\nexport const Rect = observer(() => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n  const onUseRect = () => {\n    const width = 200\n    const height = 200\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'rect',\n      width: width,\n      height: height,\n      position: {\n        x: (template.global.width - width) / 2,\n        y: (template.global.height - height) / 2\n      },\n      source: {},\n      rotate: 0,\n      opacity: 1,\n      rectInfo: {\n        fill: '#fff',\n        borderWidth: 5,\n        borderColor: '#000',\n        borderStyle: 'solid'\n      },\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n  return <RectItem onClick={onUseRect} />\n})\n\nexport const Circle = observer(() => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n  const onUseCircle = () => {\n    const width = 200\n    const height = 200\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'circle',\n      width: width,\n      height: height,\n      position: {\n        x: (template.global.width - width) / 2,\n        y: (template.global.height - height) / 2\n      },\n      source: {},\n      rotate: 0,\n      opacity: 1,\n      circleInfo: {\n        fill: '#fff',\n        borderWidth: 5,\n        borderColor: '#000',\n        borderStyle: 'solid'\n      },\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n  return <CircleItem onClick={onUseCircle} />\n})\n\nconst RectItem = styled.div`\n  width: 60px;\n  height: 60px;\n  margin-right: 10px;\n  border: 4px solid #000;\n  background-color: #fff;\n`\n\nconst CircleItem = styled(RectItem)`\n  border-radius: 50%;\n`","import styled from \"@emotion/styled\";\nimport { templateStore } from 'store/template';\nimport { Layer } from 'types';\nimport { Button } from 'antd';\nimport { observer } from 'mobx-react';\n\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus } = templateStore\n\n  // 选择图片\n  const uploadImage = (e: any) => {\n    const reader = new FileReader()\n    reader.readAsDataURL(e.target.files[0])\n    reader.onload = el => {\n      const url = el.target?.result\n      if (typeof url === 'string') {\n        const img = new Image()\n        img.src = url\n        img.onload = () => {\n          onUseImage(img.width, img.height, url)\n        }\n      }\n    }\n  }\n\n  // 使用图片\n  const onUseImage = (width: number, height: number, url: string) => {\n    const newLayer: Layer = {\n      id: String(Date.now()),\n      type: 'image',\n      width: width,\n      height: height,\n      position: {\n        x: (template.global.width - width) / 2,\n        y: (template.global.height - height) / 2\n      },\n      rotate: 0,\n      reverse: {\n        x: 1,\n        y: 1\n      },\n      source: {\n        imageUrl: url\n      },\n      clip: {\n        width: width,\n        height: height,\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        pre: {\n          width: width,\n          height: height,\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n        }\n      },\n      opacity: 1,\n      zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n      isSelected: true,\n      isEditing: false,\n      isLocked: false,\n      scale: 1\n    }\n    resetSelectStatus()\n    addLayer(newLayer)\n  }\n\n  return <>\n    <UploadButton htmlFor=\"uploadImage\">\n      <Button size=\"large\">\n        选择本地图片\n      </Button>\n    </UploadButton>\n    <input type=\"file\" id=\"uploadImage\" accept=\"image/*\" style={{ display: 'none' }} onChange={uploadImage} />\n  </>\n})\n\nconst UploadButton = styled.label`\n  display: block;\n  width: 100%;\n  margin-bottom: 16px;\n  cursor: pointer;\n\n  button {\n    width: 100%;\n    pointer-events: none;\n  }\n`","import styled from \"@emotion/styled\";\nimport { useState, useEffect } from \"react\";\nimport { ImageItem as ImageInfo, SearchQuery } from \"types/image\";\nimport { getImages } from \"services/common\";\nimport { Collapse } from 'antd';\nimport { FilterOutlined } from '@ant-design/icons';\nimport { Popover, Input, Button } from 'antd';\nimport ImageItem from './ImageItem'\nimport TextItem from './TextItem'\nimport { Rect, Circle } from './Shapes'\nimport UploadImage from \"./UploadImage\";\n\nconst { Panel } = Collapse\nconst { Search } = Input\n\nlet ajaxLock = false\nlet isLoadMore = false\n\nexport default function Sidebar () {\n  // 图片列表\n  const [list, setList] = useState<ImageInfo[]>([])\n  // 图片查询参数\n  const [query, setQuery] = useState<Partial<SearchQuery>>({\n    page: 1,\n    per_page: 20,\n    image_type: 'all',\n    q: '',\n    orientation: 'all',\n    safesearch: true\n  })\n\n  const [showFilter, setShowFilter] = useState(false)\n\n  useEffect(() => {\n    getImages(query).then((data: any) => {\n      if (isLoadMore) {\n        setList(list => list.concat(data.hits))\n      } else {\n        setList(data.hits)\n      }\n    }).finally(() => {\n      ajaxLock = false\n    })\n  }, [query])\n\n  // 加载更多图片\n  const onLoadMore = () => {\n    if (ajaxLock) return\n    ajaxLock = true\n    const page = query.page\n    isLoadMore = true\n    setQuery(Object.assign({}, query, {\n      page: page ? page + 1 : 1\n    }))\n  }\n\n  // 图片筛选面板\n  const FilterPanel = () => {\n    const onSearch = (val: string, e: any) => {\n      e.preventDefault()\n      if (val) {\n        isLoadMore = false\n        setQuery(Object.assign({}, query, {\n          q: val,\n          page: 1\n        }))\n      }\n    }\n\n    const Content = () => {\n      return <>\n        <Search placeholder=\"搜索\" onSearch={onSearch} style={{ width: 200 }} />\n      </>\n    }\n\n    return <Popover\n      content={Content}\n      title=\"筛选\"\n      trigger=\"click\"\n      visible={showFilter}\n      onVisibleChange={visible => setShowFilter(visible)}\n    >\n      <FilterOutlined onClick={(e) => { e.stopPropagation(); setShowFilter(true) }} />\n    </Popover>\n  }\n\n  return <Side>\n    <Collapse defaultActiveKey={['1']} collapsible=\"header\">\n      <Panel header={<div style={{ width: '300px' }}>图片</div>} key=\"1\" extra={FilterPanel()}>\n        <ListContent>\n          <UploadImage />\n          {list.map(image => <ImageItem key={image.id} image={image} />)}\n          <Button style={{ width: '100%', marginTop: '20px' }} onClick={onLoadMore}>加载更多</Button>\n      </ListContent>\n      </Panel>\n      <Panel header={<div style={{ width: '300px' }}>文字</div>} key=\"2\">\n        <ListContent>\n          <TextItem />\n        </ListContent>\n      </Panel>\n      <Panel header={<div style={{ width: '300px' }}>形状</div>} key=\"3\">\n        <ListContent>\n          <Rect />\n          <Circle />\n        </ListContent>\n      </Panel>\n    </Collapse>\n  </Side>\n}\n\nconst Side = styled.aside`\n  flex: none;\n  display: flex;\n  flex-direction: column;\n  width: 400px;\n  height: 100%;\n  background-color: #fff;\n  border-right: 1px solid #ddd;\n  overflow-y: scroll;\n\n  ::-webkit-scrollbar {\n    width: 8px;\n    background: #fff;\n\n    &:horizontal {\n      height: 8px;\n    }\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #fff;\n  }\n\n  ::-webkit-scrollbar-corner {\n    background: #fff;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #c4c4c4;\n    border: 8px solid rgba(0, 0, 0, 0);\n    border-radius: 9999px;\n\n    &:hover {\n      background: #adadad;\n    }\n  }\n\n  .ant-collapse {\n    border: 0;\n    background-color: #fff;\n  }\n`\n\nconst ListContent = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  padding-left: 10px;\n  user-select: none;\n\n  &:after {\n    content: '';\n    display: block;\n    flex-grow: 99999;\n  }\n`\n","import ajax from './base'\n\nconst key = '24178889-8dbe9fccf0c585814c1dcb342'\n\nexport const getImages = (params: any): any => {\n  return ajax({\n    url: '/',\n    params: {\n      key,\n      lang: 'zh',\n      ...params\n    }\n  })\n}\n","import styled from \"@emotion/styled\";\nimport { Slider } from \"antd\";\nimport UndoIcon from \"assets/undo.png\";\nimport RedoIcon from \"assets/redo.png\";\nimport undoRedo from 'utils/undoRedo'\nimport { templateStore } from 'store/template'\nimport { observer } from 'mobx-react';\n\nconst { undo, redo } = undoRedo()\n\nexport default observer(({ scale, setScale, responsive }: { scale: number; setScale: (n: number) => void; responsive: () => void }) => {\n  const { canUseUndo, canUseRedo } = templateStore\n\n  const scaleChange = (val: number) => {\n    setScale(val / 100)\n  }\n\n  return <FooterBar>\n    <SliderWrapper>\n      <Slider\n        className=\"slider\"\n        tipFormatter={null}\n        value={scale * 100}\n        min={10} max={500}\n        onChange={scaleChange}\n      />\n      <ToolItem className=\"scale active\" onClick={responsive}>{Math.round(scale * 100)}%</ToolItem>\n    </SliderWrapper>\n    <UndoRedo>\n      <ToolItem className={ canUseUndo ? 'active' : '' } onClick={undo}><img src={UndoIcon} alt=\"\" /></ToolItem>\n      <ToolItem className={ canUseRedo ? 'active' : '' } onClick={redo}><img src={RedoIcon} alt=\"\" /></ToolItem>\n    </UndoRedo>\n  </FooterBar>\n})\n\nconst FooterBar = styled.footer`\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  width: 100%;\n  height: 44px;\n  padding: 0 40px;\n  background-color: #fff;\n  border-top: 1px solid #ddd;\n\n  .slider {\n    width: 240px;\n  }\n\n  .scale {\n    /* width: 100px; */\n    margin: 0 20px;\n  }\n`\n\nconst SliderWrapper = styled.div`\n  display: flex;\n  align-items: center;\n`\n\nconst UndoRedo = styled.div`\n  display: flex;\n  justify-content: space-around;\n  width: 120px;\n\n  img {\n    width: 22px;\n    height: 22px;\n    pointer-events: none;\n    user-select: none;\n  }\n`\n\nconst ToolItem = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 6px 8px;\n  border-radius: 4px;\n  cursor: not-allowed;\n  opacity: .5;\n\n  &:hover {\n    background-color: rgba(64,87,109,.07);\n  }\n\n  &.active {\n    opacity: 1;\n    cursor: pointer;\n  }\n`","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAArRJREFUWEfFl09rE1EQwGfyB/SgKOjBQz1IIeBBEPsB6tFL8uZBCiIIgiiKigcpiKDtwYJ4kFpQiAh68WDovrdRWMGDfoAW9KBURRCUigoe9BJD3o5syZbNZje7G5P4IITMmzfzezPzZgjCf16Yxj8RXQWAeWae11rPpTmTVicRQAhxGREXfIPDhugLQESXAOBm8DaI+MCyrBNpb5ikFwtARBcAYDFk4I3rujO2bb9NMpx2PxJACHEGEe+M2rlnvwdASnmSme+Nw3kPABEdB4CHEeHzIvKtIzfM7HqrUCgY79v7DQCe/Hur1friOM6vzCkQQhxFxEdpDyborSGicl13WWu92k93IwXVanWy3W5/GJLzLjOIWDPGLMYV7mYNENFjj2UUEAAQ+3q6ijAOwms+acAQcQIASp3PrjSF3PMKoiAG6X5CiNuIeD4JIrIPDBFiGhFfhDppzbKs076sXyeMqolZpVRXa05KTblcLuXz+bWgHjNP+a8jaRb0QLiue8y27UzPVQgxi4g3Nm+NeMWyrI0BlzgNw+kYdBgR0U8A2NmBeKWUOpgKwFMKQDxn5lNa609JoQ/vE9EKABzy5caY7Y1G43diBPwDQoi5YrG4UK/XW1mdhy7hHy8ppd6nBhjEafCMdwFEvObLmPmw1vrl2ACIaBkAZABgUmv9cWwAUsrXzHzAB2g2m1scx/kzFoBKpTKRy+XeAcDWDsAzpdSR1K/gX/MvpVxi5nOB8J/VWt8dCwAReRPWa2j+WkfEKcuyvo4cQEp5i5kvhtpw13+LodeAEGJHoVDYb4y5DgDTofTVlVIzQVlmgGq1utsYc5+Zt0XUxl4A2BdTMz3OB0qBEKJnxKYo0kjn4wBYZeaa1roWB5k5BVLKPcy8HmPwBwB8RsQVZn6ilHqaFJ3MAEkGs+7/BQfySDDlTlsQAAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAqtJREFUWEfFljGrE0EQx2duQ0yjiKA2TxBEfWjhg2dno1gdaLJzD2MlKOLDRkUtLCx8tqIgPEGwULASD243ATvB9wVEsBCEh4qChQqKFlpcMrIhd1wul9wuOXEhhGRn5v+7uZ2ZRfjPC6vWl1KuIOINAGgrpcKy+JUCZMQT3VKISgGCIHjEzKdzTz0VolKAVqu1z/O8pwCw3xaiUgAj6gpROYArhBOA7/ub6vX6HCJuAwCBiJ5ZcRwL821+m/8NBDNvB4D7BVUwciZKAaSUi57nLTEzAcB8WVlZ7qcQEwHMuxRCXGLmZcugTma1Wm13GIbrhQDDg/QMAHY6RbU3DpVSbWM+BiClPIyILwpifQOAt+bDzJ9stIYdMW+aio8BSCkXhuKbs17MvKq1vmgjmtgUdEWzNSI+BkBEpomcyIkf0VqvuYgT0RUAuJPzGRMfASCiMwDwMOvU6/Xmu92uSbv1IqJzAPDARnwEIAiCx8x8KnFk5mta61vWygAQBMFJZn5iK57PwPvMqf+ulNriIm5sC4ZRYdqzcQdV0Gw2NwohfmY2XiqlDroC5OZAqXiaASLaMyyxRNPKuQjQQCBiW2u9YvMAgwzka5+Zb9oGsBGZZpMA7ELE9YxhpJRamjW4jf8AwPf9DY1G40/igIivoyg6YBNgVpu0FRPRKwBYGAb83e/393Y6HauWOwtEFsDM7vOZLNyLoujCLMFtfFMAKeVRRHyecyq91dqIlB7CxEBKeRsRr440CsS7URRdnlVokv/YOM6dhcRvTQhxPY7jN1rrH1XCFF5IiOgLAGydIPQOAD7m9xDxlxDibBiGX10AJ17JikZzWWBmdh7dUy+lUsplRDR3wsUycbNfOUAiSkTHEPE4M5sBtWPC6/nMzIe01h9sYNNydzH+F7Z/AWqi/yEtgkl8AAAAAElFTkSuQmCC\"","import { createContext } from \"react\";\nexport const ScaleContext = createContext<number>(1)\nexport const BackgroundContext = createContext<any>(null)","import { MouseEvent as MouseEventType } from \"react\";\n\nexport class MouseEvents {\n  constructor (e: MouseEventType<HTMLElement>, handleMove: (payload: any) => void, handleUp?: () => void) {\n    this.mouseDown(e)\n    this.handleMove = handleMove\n    handleUp && (this.handleUp = handleUp)\n  }\n  \n  private handleMove = (payload: any) => {}\n  private handleUp = () => {}\n\n  private startCoords = {\n    x: 0,\n    y: 0\n  }\n\n  private preCoords = {\n    x: 0,\n    y: 0\n  }\n\n  private mouseUp = () => {\n    document.onmousemove = null\n    document.onmouseup = null\n    this.handleUp()\n  }\n\n  private mouseMove = (event: any) => {\n    const diffX = event.clientX - this.preCoords.x\n    const diffY = event.clientY - this.preCoords.y\n    const preCoords = {\n      x: this.preCoords.x,\n      y: this.preCoords.y\n    }\n    this.handleMove({\n      diff: {\n        x: diffX,\n        y: diffY\n      },\n      startCoords: this.startCoords,\n      curCoords: this.preCoords,\n      preCoords: preCoords\n    })\n    this.preCoords = {\n      x: event.clientX,\n      y: event.clientY\n    }\n  }\n\n  private mouseDown = (e: MouseEventType<HTMLElement>) => {\n    this.startCoords = {\n      x: e.clientX,\n      y: e.clientY\n    }\n    this.preCoords = {\n      x: e.clientX,\n      y: e.clientY\n    }\n    document.onmousemove = this.mouseMove\n    document.onmouseup = this.mouseUp\n  }\n}","import { Layer, POINT_TYPE, Coords } from 'types';\nimport { getCenterCoords, calcRotatedCoords } from 'utils';\n\nconst MIN_SIZE = {\n  width: 10,\n  height: 10\n}\n\n/**\n * 无旋转处理\n * @param layer 图层信息\n * @param point 拖动的点类型\n * @param diff 鼠标上次和当前移动的xy差值\n * @param scale 画布缩放\n * @param lockRatio 是否锁定比例\n * @returns \n */\nexport function normalResize (layer: Layer, point: POINT_TYPE, diff: Coords, scale: number, lockRatio: boolean): Layer {\n  const whRatio = layer.width / layer.height\n  let { x: newX, y: newY } = layer.position\n  let { width: newWidth, height: newHeight } = layer\n  const { x, y } = diff\n  switch (point) {\n    case POINT_TYPE.TL: {\n      const height = layer.height\n      newWidth -= x / scale\n      newX += x / scale\n      if (lockRatio) {\n        newHeight = newWidth / whRatio\n      } else {\n        newHeight -= y / scale\n      }\n      newY -= newHeight - height\n      break\n    }\n    case POINT_TYPE.TR: {\n      const height = layer.height\n      newWidth += x / scale\n      if (lockRatio) {\n        newHeight = newWidth / whRatio\n      } else {\n        newHeight -= y / scale\n      }\n      newY -= newHeight - height\n      break\n    }\n    case POINT_TYPE.BL: {\n      newWidth -= x / scale\n      newX += x / scale\n      if (lockRatio) {\n        newHeight = newWidth / whRatio\n      } else {\n        newHeight += y / scale\n      }\n      break\n    }\n    case POINT_TYPE.BR: {\n      newWidth += x / scale\n      if (lockRatio) {\n        newHeight = newWidth / whRatio\n      } else {\n        newHeight += y / scale\n      }\n      break\n    }\n    case POINT_TYPE.T: {\n      newHeight -= y / scale\n      newY += y / scale\n      break\n    }\n    case POINT_TYPE.B: {\n      newHeight += y / scale\n      break\n    }\n    case POINT_TYPE.L: {\n      newWidth -= x / scale\n      newX += x / scale\n      break\n    }\n    case POINT_TYPE.R: {\n      newWidth += x / scale\n      break\n    }\n  }\n\n  if ((newWidth > MIN_SIZE.width && newHeight > MIN_SIZE.height) || newWidth > layer.width || newHeight > layer.height) {\n    if (newWidth > MIN_SIZE.width) {\n      layer.width = newWidth\n      layer.position.x = newX\n    }\n    if (newHeight > MIN_SIZE.height) {\n      layer.height = newHeight\n      layer.position.y = newY\n    }\n  }\n\n  return layer\n}\n\n/**\n * 有旋转处理\n * @param point 拖动的点类型\n * @param curPoint 鼠标相对于画布左上角的坐标\n * @param symmetricPoint 对称点\n * @param pointCenter 当前拖动的点/边元素的中心位置\n * @param info 图层信息props\n * @param layer 最新的图层信息\n * @param whRatio 宽高比\n * @param scale 画布缩放值\n * @param lockRatio 是否锁定比例\n * @returns 返回调整后的图层信息\n */\nexport function rotateResize (point: POINT_TYPE, curPoint: Coords, symmetricPoint: Coords, pointCenter: Coords, info: Layer, layer: Layer, whRatio: number, scale: number, lockRatio: boolean): Layer {\n  switch (point) {\n    case POINT_TYPE.TL: {\n      // 根据鼠标当前位置和对称点获取最新中心点\n      let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n      // 获取旋转前的左上角坐标\n      let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n      // 获取旋转前的对称点坐标\n      let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n      let newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n      let newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n\n      if (lockRatio) {\n        // 获取等比缩放计算后的坐标\n        if (newWidth / newHeight > whRatio) {\n          newOriginCurPoint.x += Math.abs(newWidth - newHeight * whRatio)\n        } else {\n          newOriginCurPoint.y += Math.abs(newHeight - newWidth / whRatio)\n        }\n\n        // 由于现在求的未旋转前的坐标是以没按比例缩减宽高前的坐标来计算的\n        // 所以缩减宽高后，需要按照原来的中心点旋转回去，获得缩减宽高并旋转后对应的坐标\n        // 然后以这个坐标和对称点获得新的中心点，并重新计算未旋转前的坐标\n        const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n        newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n        newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n        newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n        newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n        newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n      }\n\n      if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n        layer.width = newWidth / scale\n        layer.height = newHeight / scale\n        layer.position.y = newOriginCurPoint.y / scale\n        layer.position.x = newOriginCurPoint.x / scale\n      }\n      break\n    }\n\n    case POINT_TYPE.TR: {\n      let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n      // 获取旋转前的右上角坐标\n      let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n      let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n      let newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n      let newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n\n      if (lockRatio) {\n        if (newWidth / newHeight > whRatio) {\n          newOriginCurPoint.x -= Math.abs(newWidth - newHeight * whRatio)\n        } else {\n          newOriginCurPoint.y += Math.abs(newHeight - newWidth / whRatio)\n        }\n\n        const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n        newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n        newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n        newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n        newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n        newHeight = newOriginSymmetricPoint.y - newOriginCurPoint.y\n      }\n\n      if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n        layer.width = newWidth / scale\n        layer.height = newHeight / scale\n        layer.position.y = newOriginCurPoint.y / scale\n        layer.position.x = newOriginSymmetricPoint.x / scale\n      }\n      break\n    }\n\n    case POINT_TYPE.BR: {\n      let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n      // 获取旋转前的右下角坐标\n      let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n      let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n      let newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n      let newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n\n      if (lockRatio) {\n        if (newWidth / newHeight > whRatio) {\n          newOriginCurPoint.x -= Math.abs(newWidth - newHeight * whRatio)\n        } else {\n          newOriginCurPoint.y -= Math.abs(newHeight - newWidth / whRatio)\n        }\n\n        const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n        newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n        newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n        newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n        newWidth = newOriginCurPoint.x - newOriginSymmetricPoint.x\n        newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n      }\n\n      if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n        layer.width = newWidth / scale\n        layer.height = newHeight / scale\n        layer.position.y = newOriginSymmetricPoint.y / scale\n        layer.position.x = newOriginSymmetricPoint.x / scale\n      }\n      break\n    }\n\n    case POINT_TYPE.BL: {\n      let newCenterPoint = getCenterCoords(curPoint, symmetricPoint)\n      // 获取旋转前的左下角坐标\n      let newOriginCurPoint = calcRotatedCoords(curPoint, newCenterPoint, -info.rotate)\n      let newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n      let newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n      let newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n\n      if (lockRatio) {\n        if (newWidth / newHeight > whRatio) {\n          newOriginCurPoint.x += Math.abs(newWidth - newHeight * whRatio)\n        } else {\n          newOriginCurPoint.y -= Math.abs(newHeight - newWidth / whRatio)\n        }\n\n        const latestOriginCurPoint = calcRotatedCoords(newOriginCurPoint, newCenterPoint, info.rotate)\n        newCenterPoint = getCenterCoords(latestOriginCurPoint, symmetricPoint)\n        newOriginCurPoint = calcRotatedCoords(latestOriginCurPoint, newCenterPoint, -info.rotate)\n        newOriginSymmetricPoint = calcRotatedCoords(symmetricPoint, newCenterPoint, -info.rotate)\n\n        newWidth = newOriginSymmetricPoint.x - newOriginCurPoint.x\n        newHeight = newOriginCurPoint.y - newOriginSymmetricPoint.y\n      }\n\n      if (newWidth / scale > MIN_SIZE.width && newHeight / scale > MIN_SIZE.height) {\n        layer.width = newWidth / scale\n        layer.height = newHeight / scale\n        layer.position.y = newOriginSymmetricPoint.y / scale\n        layer.position.x = newOriginCurPoint.x / scale\n      }\n      break\n    }\n\n    case POINT_TYPE.T:\n    case POINT_TYPE.B: {\n      // 由于用户拉伸时是以任意角度拉伸的，所以在求得旋转前的坐标时，只取 y 坐标（这里的 x 坐标可能是任意值），x 坐标用 pointCenter 的。\n      // 这个中心点（第二个参数）用 pointCenter, center, symmetricPoint 都可以，只要他们在一条直线上就行\n      const newOriginCurPoint = calcRotatedCoords(curPoint, pointCenter, -info.rotate)\n\n      // 算出旋转前 y 坐标，再用 initCurPoint 的 x 坐标，重新计算它们旋转后对应的坐标\n      const latestCurPoint = calcRotatedCoords({\n        x: pointCenter.x,\n        y: newOriginCurPoint.y\n      }, pointCenter, info.rotate)\n\n      // 用旋转后的坐标和对称点算出新的高度（勾股定理）\n      const newHeight = Math.sqrt((latestCurPoint.x - symmetricPoint.x) ** 2 + (latestCurPoint.y - symmetricPoint.y) ** 2)\n\n      const newCenter = {\n        x: latestCurPoint.x - (latestCurPoint.x - symmetricPoint.x) / 2,\n        y: latestCurPoint.y + (symmetricPoint.y - latestCurPoint.y) / 2\n      }\n\n      // 是否反向拉伸了\n      let isReverse = false\n      const angle = (info.rotate + 360) % 360\n      // 禁止反向拉伸\n      if (point === POINT_TYPE.T) {\n        if ((angle >= 0 && angle <= 90) || (angle >= 270 && angle <= 360)) {\n          if (latestCurPoint.y >= symmetricPoint.y) {\n            isReverse = true\n          }\n        } else if (latestCurPoint.y <= symmetricPoint.y) {\n          isReverse = true\n        }\n      }\n      if (point === POINT_TYPE.B) {\n        if (angle >= 90 && angle <= 270) {\n          if (latestCurPoint.y >= symmetricPoint.y) {\n            isReverse = true\n          }\n        } else if (latestCurPoint.y <= symmetricPoint.y) {\n          isReverse = true\n        }\n      }\n\n      if (newHeight / scale > MIN_SIZE.height && !isReverse) {\n        layer.height = newHeight / scale\n        layer.position.y = (newCenter.y - (newHeight / 2)) / scale\n        layer.position.x = newCenter.x / scale - (layer.width / 2)\n      }\n      break\n    }\n\n    case POINT_TYPE.L:\n    case POINT_TYPE.R: {\n      const newOriginCurPoint = calcRotatedCoords(curPoint, pointCenter, -info.rotate)\n\n      const latestCurPoint = calcRotatedCoords({\n        x: newOriginCurPoint.x,\n        y: pointCenter.y\n      }, pointCenter, info.rotate)\n\n      const newWidth = Math.sqrt((latestCurPoint.x - symmetricPoint.x) ** 2 + (latestCurPoint.y - symmetricPoint.y) ** 2)\n\n      const newCenter = {\n        x: latestCurPoint.x - (latestCurPoint.x - symmetricPoint.x) / 2,\n        y: latestCurPoint.y + (symmetricPoint.y - latestCurPoint.y) / 2\n      }\n\n      // 是否反向拉伸了\n      let isReverse = false\n      const angle = (info.rotate + 360) % 360\n      // 禁止反向拉伸\n      if (point === POINT_TYPE.L) {\n        if ((angle >= 0 && angle <= 90) || (angle >= 270 && angle <= 360)) {\n          if (latestCurPoint.x >= symmetricPoint.x) {\n            isReverse = true\n          }\n        } else if (latestCurPoint.x <= symmetricPoint.x) {\n          isReverse = true\n        }\n      }\n      if (point === POINT_TYPE.R) {\n        if (angle >= 90 && angle <= 270) {\n          if (latestCurPoint.x >= symmetricPoint.x) {\n            isReverse = true\n          }\n        } else if (latestCurPoint.x <= symmetricPoint.x) {\n          isReverse = true\n        }\n      }\n\n      if (newWidth / scale > MIN_SIZE.width && !isReverse) {\n        layer.width = newWidth / scale\n        layer.position.y = newCenter.y / scale - (layer.height / 2)\n        layer.position.x = (newCenter.x - (newWidth / 2)) / scale\n      }\n      break\n    }\n  }\n\n  return layer\n}","import { Layer, POINT_TYPE } from 'types';\n\n// 计算处理图片裁剪\nexport const clipImage = (layer: Layer, point: POINT_TYPE, oldWidth: number, oldHeight: number): Layer => {\n  // 判断是否有翻转，翻转后方向互换\n  if (layer.reverse?.x === -1) {\n    if (point === POINT_TYPE.L) {\n      point = POINT_TYPE.R\n    } else if (point === POINT_TYPE.R) {\n      point = POINT_TYPE.L\n    }\n  }\n  if (layer.reverse?.y === -1) {\n    if (point === POINT_TYPE.T) {\n      point = POINT_TYPE.B\n    } else if (point === POINT_TYPE.B) {\n      point = POINT_TYPE.T\n    }\n  }\n  if (layer.clip) {\n    const imageWhRatio = layer.clip.pre.width / layer.clip.pre.height\n    switch (point) {\n      case POINT_TYPE.BR:\n      case POINT_TYPE.BL:\n      case POINT_TYPE.TL:\n      case POINT_TYPE.TR: {\n        // 全部等比例伸缩\n        const ratio = layer.width / oldWidth\n        layer.clip.width *= ratio\n        layer.clip.height *= ratio\n        layer.clip.top *= ratio\n        layer.clip.left *= ratio\n        layer.clip.right *= ratio\n        layer.clip.bottom *= ratio\n        break\n      }\n      case POINT_TYPE.R: {\n        // 伸缩\n        if (layer.width + layer.clip.left > layer.clip.pre.width) {\n          layer.clip.left *= layer.width / oldWidth\n          layer.clip.top *= layer.width / oldWidth\n          const newWidth = layer.clip.left + layer.width\n          layer.clip.width = newWidth\n          layer.clip.height = newWidth / imageWhRatio\n        // 裁剪\n        } else {\n          layer.clip.left = layer.clip.pre.left\n          layer.clip.top = layer.clip.pre.top\n          layer.clip.width = layer.clip.pre.width\n          layer.clip.height = layer.clip.pre.height\n        }\n        break\n      }\n      case POINT_TYPE.L: {\n        // 伸缩\n        if (layer.width + layer.clip.right > layer.clip.pre.width) {\n          layer.clip.right *= layer.width / oldWidth\n          const newWidth = layer.clip.right + layer.width\n          layer.clip.width = newWidth\n          layer.clip.left = 0\n          layer.clip.top *= layer.width / oldWidth\n          layer.clip.height = newWidth / imageWhRatio\n        // 裁剪\n        } else {\n          layer.clip.left = layer.clip.pre.width - layer.clip.pre.right - layer.width\n          layer.clip.top = layer.clip.pre.top\n          layer.clip.width = layer.clip.pre.width\n          layer.clip.height = layer.clip.pre.height\n          layer.clip.right = layer.clip.pre.right\n          layer.clip.bottom = layer.clip.pre.bottom\n        }\n        break\n      }\n      case POINT_TYPE.B: {\n        // 伸缩\n        if (layer.height + layer.clip.top > layer.clip.pre.height) {\n          layer.clip.top *= layer.height / oldHeight\n          layer.clip.left *= layer.height / oldHeight\n          const newHeight = layer.clip.top + layer.height\n          layer.clip.height = newHeight\n          layer.clip.width = newHeight * imageWhRatio\n        // 裁剪\n        } else {\n          layer.clip.left = layer.clip.pre.left\n          layer.clip.top = layer.clip.pre.top\n          layer.clip.width = layer.clip.pre.width\n          layer.clip.height = layer.clip.pre.height\n        }\n        break\n      }\n      case POINT_TYPE.T: {\n        // 伸缩\n        if (layer.height + layer.clip.bottom > layer.clip.pre.height) {\n          layer.clip.bottom *= layer.height / oldHeight\n          const newHeight = layer.clip.bottom + layer.height\n          layer.clip.height = newHeight\n          layer.clip.top = 0\n          layer.clip.left *= layer.height / oldHeight\n          layer.clip.width = newHeight * imageWhRatio\n        // 裁剪\n        } else {\n          layer.clip.top = layer.clip.pre.height - layer.clip.pre.bottom - layer.height\n          layer.clip.left = layer.clip.pre.left\n          layer.clip.width = layer.clip.pre.width\n          layer.clip.height = layer.clip.pre.height\n          layer.clip.right = layer.clip.pre.right\n          layer.clip.bottom = layer.clip.pre.bottom\n        }\n        break\n      }\n    }\n  }\n  return layer\n}\n\n// 更新上一次的图片的裁剪信息，保存在pre对象里\nexport const updateImageClip = (layer: Layer): Layer => {\n  if (layer.clip) {\n    layer.clip.pre.left = layer.clip.left\n    layer.clip.pre.top = layer.clip.top\n    layer.clip.pre.right = layer.clip.width - layer.clip.left - layer.width\n    layer.clip.pre.bottom = layer.clip.height - layer.clip.top - layer.height\n    layer.clip.pre.width = layer.clip.width\n    layer.clip.pre.height = layer.clip.height\n    layer.clip.right = layer.clip.pre.right\n    layer.clip.bottom = layer.clip.pre.bottom\n  }\n  return layer\n}","export default __webpack_public_path__ + \"static/media/rotate.a7cc796d.svg\";","export default __webpack_public_path__ + \"static/media/lock.7263c59f.svg\";","import { Layer, POINT_TYPE, Coords } from 'types';\nimport { MouseEvent, useContext, useState, useEffect, useCallback } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { ScaleContext } from 'store/context';\nimport { MouseEvents } from 'utils/mouseEvent';\nimport { normalResize, rotateResize } from 'utils/resizeLayer'\nimport { clipImage, updateImageClip } from 'utils/clipImage'\nimport rotateIcon from 'assets/rotate.svg';\nimport lockIcon from 'assets/lock.svg';\nimport { templateStore } from 'store/template';\nimport { cloneDeep } from 'lodash';\nimport { observer } from 'mobx-react';\n\n// 初始的指针角度（左上、上、右上、右）\nconst INIT_ANGLE = [0, 45, 90, 135]\n// 角度范围对应的指针样式\nconst ANGLE_TO_CURSOR = [\n  { start: 0, end: 23, cursor: 'nwse-resize' },\n  { start: 338, end: 360, cursor: 'nwse-resize' },\n  { start: 23, end: 68, cursor: 'ns-resize' },\n  { start: 68, end: 113, cursor: 'nesw-resize' },\n  { start: 113, end: 158, cursor: 'ew-resize' },\n  { start: 158, end: 203, cursor: 'nwse-resize' },\n  { start: 203, end: 248, cursor: 'ns-resize' },\n  { start: 248, end: 293, cursor: 'nesw-resize' },\n  { start: 293, end: 338, cursor: 'ew-resize' }\n]\n\n// 编辑框\nexport default observer(({ info }: { info: Layer; }) => {\n  const scale = useContext(ScaleContext)\n\n  const { layers, setLayer, isMoving, setIsMoving } = templateStore\n\n  // 鼠标样式\n  const [cursors, setCursors] = useState<string[]>([])\n\n  // 调整大小 无旋转\n  const resizeNormal = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    const idx = layers.findIndex(layer => layer.id === info.id)\n\n    if (idx > -1) {\n      new MouseEvents(e, (payload) => {\n        const layer = cloneDeep(layers[idx])\n\n        const oldHeight = layer.height\n        const oldWidth = layer.width\n\n        // 普通拖拽框大小\n        let res = normalResize(layer, point, payload.diff, scale, true)\n\n        // 处理文本框缩放\n        if (res.type === 'text') {\n          if (res.height !== oldHeight && res.scale) {\n            res.scale *= res.height / oldHeight\n          }\n        }\n        // 处理图片裁剪\n        if (res.type === 'image') {\n          res = clipImage(res, point, oldWidth, oldHeight)\n        }\n\n        setLayer(res)\n        setIsMoving(true)\n      }, () => {\n        let layer = cloneDeep(layers[idx])\n        if (layer.type === 'image') {\n          // 更新图片裁剪信息\n          layer = updateImageClip(layer)\n          setLayer(layer)\n        }\n        setIsMoving(false)\n      })\n    }\n  }\n\n  // 调整大小 有旋转\n  const resizeWithRotate = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    // 图层相对于画布左上角的中心点\n    const center = {\n      x: (info.position.x + info.width / 2) * scale,\n      y: (info.position.y + info.height / 2) * scale\n    }\n\n    // 获取边框圆点中心点\n    const pointRect = (e.target as HTMLElement)?.getBoundingClientRect()\n    const canvasRect = (document.querySelector('#layerControl') as HTMLElement)?.getBoundingClientRect()\n    const pointCenter = {\n      x: pointRect.left - Number(canvasRect.left) + pointRect.width / 2,\n      y: pointRect.top - Number(canvasRect.top) + pointRect.height / 2\n    }\n\n    // 获取对称点\n    const symmetricPoint = {\n      x: center.x - (pointCenter.x - center.x),\n      y: center.y - (pointCenter.y - center.y)\n    }\n\n    const whRatio = info.width / info.height\n    const idx = layers.findIndex(layer => layer.id === info.id)\n\n    new MouseEvents(e, ({ curCoords }: { curCoords: Coords }) => {\n      const layer = cloneDeep(layers[idx])\n\n      const curPoint = {\n        x: curCoords.x - Number(canvasRect.left),\n        y: curCoords.y - Number(canvasRect.top)\n      }\n\n      const oldHeight = layer.height\n      const oldWidth = layer.width\n\n      // 处理旋转的拖拽\n      let res = rotateResize(point, curPoint, symmetricPoint, pointCenter, info, layer, whRatio, scale, true)\n\n      // 处理文本框缩放\n      if (res.type === 'text') {\n        if (res.height !== oldHeight && res.scale) {\n          res.scale *= res.height / oldHeight\n        }\n      }\n      // 处理图片裁剪\n      if (res.type === 'image') {\n        res = clipImage(res, point, oldWidth, oldHeight)\n      }\n\n      setLayer(res)\n      setIsMoving(true)\n    }, () => {\n      let layer = cloneDeep(layers[idx])\n      if (layer.type === 'image') {\n        // 更新图片裁剪信息\n        layer = updateImageClip(layer)\n        setLayer(layer)\n      }\n      setIsMoving(false)\n    })\n  }\n\n  // 调整大小\n  const resize = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    e.stopPropagation()\n    if (info.rotate === 0) {\n      resizeNormal(e, point)\n    } else {\n      resizeWithRotate(e, point)\n    }\n  }\n\n  // 旋转\n  const rotate = (e: MouseEvent<HTMLElement>) => {\n    e.stopPropagation()\n    const borderEl = (e.target as HTMLElement).closest('.border-control')\n    if (borderEl) {\n      const rect = borderEl.getBoundingClientRect()\n      const rotateCenterPoint = {\n        x: rect.left + rect.width / 2,\n        y: rect.top + rect.height / 2\n      }\n      new MouseEvents(e, ({ curCoords }: { curCoords: Coords }) => {\n        const offsetY = curCoords.y - rotateCenterPoint.y\n        const offsetX = curCoords.x - rotateCenterPoint.x\n        // 当前距离x轴的角度(x轴起逆时针方向至该边)\n        const angle = Math.atan2(offsetY, offsetX) * 180 / Math.PI\n\n        const idx = layers.findIndex(layer => layer.id === info.id)\n        const layer = cloneDeep(layers[idx])\n        layer.rotate = (angle - 90 + 360) % 360\n\n        setLayer(layer)\n        setIsMoving(true)\n      }, () => {\n        setIsMoving(false)\n      })\n    }\n  }\n\n  // 计算8个圆点的指针样式，按顺序分别为 左上（右下）、上（下）、右上（左下）、右（左）\n  const calcCursors = useCallback(() => {\n    let angle = info.rotate\n    if (angle < 0) {\n      angle += 360\n    }\n    const cursors: string[] = []\n    INIT_ANGLE.forEach((a) => {\n      const newAngle = (a + angle) % 360\n      const item = ANGLE_TO_CURSOR.find(i => i.start <= newAngle && i.end >= newAngle)\n      if (item) {\n        cursors.push(item.cursor)\n      }\n    })\n    setCursors(cursors)\n  }, [info.rotate])\n\n  useEffect(() => {\n    calcCursors()\n  }, [calcCursors])\n\n  return <BorderEl \n    style={{\n      width: info.width * scale,\n      height: info.height * scale,\n      transform: `translate(${info.position.x * scale}px, ${info.position.y * scale}px) rotate(${info.rotate}deg)`\n    }}\n    className={['border-control', isMoving ? 'moving' : ''].join(' ')}\n  >\n    {info.isLocked ?\n      <LockIcon icon={lockIcon} rotate={info.rotate} /> :\n      <>\n        <PointBR style={{ cursor: cursors[0] }} onMouseDown={e => resize(e, POINT_TYPE.BR)} />\n        {info.width * scale > 30 && info.height * scale > 30 && <>\n            <PointTL style={{ cursor: cursors[0] }} onMouseDown={e => resize(e, POINT_TYPE.TL)} />\n            <PointTR style={{ cursor: cursors[2] }} onMouseDown={e => resize(e, POINT_TYPE.TR)} />\n            <PointBL style={{ cursor: cursors[2] }} onMouseDown={e => resize(e, POINT_TYPE.BL)} />\n            <PointL style={{ cursor: cursors[3] }} onMouseDown={e => resize(e, POINT_TYPE.L)} />\n            <PointR style={{ cursor: cursors[3] }} onMouseDown={e => resize(e, POINT_TYPE.R)} />\n            { info.type !== 'text' && <PointT style={{ cursor: cursors[1] }} onMouseDown={e => resize(e, POINT_TYPE.T)} /> }\n            { info.type !== 'text' && <PointB style={{ cursor: cursors[1] }} onMouseDown={e => resize(e, POINT_TYPE.B)} /> }\n          </>\n        }\n        <RotateIcon className='rotate-point' icon={rotateIcon} onMouseDown={rotate} />\n      </>\n    }\n  </BorderEl>\n})\n\nconst BorderEl = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n\n  &.moving .rotate-point {\n    opacity: 0;\n  }\n\n  &.moving span {\n    opacity: 0;\n  }\n\n  &:after {\n    content: '';\n    position: absolute;\n    top: -1px;\n    left: -1px;\n    right: -1px;\n    bottom: -1px;\n    border: 2px solid #00c4cc;\n  }\n`\n\nconst Point = styled.span`\n  position: absolute;\n  display: block;\n  background: transparent;\n  z-index: 1;\n  pointer-events: auto;\n  width: 18px;\n  height: 18px;\n  user-select: none;\n  transition: opacity 200ms;\n\n  ::before {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    border-radius: 6px;\n    background: #fff;\n    box-shadow: 0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(53 71 90 / 20%);\n  }\n`\n\nconst PointTL = styled(Point)`\n  top: -9px;\n  left: -9px;\n  cursor: nwse-resize;\n`\n\nconst PointTR = styled(Point)`\n  top: -9px;\n  right: -9px;\n  cursor: nesw-resize;\n`\n\nconst PointBL = styled(Point)`\n  bottom: -9px;\n  left: -9px;\n  cursor: nesw-resize;\n`\n\nconst PointBR = styled(Point)`\n  bottom: -9px;\n  right: -9px;\n  cursor: nwse-resize;\n`\n\nconst PointT = styled(Point)`\n  width: calc(100% - 24px);\n  height: 12px;\n  top: -6px;\n  left: 12px;\n  cursor: ns-resize;\n\n  ::before {\n    width: 16px;\n    height: 4px;\n  }\n`\n\nconst PointB = styled(Point)`\n  width: calc(100% - 24px);\n  height: 12px;\n  bottom: -6px;\n  left: 12px;\n  cursor: ns-resize;\n\n  ::before {\n    width: 16px;\n    height: 4px;\n  }\n`\n\nconst PointL = styled(Point)`\n  width: 12px;\n  height: calc(100% - 24px);\n  top: 12px;\n  left: -6px;\n  cursor: ew-resize;\n\n  ::before {\n    width: 4px;\n    height: 16px;\n  }\n`\n\nconst PointR = styled(Point)`\n  width: 12px;\n  height: calc(100% - 24px);\n  top: 12px;\n  right: -6px;\n  cursor: ew-resize;\n\n  ::before {\n    width: 4px;\n    height: 16px;\n  }\n`\n\nconst RotateIcon = styled.div<{icon: string}>(\n  {\n    position: 'absolute',\n    left: '50%',\n    bottom: '-50px',\n    width: '20px',\n    height: '20px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    transform: 'translate(-50%, -50%)',\n    pointerEvents: 'auto',\n    borderRadius: '50%',\n    boxShadow: '0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(57 76 96 / 15%)',\n    userSelect: 'none',\n    cursor: 'grab'\n  },\n  props => ({\n    background: `#fff url(${props.icon}) no-repeat center / 18px 18px`\n  })\n)\n\nconst LockIcon = styled.div<{icon: string; rotate: number}>(\n  {\n    position: 'absolute',\n    right: '0',\n    bottom: '0',\n    width: '20px',\n    height: '20px',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    pointerEvents: 'auto',\n    borderRadius: '50%',\n    boxShadow: '0 0 5px 1px rgb(57 76 96 / 15%), 0 0 0 1px rgb(57 76 96 / 15%)',\n    userSelect: 'none',\n    zIndex: '1'\n  },\n  props => ({\n    background: `#fff url(${props.icon}) no-repeat center / 13px 13px`,\n    transform: `translate(50%, 50%) rotate(${-props.rotate}deg)`\n  })\n)","import { useContext } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { Layer } from 'types';\nimport { ScaleContext } from 'store/context';\n\nexport default function HoverBorder ({ info }: { info: Layer; }) {\n  const scale = useContext(ScaleContext)\n\n  return <BorderEl \n    style={{\n      width: info.width * scale,\n      height: info.height * scale,\n      transform: `translate(${info.position.x * scale}px, ${info.position.y * scale}px) rotate(${info.rotate}deg)`\n    }}\n  />\n}\n\nconst BorderEl = styled.div`\nposition: absolute;\ntop: 0;\nleft: 0;\npointer-events: none;\n\n&:after {\n  content: '';\n  position: absolute;\n  top: -1px;\n  left: -1px;\n  right: -1px;\n  bottom: -1px;\n  border: 2px solid #00c4cc;\n}\n`","import { MouseEvent as MouseEventType, useContext } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport styled from \"@emotion/styled\";\nimport { Layer as LayerType } from 'types';\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport { MouseEvents } from 'utils/mouseEvent';\nimport { helpLine } from 'utils/helpLine'\nimport Border from \"./Border\";\nimport HoverBorder from \"./HoverBorder\";\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { cloneDeep } from \"lodash\";\n\n// 图层\nexport default observer(({ children, info }: { children: JSX.Element, info: LayerType }) => {\n  const scale = useContext(ScaleContext)\n  const { template, layers, setLayer, selectLayer, hoverLayer, isMoving, setIsMoving } = templateStore\n\n  // 设置背景选中状态\n  const { setIsSelectedBackground } = useContext(BackgroundContext)\n\n  // 辅助线\n  const { getRect: helpLineRect, init: initHelpLine, move: helpLinePipe } = helpLine()\n\n  // 更新图层位置\n  const updatePosition = ({ diff }: { diff: { x: number; y: number; } }) => {\n    const layer = cloneDeep(info)\n\n    const newPosition = helpLinePipe({\n      x: helpLineRect().x + diff.x / scale,\n      y: helpLineRect().y + diff.y / scale\n    })\n\n    layer.position = newPosition\n\n    setLayer(layer)\n    setIsMoving(true)\n  }\n\n  // 隐藏辅助线\n  const hideLine = () => {\n    const vLineEl = document.querySelector('#verticalLine') as HTMLElement\n    vLineEl.style.visibility = 'hidden'\n    const hLineEl = document.querySelector('#horizontalLine') as HTMLElement\n    hLineEl.style.visibility = 'hidden'\n    setIsMoving(false)\n  }\n\n  // 选中图层\n  const onSelectLayer = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    if (info.isEditing) return\n    selectLayer(info.id)\n    setIsSelectedBackground(false)\n    // 锁定了就不给拖动\n    if (info.isLocked) return\n    // 初始化拖拽事件\n    new MouseEvents(e, updatePosition, hideLine)\n    // 初始化辅助线数据\n    initHelpLine({\n      ...info.position,\n      width: info.width,\n      height: info.height,\n      rotate: info.rotate\n    }, info.id, layers, scale, { ...template.global })\n  }\n\n  // 鼠标移入图层\n  const onLayerMouseEnter = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    hoverLayer(info.id)\n  }\n\n  // 鼠标移出图层\n  const onLayerMouseOut = (e: MouseEventType<HTMLDivElement>) => {\n    e.stopPropagation()\n    hoverLayer()\n  }\n\n  return <LayerWrapper\n    style={{\n      width: info.width,\n      height: info.height,\n      transform: `translate(${info.position.x}px, ${info.position.y}px) rotate(${info.rotate}deg)`,\n      opacity: info.opacity,\n      zIndex: info.zIndex\n    }}\n    onMouseDown={onSelectLayer}\n    onMouseEnter={onLayerMouseEnter}\n    onMouseOut={onLayerMouseOut}\n    className={[isMoving ? 'moving' : '', info.isEditing ? 'edit' : ''].join(' ')}\n  >\n    {/* 图层内容 */}\n    <LayerContent style={{transform: `scale(${info.reverse?.x || 1}, ${info.reverse?.y || 1})`}}>\n      { children }\n    </LayerContent>\n    {/* 拖拽边框 */}\n    {info.isSelected && <TransportBorder>\n      <Border info={info} />\n    </TransportBorder>}\n    {/* 鼠标移入边框 */}\n    {!info.isSelected && !isMoving && info.isHover && <TransportBorder>\n      <HoverBorder info={info} />\n    </TransportBorder>}\n  </LayerWrapper>\n})\n\n// 传送门\nfunction TransportBorder ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#layerControl') as HTMLDivElement\n  )\n}\n\nconst LayerWrapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: auto;\n  user-select: none;\n  cursor: default;\n\n  &.moving {\n    cursor: all-scroll;\n  }\n\n  &.edit {\n    cursor: text;\n  }\n`\n\nconst LayerContent = styled.div`\n  width: 100%;\n  height: 100%;\n  transition: transform 250ms;\n`","import { Layer } from 'types';\n\ninterface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  rotate: number;\n}\n\ninterface RealRect extends Omit<Rect, 'rotate'> {}\n\ninterface Size {\n  width: number;\n  height: number;\n}\n\ninterface Coord {\n  x: number;\n  y: number;\n}\n\nexport function helpLine () {\n  // 当前图层位置信息\n  let rect: Rect = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n    rotate: 0\n  }\n\n  // 当前图层实际DOM的位置信息\n  let realRect: RealRect = {\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0,\n  }\n\n  // 当前图层ID\n  let layerId = ''\n  // 所有的图层数据\n  let allLayers: Layer[] = []\n  // 缩放值\n  let scale = 1\n  // 画布尺寸\n  let canvasSize: Size = {\n    width: 0,\n    height: 0\n  }\n  // 吸附距离\n  let diff = 4\n\n  const vLineEl = document.querySelector('#verticalLine') as HTMLElement\n  const hLineEl = document.querySelector('#horizontalLine') as HTMLElement\n  let vType: 0 | 1 | 2 = 0 // 垂直线位置-0左1中2右\n  let hType: 0 | 1 | 2 = 0 // 水平线位置-0上1中2下\n\n  // 初始化数据\n  const init = (data: Rect, id: string, layers: Layer[], scl: number, size: Size) => {\n    rect = data\n    layerId = id\n    allLayers = layers\n    scale = scl\n    diff = 4 / scale\n    canvasSize = size\n\n    // 获取旋转后的真实元素位置信息\n    const rad = rect.rotate * Math.PI / 180\n    const newWidth = Math.abs(rect.width * Math.cos(rad)) + Math.abs(rect.height * Math.sin(rad))\n    const newHeight = Math.abs(rect.height * Math.cos(rad)) + Math.abs(rect.width * Math.sin(rad))\n    realRect.width = newWidth\n    realRect.height = newHeight\n    realRect.x = rect.x + (rect.width - newWidth) / 2\n    realRect.y = rect.y - (newHeight - rect.height) / 2\n  }\n\n  // 移动吸附\n  const move = ({ x, y }: Coord): Coord => {\n    rect.x = x\n    rect.y = y\n\n    const res: Coord = {\n      x: rect.x,\n      y: rect.y\n    }\n\n    // 更新真实元素位置信息\n    realRect.x = rect.x + (rect.width - realRect.width) / 2\n    realRect.y = rect.y - (realRect.height - rect.height) / 2\n\n    // 遍历所有图层，与当前图层两两对比\n    allLayers.forEach(l => {\n      // 获取其他图层真实的元素定位\n      const rad = l.rotate * Math.PI / 180\n      const newWidth = Math.abs(l.width * Math.cos(rad)) + Math.abs(l.height * Math.sin(rad))\n      const newHeight = Math.abs(l.height * Math.cos(rad)) + Math.abs(l.width * Math.sin(rad))\n      const newX = l.position.x + (l.width - newWidth) / 2\n      const newY = l.position.y - (newHeight - l.height) / 2\n\n      if (l.id !== layerId) {\n        // x 垂直线\n        vLineHandle(newX + newWidth, res) // 对象图层右\n        vLineHandle(newX + newWidth / 2, res) // 对象图层中\n        vLineHandle(newX, res) // 对象图层左\n\n        // y 水平线\n        hLineHandle(newY + newHeight, res) // 对象图层下\n        hLineHandle(newY + newHeight / 2, res) // 对象图层中\n        hLineHandle(newY, res) // 对象图层上\n      }\n    })\n\n    // 与画布对齐\n    // x 垂直线\n    vLineHandle(canvasSize.width, res) // 画布右\n    vLineHandle(canvasSize.width / 2, res) // 画布中\n    vLineHandle(0, res) // 画布左\n    // y 水平线\n    hLineHandle(canvasSize.height, res) // 画布下\n    hLineHandle(canvasSize.height / 2, res) // 画布中\n    hLineHandle(0, res) // 画布上\n\n    // 渲染辅助线DOM\n    renderLine(res)\n\n    return res\n  }\n\n  // 垂直线\n  const vLineHandle = (targetX: number, res: Coord) => {\n    // 右\n    if (Math.abs(targetX - (realRect.x + realRect.width)) <= diff) {\n      res.x = targetX - rect.width \n      res.x += (rect.width - realRect.width) / 2\n      vType = 2\n    }\n    // 中\n    if (Math.abs(targetX - (realRect.x + realRect.width / 2)) <= diff) {\n      res.x = targetX - rect.width / 2\n      vType = 1\n    }\n    // 左\n    if (Math.abs(targetX - realRect.x) <= diff) {\n      res.x = targetX\n      res.x -= (rect.width - realRect.width) / 2\n      vType = 0\n    }\n  }\n\n  // 水平线\n  const hLineHandle = (targetY: number, res: Coord) => {\n    // 下\n    if (Math.abs(targetY - (realRect.y + realRect.height)) <= diff) {\n      res.y = targetY - rect.height\n      res.y -= (realRect.height - rect.height) / 2\n      hType = 2\n    }\n    // 中\n    if (Math.abs(targetY - (realRect.y + realRect.height / 2)) <= diff) {\n      res.y = targetY - rect.height / 2\n      hType = 1\n    }\n    // 上\n    if (Math.abs(targetY - realRect.y) <= diff) {\n      res.y = targetY\n      res.y += (realRect.height - rect.height) / 2\n      hType = 0\n    }\n  }\n\n  // 渲染辅助线DOM\n  const renderLine = (res: Coord) => {\n    if (vLineEl && hLineEl) {\n      // TODO: 当前位置刚好在线上，条件不满足\n      if (res.x !== rect.x) {\n        let vLine = 0\n        if (vType === 0) vLine = res.x + (rect.width - realRect.width) / 2\n        if (vType === 1) vLine = res.x + rect.width / 2\n        if (vType === 2) vLine = res.x + (rect.width - realRect.width) / 2 + realRect.width\n        vLineEl.style.transform = `translateX(${vLine * scale}px)`\n        vLineEl.style.visibility = 'visible'\n      } else {\n        vLineEl.style.visibility = 'hidden'\n      }\n      if (res.y !== rect.y) {\n        let hLine = 0\n        if (hType === 0) hLine = res.y - (realRect.height - rect.height) / 2\n        if (hType === 1) hLine = res.y + rect.height / 2\n        if (hType === 2) hLine = res.y - (realRect.height - rect.height) / 2 + realRect.height\n        hLineEl.style.transform = `translateY(${hLine * scale}px)`\n        hLineEl.style.visibility = 'visible'\n      } else {\n        hLineEl.style.visibility = 'hidden'\n      }\n    }\n  }\n\n  const getRect = () => {\n    return rect\n  }\n\n  return {\n    getRect,\n    init,\n    move\n  }\n}","import 'quill/dist/quill.core.css';\nimport 'quill/dist/quill.snow.css';\nimport Quill from 'quill';\nimport { observer } from 'mobx-react';\nimport styled from \"@emotion/styled\";\nimport { FontStyle } from 'types';\nimport { Layer } from 'types';\nimport { useCallback, useEffect, useRef, useState, useContext } from 'react';\nimport { templateStore } from 'store/template';\nimport { cloneDeep } from 'lodash';\nimport { ScaleContext } from 'store/context';\n\nexport default observer(({ layer }: { layer: Layer }) => {\n  const editorRef = useRef<HTMLDivElement>(null)\n\n  const { setEditStatus, setLayer, needUpdateLayerHeight, setNeedUpdateLayerHeight, isMoving } = templateStore\n  const scale = useContext(ScaleContext)\n\n  // quill实例\n  let [editor, setEditor] = useState<Quill | null>(null)\n\n  // 画布的DOM信息\n  const canvasRect = (document.querySelector('#textControl') as HTMLElement)?.getBoundingClientRect()\n\n  // 文本内容变化\n  const onTextChange = useCallback(() => {\n    if (editor) {\n      const _layer = cloneDeep(layer)\n      const text = editor.getText()\n      _layer.source.content = text\n\n      if (editorRef.current) {\n        // 文本换行了，更新图层最新高度和位置\n        const rect = editorRef.current.getBoundingClientRect()\n        const rad = (layer.rotate % 180) * Math.PI / 180\n        const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n        // 高度不一致表示换行/减行\n        if (newHeight / scale !== layer.height) {\n          _layer.height = newHeight / scale\n\n          const center = {\n            x: rect.left + rect.width / 2 - canvasRect.left,\n            y: rect.top + rect.height / 2 - canvasRect.top\n          }\n          const newX = center.x / scale - (layer.width / 2)\n          const newY = (center.y - (newHeight / 2)) / scale\n\n          _layer.position = {\n            x: newX,\n            y: newY\n          }\n        }\n      }\n      setLayer(_layer)\n    }\n  }, [editor, layer, setLayer, scale, canvasRect])\n\n  // 字体大小改变了，高度也要更新\n  useEffect(() => {\n    if (needUpdateLayerHeight && editorRef.current) {\n      const _layer = cloneDeep(layer)\n      const rect = editorRef.current.getBoundingClientRect()\n      const rad = (layer.rotate % 180) * Math.PI / 180\n      const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n      // 高度不一致表示换行/减行\n      if (newHeight / scale !== layer.height) {\n        _layer.height = newHeight / scale\n\n        const center = {\n          x: rect.left + rect.width / 2 - canvasRect.left,\n          y: rect.top + rect.height / 2 - canvasRect.top\n        }\n        const newX = center.x / scale - (layer.width / 2)\n        const newY = (center.y - (newHeight / 2)) / scale\n\n        _layer.position = {\n          x: newX,\n          y: newY\n        }\n        setLayer(_layer)\n      }\n      setNeedUpdateLayerHeight(false)\n    }\n  }, [canvasRect, layer, needUpdateLayerHeight, scale, setLayer, setNeedUpdateLayerHeight])\n\n  // 拖拽改变文本框宽度时，更新图层最新高度\n  // TODO: 位置会偏移\n  useEffect(() => {\n    // isMoving表示拖拽\n    if (isMoving && editorRef.current) {\n      const rect = editorRef.current.getBoundingClientRect()\n      const rad = (layer.rotate % 180) * Math.PI / 180\n      const newHeight = Math.abs((rect.height - layer.width * scale * Math.sin(rad)) / Math.cos(rad))\n\n      // 高度不一致表示换行/减行\n      if (Math.abs(newHeight / scale - layer.height) > 1) {\n        const _layer = cloneDeep(layer)\n        _layer.height = newHeight / scale\n        setLayer(_layer)\n      }\n    }\n  }, [layer, scale, isMoving, canvasRect, setLayer])\n\n  // 进入编辑状态\n  const onEditText = () => {\n    setEditStatus(layer.id)\n  }\n\n  // 初始化quill实例\n  useEffect(() => {\n    if (editorRef.current && !editor) {\n      const instance = new Quill(editorRef.current)\n      setEditor(instance)\n    }\n  }, [editor])\n\n  // 设置文本内容\n  useEffect(() => {\n    if (editor && layer.source.content && editor.getText() !== layer.source.content) {\n      editor.setText(layer.source.content)\n    }\n  }, [editor, layer.source.content])\n\n  // 设置编辑状态\n  useEffect(() => {\n    if (editor) {\n      editor.enable(layer.isEditing)\n      layer.isEditing && editor.setSelection(0, 1000)\n    }\n  }, [editor, layer.isEditing])\n\n  useEffect(() => {\n    if (editor) {\n      editor.on('text-change', onTextChange)\n    }\n    return () => {\n      editor?.off('text-change', onTextChange)\n    }\n  }, [editor, onTextChange])\n\n  return <TextWrapper\n    style={{\n      transform: `scale(${layer.scale})`,\n      width: `${layer.width / (layer.scale || 1)}px`,\n      height: `${layer.height / (layer.scale || 1)}px`\n    }}\n  >\n    <Text\n      data={layer.style as FontStyle}\n      onDoubleClick={onEditText}\n    >\n      <Editor ref={editorRef} spellCheck=\"false\" />\n    </Text>\n  </TextWrapper>\n})\n\nconst TextWrapper = styled.div`\n  transform-origin: 0 0;\n`\n\nconst Text = styled.div<{data: FontStyle}>(\n  {},\n  props => ({\n    fontFamily: `\"${props.data.font}\"`,\n    fontSize: props.data.fontSize,\n    color: props.data.color,\n    lineHeight: props.data.lineHeight,\n    textAlign: props.data.textAlign,\n    fontWeight: props.data.fontWeight,\n    textDecorationLine: props.data.underline ? 'underline' : 'none'\n  })\n)\n\nconst Editor = styled.div`\n  font-family: inherit;\n  font-size: inherit;\n\n  .ql-editor {\n    padding: 0;\n    overflow: visible;\n    font-family: inherit;\n    line-height: inherit;\n    text-align: inherit;\n    white-space: break-spaces;\n    /* user-select: text; */\n    line-break: anywhere;\n\n    &>* {\n      cursor: inherit;\n    }\n  }\n`","import { observer } from 'mobx-react';\nimport styled from \"@emotion/styled\";\nimport { Layer } from 'types';\nimport { templateStore } from 'store/template';\nimport { MouseEvent } from 'react';\n\nexport default observer(({ layer }: { layer: Layer }) => {\n  const { setEditStatus } = templateStore\n\n  const onClipImage = (e: MouseEvent) => {\n    e.stopPropagation()\n    setEditStatus(layer.id)\n\n  }\n\n  return (\n    <ImgWrapper onDoubleClick={onClipImage}>\n      <div style={{\n        position: 'absolute',\n        width: `${layer.clip?.width}px`,\n        height: `${layer.clip?.height}px`,\n        transform: `translate(-${layer.clip?.left}px, -${layer.clip?.top}px)`\n      }}>\n        <Img src={layer.source.imageUrl} draggable=\"false\" />\n      </div>\n    </ImgWrapper>\n  )\n})\n\nconst ImgWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n`\n\nconst Img = styled.img`\n  width: 100%;\n  height: 100%;\n`","export default __webpack_public_path__ + \"static/media/resize.771f2b8f.svg\";","import { observer } from 'mobx-react';\nimport styled from \"@emotion/styled\";\nimport { Layer, POINT_TYPE, Coords } from 'types';\nimport { templateStore } from 'store/template';\nimport { ScaleContext } from 'store/context';\nimport { MouseEvent, useContext, useEffect, useState } from 'react';\nimport { MouseEvents } from 'utils/mouseEvent';\nimport { normalResize, rotateResize } from 'utils/resizeLayer'\nimport resizeIcon from 'assets/resize.svg'\nimport { cloneDeep } from 'lodash'\nimport { CheckOutlined, CloseOutlined } from '@ant-design/icons';\nimport { createPortal } from \"react-dom\";\n\nlet preLayer: Partial<Layer> = {}\n\nexport default observer(({ info }: { info: Layer }) => {\n  const { template, setLayer, resetEditStatus } = templateStore\n  const scale = useContext(ScaleContext)\n\n  const [layer, setLayerInfo] = useState(info)\n\n  const confirm = (e: MouseEvent) => {\n    e.stopPropagation()\n    setLayer(layer)\n    resetEditStatus()\n  }\n\n  const cancel = (e: MouseEvent) => {\n    e.stopPropagation()\n    resetEditStatus()\n  }\n\n  const onMaskClick = (e: MouseEvent) => {\n    e.stopPropagation()\n    if ((e.target as HTMLElement).id === 'clipImageMask') {\n      confirm(e)\n    }\n  }\n\n  useEffect(() => {\n    setLayerInfo(info)\n  }, [info])\n\n  const clipHandle = (newLayer: Layer, point: POINT_TYPE) => {\n    const handleTop = () => {\n      if (newLayer.clip) {\n        const clipTop = newLayer.clip.height - newLayer.height - newLayer.clip.bottom\n        if (clipTop >= 0) {\n          newLayer.clip.top = clipTop\n          newLayer.clip.pre.top = clipTop\n        } else {\n          newLayer.height = preLayer.height as number\n          newLayer.position.y = preLayer.position?.y as number\n        }\n      }\n    }\n    const handleLeft = () => {\n      if (newLayer.clip) {\n        const clipLeft = newLayer.clip.width - newLayer.width - newLayer.clip.right\n        if (clipLeft >= 0) {\n          newLayer.clip.left = clipLeft\n          newLayer.clip.pre.left = clipLeft\n        } else {\n          newLayer.width = preLayer.width  as number\n          newLayer.position.x = preLayer.position?.x  as number\n        }\n      }\n    }\n    const handleRight = () => {\n      if (newLayer.clip) {\n        const clipRight = newLayer.clip.width - newLayer.width - newLayer.clip.left\n        if (clipRight >= 0) {\n          newLayer.clip.right = clipRight\n          newLayer.clip.pre.right = clipRight\n        } else {\n          newLayer.width = newLayer.clip.width - newLayer.clip.left\n        }\n      }\n    }\n    const handleBottom = () => {\n      if (newLayer.clip) {\n        const clipBottom = newLayer.clip.height - newLayer.height - newLayer.clip.top\n        if (clipBottom >= 0) {\n          newLayer.clip.bottom = clipBottom\n          newLayer.clip.pre.bottom = clipBottom\n        } else {\n          newLayer.height = newLayer.clip.height - newLayer.clip.top\n        }\n      }\n    }\n    if (newLayer.clip) {\n      switch (point) {\n        case POINT_TYPE.BR: {\n          handleBottom()\n          handleRight()\n          break\n        }\n        case POINT_TYPE.BL: {\n          handleBottom()\n          handleLeft()\n          break\n        }\n        case POINT_TYPE.TL: {\n          handleTop()\n          handleLeft()\n          break\n        }\n        case POINT_TYPE.TR: {\n          handleTop()\n          handleRight()\n          break\n        }\n      }\n    }\n    return newLayer\n  }\n\n  // 调整大小 无旋转\n  const resizeNormal = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    const _layer = cloneDeep(layer)\n    new MouseEvents(e, (payload) => {\n      preLayer = cloneDeep(_layer)\n\n      // 普通拖拽框大小\n      const newLayer = normalResize(_layer, point, payload.diff, scale, false)\n      const res = clipHandle(newLayer, point)\n\n      setLayerInfo(Object.assign({}, res))\n    }, () => {\n\n    })\n  }\n\n  // 调整大小 有旋转\n  // TODO: 拖拽优化\n  const resizeWithRotate = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    const _layer = cloneDeep(layer)\n\n    // 图层相对于画布左上角的中心点\n    const center = {\n      x: (_layer.position.x + _layer.width / 2) * scale,\n      y: (_layer.position.y + _layer.height / 2) * scale\n    }\n\n    // 获取边框圆点中心点\n    const pointRect = (e.target as HTMLElement)?.getBoundingClientRect()\n    const canvasRect = (document.querySelector('#layerControl') as HTMLElement)?.getBoundingClientRect()\n    const pointCenter = {\n      x: pointRect.left - Number(canvasRect.left) + pointRect.width / 2,\n      y: pointRect.top - Number(canvasRect.top) + pointRect.height / 2\n    }\n\n    // 获取对称点\n    const symmetricPoint = {\n      x: center.x - (pointCenter.x - center.x),\n      y: center.y - (pointCenter.y - center.y)\n    }\n\n    const whRatio = _layer.width / _layer.height\n\n    new MouseEvents(e, ({ curCoords }: { curCoords: Coords; }) => {\n      const curPoint = {\n        x: curCoords.x - Number(canvasRect.left),\n        y: curCoords.y - Number(canvasRect.top)\n      }\n\n      preLayer = cloneDeep(layer)\n\n      // 处理旋转的拖拽\n      const newLayer = rotateResize(point, curPoint, symmetricPoint, pointCenter, _layer, layer, whRatio, scale, false)\n\n      const res = clipHandle(newLayer, point)\n\n      setLayerInfo(Object.assign({}, res))\n    }, () => {\n\n    })\n  }\n\n  // 调整大小\n  const resize = (e: MouseEvent<HTMLElement>, point: POINT_TYPE) => {\n    e.stopPropagation()\n    if (info.rotate === 0) {\n      resizeNormal(e, point)\n    } else {\n      resizeWithRotate(e, point)\n    }\n  }\n\n  // 拖拽图片位置\n  // TODO: 旋转后拖拽优化\n  const onDragImage = (e: MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation()\n    // 初始化拖拽事件\n    new MouseEvents(e, ({ diff }: { diff: Coords }) => {\n      const { clip } = layer\n      if (clip) {\n        const newTop = clip.top - diff.y / scale * (layer.reverse?.y || 1)\n        const newLeft = clip.left - diff.x / scale * (layer.reverse?.x || 1)\n        const newRight = clip.right + diff.x / scale * (layer.reverse?.x || 1)\n        const newBottom = clip.bottom + diff.y / scale * (layer.reverse?.y || 1)\n\n        if (newTop >= 0 && newBottom >= 0) {\n          clip.top = newTop\n          clip.bottom = newBottom\n          clip.pre.top = newTop\n          clip.pre.bottom = newBottom\n          setLayerInfo(Object.assign({}, layer))\n        }\n        if (newRight >= 0 && newLeft >= 0) {\n          clip.left = newLeft\n          clip.right = newRight\n          clip.pre.left = newLeft\n          clip.pre.right = newRight\n          setLayerInfo(Object.assign({}, layer))\n        }\n      }\n    })\n  }\n\n  return (\n    <>\n      <Mask id=\"clipImageMask\" onMouseDown={onMaskClick}>\n        <Wrapper style={{\n          width: template.global.width * scale,\n          height: template.global.height * scale\n        }}>\n          <CanvasContent style={{\n            width: template.global.width,\n            height: template.global.height,\n            transform: `scale(${scale})`\n          }}>\n            {/* 裁剪效果层 */}\n            <LayerWrapper style={{\n              width: layer.width,\n              height: layer.height,\n              transform: `translate(${layer.position.x}px, ${layer.position.y}px) rotate(${layer.rotate}deg) scale(${layer.reverse?.x || 1}, ${layer.reverse?.y || 1})`\n            }}>\n              <ImgWrapper>\n                <div style={{\n                  position: 'absolute',\n                  width: `${layer.clip?.width}px`,\n                  height: `${layer.clip?.height}px`,\n                  transform: `translate(-${layer.clip?.left}px, -${layer.clip?.top}px)`\n                }}>\n                  <Img src={layer.source.imageUrl} draggable=\"false\" />\n                </div>\n              </ImgWrapper>\n            </LayerWrapper>\n          </CanvasContent>\n          {/* 编辑层 */}\n          <LayerControl style={{\n            width: template.global.width * scale,\n            height: template.global.height * scale\n          }}>\n            {/* 裁剪边框 */}\n            <BorderEl \n              className={layer.reverse?.x === -1 || layer.reverse?.y === -1 ? 'hidden' : ''}\n              style={{\n                width: layer.width * scale,\n                height: layer.height * scale,\n                transform: `translate(${layer.position.x * scale}px, ${layer.position.y * scale}px) rotate(${layer.rotate}deg)`\n              }}>\n              {(layer.reverse?.x !== -1 && layer.reverse?.y !== -1) && <>\n                  <AngleTL onMouseDown={e => resize(e, POINT_TYPE.TL)}><img src={resizeIcon} alt=\"\" /></AngleTL>\n                  <AngleTR onMouseDown={e => resize(e, POINT_TYPE.TR)}><img src={resizeIcon} alt=\"\" /></AngleTR>\n                  <AngleBL onMouseDown={e => resize(e, POINT_TYPE.BL)}><img src={resizeIcon} alt=\"\" /></AngleBL>\n                  <AngleBR onMouseDown={e => resize(e, POINT_TYPE.BR)}><img src={resizeIcon} alt=\"\" /></AngleBR>\n                </>\n              }\n              <Line1 /><Line2 /><Line3 /><Line4 />\n            </BorderEl>\n\n            {/* 背景拖动层 */}\n            <LayerWrapper\n              style={{\n                width: layer.width * scale,\n                height: layer.height * scale,\n                transform: `translate(${layer.position.x * scale}px, ${layer.position.y * scale}px) rotate(${layer.rotate}deg) scale(${layer.reverse?.x || 1}, ${layer.reverse?.y || 1})`\n              }}\n              onMouseDown={onDragImage}\n            >\n              <ImgWrapper style={{ overflow: 'visible' }}>\n                <div style={{\n                  position: 'absolute',\n                  width: `${layer.clip && layer.clip.width * scale}px`,\n                  height: `${layer.clip && layer.clip.height * scale}px`,\n                  transform: `translate(-${layer.clip && layer.clip.left * scale}px, -${layer.clip && layer.clip.top * scale}px)`,\n                  border: '2px dashed #00c4cc',\n                  cursor: 'move'\n                }}>\n                  <Img src={layer.source.imageUrl} draggable=\"false\" style={{ opacity: 0.5 }} />\n                </div>\n              </ImgWrapper>\n            </LayerWrapper>\n          </LayerControl>\n        </Wrapper>\n      </Mask>\n      {/* 传送工具栏 */}\n      <TransportToolBar>\n        <ToolBar>\n          <ToolItem onMouseDown={confirm}><CheckOutlined />完成</ToolItem>\n          <ToolItem onMouseDown={cancel}><CloseOutlined />取消</ToolItem>\n        </ToolBar>\n      </TransportToolBar>\n    </>\n  )\n})\n\n// 传送门\nfunction TransportToolBar ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#toolBar') as HTMLDivElement\n  )\n}\n\nconst Mask = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(0,0,0,.3);\n`\n\nconst Wrapper = styled.div`\n  flex: none;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  pointer-events: none;\n`\n\nconst CanvasContent = styled.div`\n  flex: none;\n  position: relative;\n  overflow: visible;\n  background-color: transparent;\n  user-select: none;\n  pointer-events: none;\n`\n\nconst LayerWrapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: auto;\n  user-select: none;\n  cursor: default;\n\n  &.moving {\n    cursor: all-scroll;\n  }\n`\n\nconst ImgWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n`\n\nconst Img = styled.img`\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n`\n\nconst LayerControl = styled(CanvasContent)`\n position: absolute;\n top: 0;\n left: 0;\n`\n\nconst BorderEl = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  z-index: 1;\n\n  &.hidden {\n    &:after {\n      opacity: 0;\n    }\n  }\n\n  &:after {\n    content: '';\n    position: absolute;\n    top: -1px;\n    left: -1px;\n    right: -1px;\n    bottom: -1px;\n    border: 2px solid #00c4cc;\n  }\n`\n\nconst Line = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 1px;\n  height: 100%;\n  background-color: #fff;\n`\n\nconst Line1 = styled(Line)`\n  left: 33%;\n  transform: scaleX(.7);\n`\n\nconst Line2 = styled(Line)`\n  left: 66%;\n  transform: scaleX(.7);\n`\n\nconst Line3 = styled(Line)`\n  top: 33%;\n  width: 100%;\n  height: 1px;\n  transform: scaleY(.7);\n`\n\nconst Line4 = styled(Line)`\n  top: 66%;\n  width: 100%;\n  height: 1px;\n  transform: scaleY(.7);\n`\n\nconst ResizeAngle = styled.span`\n  position: absolute;\n  display: block;\n  background: transparent;\n  z-index: 1;\n  pointer-events: auto;\n  width: 22px;\n  height: 22px;\n  user-select: none;\n\n  img {\n    width: 14px;\n    height: 14px;\n    pointer-events: none;\n  }\n`\n\nconst AngleTL = styled(ResizeAngle)`\n  top: -11px;\n  left: -11px;\n  transform: rotate(180deg);\n  cursor: nwse-resize;\n`\n\nconst AngleTR = styled(ResizeAngle)`\n  top: -11px;\n  right: -11px;\n  transform: rotate(-90deg);\n  cursor: nesw-resize;\n`\n\nconst AngleBL = styled(ResizeAngle)`\n  left: -11px;\n  bottom: -11px;\n  transform: rotate(90deg);\n  cursor: nesw-resize;\n`\n\nconst AngleBR = styled(ResizeAngle)`\n  bottom: -11px;\n  right: -11px;\n  cursor: nwse-resize;\n`\n\nconst ToolBar = styled.div`\n  position: absolute;\n  left: 0;\n  top: 0;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n  padding-left: 10px;\n  z-index: 1;\n  background-color: #fff;\n`\n\nconst ToolItem = styled.div`\n  display: flex;\n  align-items: center;\n  margin-right: 10px;\n  padding: 4px 10px;\n  font-size: 16px;\n  border-radius: 4px;\n  cursor: pointer;\n\n  &:hover {\n    background-color: rgba(64,87,109,.07);\n  }\n\n  span {\n    margin-right: 8px;\n  }\n`","import { observer } from 'mobx-react';\nimport styled from \"@emotion/styled\";\nimport { Layer } from 'types';\n\nexport default observer(({ layer }: { layer: Layer }) => {\n  return <Rect style={{\n    borderWidth: layer.rectInfo?.borderWidth,\n    borderColor: layer.rectInfo?.borderColor,\n    borderStyle: layer.rectInfo?.borderStyle,\n    backgroundColor: layer.rectInfo?.fill\n  }}/>\n})\n\nconst Rect = styled.div`\n  width: 100%;\n  height: 100%;\n  border-style: solid;\n`\n","import { observer } from 'mobx-react';\nimport styled from \"@emotion/styled\";\nimport { Layer } from 'types';\n\nexport default observer(({ layer }: { layer: Layer }) => {\n  return <Circle style={{\n    borderWidth: layer.circleInfo?.borderWidth,\n    borderColor: layer.circleInfo?.borderColor,\n    borderStyle: layer.circleInfo?.borderStyle,\n    backgroundColor: layer.circleInfo?.fill\n  }}/>\n})\n\nconst Circle = styled.div`\n  width: 100%;\n  height: 100%;\n  border-style: solid;\n  border-radius: 50%;\n`\n","import React, { useContext, MouseEvent, DragEvent } from \"react\";\nimport styled from \"@emotion/styled\";\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport Layer from './layer/Layer';\nimport { LAYER_TYPE, Layer as LayerType } from 'types'\nimport { ImageItem } from \"types/image\";\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { toJS } from 'mobx';\nimport TextEditor from './layer/TextEditor';\nimport ImageLayer from './layer/Image'\nimport ClipImage from \"./ClipImage\";\nimport Rect from './layer/shapes/Rect'\nimport Circle from './layer/shapes/Circle'\nimport { createPortal } from \"react-dom\";\n\ninterface Props {\n  width: number;\n  height: number;\n  scale: number;\n}\n\n// 拖拽图片时鼠标的位置\nconst dragCursorPosition = {\n  x: 0,\n  y: 0\n}\n\n// 画布\nexport default observer(() => {\n  const { template, layers, addLayer, resetSelectStatus, setLayerType } = templateStore\n  const { global, background } = template\n\n  const scale = useContext(ScaleContext)\n  const {isSelectedBackground, setIsSelectedBackground} = useContext<{\n    isSelectedBackground: boolean;\n    setIsSelectedBackground: React.Dispatch<React.SetStateAction<boolean>>\n  }>(BackgroundContext)\n\n  // 选中背景\n  const selectBackground = (e: MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation()\n    setIsSelectedBackground(true)\n    resetSelectStatus()\n    setLayerType(LAYER_TYPE.BACKGROUND)\n  }\n\n  // 图片拖拽释放\n  const onDropCapture = (e: DragEvent<HTMLDivElement>) => {\n    e.preventDefault()\n    const onUseImage = (width: number, height: number, url: string) => {\n      const canvasRect = (document.querySelector('#layerControl') as HTMLElement)?.getBoundingClientRect()\n      const x = dragCursorPosition.x - canvasRect.left\n      const y = dragCursorPosition.y - canvasRect.top\n      const newLayer: LayerType = {\n        id: String(Date.now()),\n        type: 'image',\n        width: width,\n        height: height,\n        position: {\n          x: x / scale - width / 2,\n          y: y / scale - height / 2\n        },\n        rotate: 0,\n        reverse: {\n          x: 1,\n          y: 1\n        },\n        source: {\n          imageUrl: url\n        },\n        clip: {\n          width: width,\n          height: height,\n          top: 0,\n          left: 0,\n          right: 0,\n          bottom: 0,\n          pre: {\n            width: width,\n            height: height,\n            top: 0,\n            left: 0,\n            right: 0,\n            bottom: 0,\n          }\n        },\n        opacity: 1,\n        zIndex: layers.length ? layers[layers.length - 1].zIndex + 1 : 1,\n        isSelected: true,\n        isEditing: false,\n        isLocked: false,\n        scale: 1\n      }\n      resetSelectStatus()\n      addLayer(newLayer)\n    }\n\n    // 本地图片拖拽\n    if (e.dataTransfer.files.length > 0) {\n      const files = e.dataTransfer.files\n      if (!/image\\//.test(files[0].type)) return\n      const reader = new FileReader()\n      reader.readAsDataURL(files[0])\n      reader.onload = el => {\n        const url = el.target?.result\n        if (typeof url === 'string') {\n          const img = new Image()\n          img.src = url\n          img.onload = () => {\n            onUseImage(img.width, img.height, url)\n          }\n        }\n      }\n    } else { // 侧边栏图片\n      let image: ImageItem | null = null\n      try {\n        image = JSON.parse(e.dataTransfer?.getData('image'))\n      } catch (e) {}\n      // 使用图片\n      if (image) {\n        onUseImage(image.webformatWidth, image.webformatHeight, image.webformatURL)\n      }\n    }\n  }\n\n  const onDragOver = (e: DragEvent<HTMLDivElement>) => {\n    e.preventDefault()\n    dragCursorPosition.x = e.pageX\n    dragCursorPosition.y = e.pageY\n  }\n\n  return <Wrapper width={global.width} height={global.height} scale={scale}>\n    <CanvasContent\n      id=\"canvasContent\"\n      style={{ width: global.width, height: global.height, transform: `scale(${scale})` }}\n      onDrop={onDropCapture} onDragOver={onDragOver}>\n      <Background color={background.color} onClick={selectBackground} />\n      {\n        template.layers.map(layer => {\n          // 图片\n          if (layer.type === 'image') {\n            return layer.isEditing ?\n            <TransportImage key={layer.id}>\n              <ClipImage info={toJS(layer)} />\n            </TransportImage>\n            :\n            <Layer key={layer.id} info={layer}>\n              <ImageLayer layer={toJS(layer)} />\n            </Layer>\n          }\n          // 文字\n          if (layer.type === 'text') {\n            return layer.isEditing ?\n            <TransportEditor key={layer.id}>\n              <Layer info={layer}>\n                <TextEditor layer={toJS(layer)} />\n              </Layer>\n            </TransportEditor>\n            :\n            <Layer key={layer.id} info={layer}>\n              <TextEditor layer={toJS(layer)} />\n            </Layer>\n          }\n          // 矩形\n          if (layer.type === 'rect') {\n            return <Layer key={layer.id} info={layer}>\n              <Rect layer={toJS(layer)} />\n            </Layer>\n          }\n          // 圆形\n          if (layer.type === 'circle') {\n            return <Layer key={layer.id} info={layer}>\n              <Circle layer={toJS(layer)} />\n            </Layer>\n          }\n          return <></>\n        })\n      }\n    </CanvasContent>\n    {/* 编辑框传送点 */}\n    <LayerControl id=\"layerControl\" width={global.width} height={global.height} scale={scale}>\n        {isSelectedBackground && <BackgroundBorder />}\n        {/* 垂直辅助线 */}\n        <VLine id=\"verticalLine\" />\n        {/* 水平辅助线 */}\n        <HLine id=\"horizontalLine\" />\n    </LayerControl>\n    {/* 点前编辑的文本传送点 */}\n    <TextControl id=\"textControl\" style={{ width: global.width, height: global.height, transform: `scale(${scale})` }} />\n  </Wrapper>\n})\n\n// 传送门\nfunction TransportEditor ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#textControl') as HTMLDivElement\n  )\n}\n\n// 传送门\nfunction TransportImage ({ children }: { children: JSX.Element }) {\n  return createPortal(\n    children,\n    document.querySelector('#editorContainer') as HTMLDivElement\n  )\n}\n\nconst Background = styled.div<{ color: string; }>(\n  {\n    position: 'relative',\n    zIndex: -1,\n    width: '100%',\n    height: '100%'\n  },\n  props => ({\n    backgroundColor: props.color\n  })\n)\n\nconst Wrapper = styled.div<Props>(\n  {\n    flex: 'none',\n    position: 'relative',\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    margin: 'auto',\n    pointerEvents: 'none'\n  },\n  props => ({\n    width: props.width * props.scale + 100,\n    height: props.height * props.scale + 100\n  })\n)\n\nconst CanvasContent = styled.div`\n  flex: none;\n  position: relative;\n  overflow: hidden;\n  background-color: #fff;\n  user-select: none;\n  pointer-events: auto;\n`\n\nconst TextControl = styled(CanvasContent)`\n  position: absolute;\n  top: 50;\n  left: 50;\n  z-index: 1;\n  pointer-events: none;\n  overflow: visible;\n  background-color: transparent;\n`\n\nconst LayerControl = styled.div<Props>(\n  {\n    position: 'absolute',\n    top: 50,\n    left: 50,\n    zIndex: 2,\n    pointerEvents: 'none'\n  },\n  props => ({\n    width: props.width * props.scale,\n    height: props.height * props.scale\n  })\n)\n\nconst BackgroundBorder = styled.div`\n  position: absolute;\n  top: -1px;\n  left: -1px;\n  right: -1px;\n  bottom: -1px;\n  border: 2px solid #00c4cc;\n  background: transparent;\n  pointer-events: none;\n`\n\nconst VLine = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 0;\n  height: 100%;\n  border-left: 1px dashed #c228ff;\n  visibility: hidden;\n  z-index: 2;\n`\n\nconst HLine = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 0;\n  border-top: 1px dashed #c228ff;\n  visibility: hidden;\n  z-index: 2;\n`","export default __webpack_public_path__ + \"static/media/opacity.6dad8d31.svg\";","export default __webpack_public_path__ + \"static/media/border-weight.505b2f5f.svg\";","export default __webpack_public_path__ + \"static/media/border-style.11c5ec46.svg\";","\n// 预设字体列表\nexport const FONT_LIST: Array<{\n  name: string;\n  value: string\n}> = [\n  {\n    name: '宋体',\n    value: 'SimSun'\n  },\n  {\n    name: '黑体',\n    value: 'SimHei'\n  },\n  {\n    name: '微软雅黑',\n    value: 'Microsoft Yahei'\n  },\n  {\n    name: '楷体',\n    value: 'KaiTi'\n  },\n  {\n    name: '华文楷体',\n    value: 'STKaiti'\n  },\n  {\n    name: '翩翩体-简',\n    value: 'Hanzipen SC'\n  },\n  {\n    name: '娃娃体-简',\n    value: 'Wawati SC'\n  },\n  {\n    name: '圆体-简',\n    value: 'Yuanti SC'\n  },\n  {\n    name: '兰亭黑-简',\n    value: 'Lantinghei SC'\n  }\n]\n\n// 字体大小\nexport const FONTSIZE_LIST = [6,8,10,12,14,16,18,20,22,24,28,32,36,42,48,56,64,72,80,88,96,104,120,144]\n\nexport const CANVAS_SIZE_LIST = [\n  {\n    width: 1280,\n    height: 720,\n    label: '1280px × 720px',\n    value: '1'\n  },\n  {\n    width: 720,\n    height: 1280,\n    label: '720px × 1280px',\n    value: '2'\n  },\n  {\n    width: 1024,\n    height: 768,\n    label: '1024px × 768px',\n    value: '3'\n  },\n  {\n    width: 768,\n    height: 1024,\n    label: '768px × 1024px',\n    value: '4'\n  },\n  {\n    width: 1920,\n    height: 1080,\n    label: '1920px × 1080px',\n    value: '5'\n  },\n]","import styled from \"@emotion/styled\";\nimport { observer } from 'mobx-react';\nimport { templateStore } from 'store/template'\nimport { LAYER_TYPE, Align, RectShape } from 'types'\nimport {\n  Popover,\n  Select,\n  Dropdown,\n  Menu,\n  Slider,\n  Popconfirm,\n  Radio,\n  Space,\n  InputNumber,\n  RadioChangeEvent\n} from 'antd';\nimport {\n  DeleteOutlined,\n  AlignLeftOutlined,\n  AlignCenterOutlined,\n  AlignRightOutlined,\n  SwapOutlined,\n  BoldOutlined,\n  UnderlineOutlined,\n  LockOutlined,\n  UnlockOutlined\n} from '@ant-design/icons';\nimport opacityIcon from 'assets/opacity.svg'\nimport borderWidthIcon from 'assets/border-weight.svg'\nimport borderStyleIcon from 'assets/border-style.svg'\nimport { ChromePicker, ColorResult } from 'react-color';\nimport { cloneDeep, isNumber } from \"lodash\";\nimport { FONT_LIST, FONTSIZE_LIST, CANVAS_SIZE_LIST } from 'utils/const'\nimport { useEffect, useState } from \"react\";\n\nconst { Option } = Select;\n\nexport default observer(() => {\n  const {\n    template,\n    layerType,\n    layers,\n    setCanvasSize,\n    setLayer,\n    setLayers,\n    setLayerLevel,\n    removeLayer,\n    setEditStatus,\n    setLayerLock,\n    setBackgroundColor,\n    setNeedUpdateLayerHeight\n  } = templateStore\n\n  const [selectValue, setSelectValue] = useState('1')\n\n  const activeLayer = layers.find(l => l.isSelected)\n  const layerScale = activeLayer?.scale || 1\n\n  // 当前颜色\n  let color = ''\n  if (layerType === LAYER_TYPE.TEXT) {\n    color = activeLayer?.style?.color || ''\n  } else if (layerType === LAYER_TYPE.BACKGROUND) {\n    color = template.background.color\n  }\n\n  // 当前字体\n  const font = activeLayer?.style?.font || ''\n  // 当前字体\n  const fontSize = activeLayer?.style?.fontSize || 0\n  // 文字水平对齐\n  const textAlign = activeLayer?.style?.textAlign || 'left'\n  // 当前字体粗细\n  const fontWeight = activeLayer?.style?.fontWeight || 400\n  // 当前字体是否有下划线\n  const hasUnderline = activeLayer?.style?.underline || false\n\n  // 当前形状\n  let shapeInfo: Partial<RectShape> = {}\n  if (layerType === LAYER_TYPE.CIRCLE) {\n    shapeInfo = activeLayer?.circleInfo as RectShape\n  } else if (layerType === LAYER_TYPE.RECT) {\n    shapeInfo = activeLayer?.rectInfo as RectShape\n  }\n\n  // 透明度\n  const opacity = activeLayer?.opacity\n  \n  // 图层是否被锁定了\n  const isLocked = activeLayer?.isLocked || false\n  // 图层的层级关系\n  const levelInfo = {\n    min: 1,\n    max: 100,\n    current: 1\n  }\n  if (activeLayer) {\n    levelInfo.current = layers.findIndex(l => l.id === activeLayer.id) + 1\n    levelInfo.max = layers.length\n  }\n\n  const canvasWidth = template.global.width\n  const canvasHeight = template.global.height\n\n  useEffect(() => {\n    const res = CANVAS_SIZE_LIST.find(i => i.width === canvasWidth && i.height === canvasHeight && i.value !== selectValue)\n    if (res) {\n      setSelectValue(res.value)\n    } else if (selectValue !== '6') {\n      setSelectValue('6')\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // 选择颜色\n  const onColorChange = (clr: ColorResult) => {\n    const rgba = `rgba(${clr.rgb.r}, ${clr.rgb.g}, ${clr.rgb.b}, ${clr.rgb.a})`\n    // 文本\n    if (layerType === LAYER_TYPE.TEXT) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.type === 'text' && layer.style) {\n        layer.style.color = rgba\n        setLayer(layer)\n      }\n    }\n    // 背景\n    if (layerType === LAYER_TYPE.BACKGROUND) {\n      setBackgroundColor(rgba)\n    }\n  }\n\n  // 选择形状填充颜色\n  const onFillColorChange = (clr: ColorResult) => {\n    const rgba = `rgba(${clr.rgb.r}, ${clr.rgb.g}, ${clr.rgb.b}, ${clr.rgb.a})`\n    // 矩形\n    if (layerType === LAYER_TYPE.RECT) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.rectInfo) {\n        layer.rectInfo.fill = rgba\n        setLayer(layer)\n      }\n    }\n    // 圆形\n    if (layerType === LAYER_TYPE.CIRCLE) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.circleInfo) {\n        layer.circleInfo.fill = rgba\n        setLayer(layer)\n      }\n    }\n  }\n\n  // 选择形状描边颜色\n  const onBorderColorChange = (clr: ColorResult) => {\n    const rgba = `rgba(${clr.rgb.r}, ${clr.rgb.g}, ${clr.rgb.b}, ${clr.rgb.a})`\n    // 矩形\n    if (layerType === LAYER_TYPE.RECT) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.rectInfo) {\n        layer.rectInfo.borderColor = rgba\n        setLayer(layer)\n      }\n    }\n    // 圆形\n    if (layerType === LAYER_TYPE.CIRCLE) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.circleInfo) {\n        layer.circleInfo.borderColor = rgba\n        setLayer(layer)\n      }\n    }\n  }\n\n  // 形状描边粗细改变\n  const onBorderWidthChange = (val: number) => {\n    // 矩形\n    if (layerType === LAYER_TYPE.RECT) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.rectInfo) {\n        layer.rectInfo.borderWidth = val\n        setLayer(layer)\n      }\n    }\n    // 圆形\n    if (layerType === LAYER_TYPE.CIRCLE) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.circleInfo) {\n        layer.circleInfo.borderWidth = val\n        setLayer(layer)\n      }\n    }\n  }\n\n  // 形状描边样式改变\n  const onBorderStyleChange = (val: string) => {\n    // 矩形\n    if (layerType === LAYER_TYPE.RECT) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.rectInfo) {\n        layer.rectInfo.borderStyle = val\n        setLayer(layer)\n      }\n    }\n    // 圆形\n    if (layerType === LAYER_TYPE.CIRCLE) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.circleInfo) {\n        layer.circleInfo.borderStyle = val\n        setLayer(layer)\n      }\n    }\n  }\n\n  // 选择字体\n  const onFontChange = (val: string) => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.font = val\n      setLayer(layer)\n    }\n  }\n\n  // 改变字体大小\n  const onFontsizeChange = (val: string) => {\n    const size = Number(val)\n    if (!isNaN(size)) {\n      const layer = cloneDeep(activeLayer)\n      if (layer?.type === 'text' && layer.style) {\n        layer.style.fontSize = size / layerScale\n        setLayer(layer)\n        setNeedUpdateLayerHeight(true)\n      }\n    }\n  }\n\n  // 改变字体粗细\n  const onWeightChange = () => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.fontWeight = layer.style.fontWeight === 700 ? 400 : 700\n      setLayer(layer)\n    }\n  }\n\n  // 设置下划线\n  const onUnderlineChange = () => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.underline = !layer.style.underline\n      setLayer(layer)\n    }\n  }\n\n  // 改变文本水平对齐\n  const onTextAlignChange = () => {\n    let align: Align = 'left'\n    if (textAlign === 'left') align = 'center'\n    if (textAlign === 'center') align = 'right'\n    if (textAlign === 'right') align = 'left'\n    const layer = cloneDeep(activeLayer)\n    if (layer?.type === 'text' && layer.style) {\n      layer.style.textAlign = align\n      setLayer(layer)\n    }\n  }\n\n  // 翻转图片\n  const onReverseImage = (direction: 'x' | 'y') => {\n    const layer = cloneDeep(activeLayer)\n    if (layer?.reverse) {\n      if (direction === 'x') {\n        layer.reverse.x = layer.reverse.x === 1 ? -1 : 1\n      }\n      if (direction === 'y') {\n        layer.reverse.y = layer.reverse.y === 1 ? -1 : 1\n      }\n      setLayer(layer)\n    }\n  }\n\n  // 裁剪图片\n  const clipImage = () => {\n    setEditStatus(activeLayer?.id || '')\n  }\n\n  // 改变层级\n  const onLevelChange = (val: number) => {\n    // 下 -> 上\n    if (val > levelInfo.current) {\n      layers.forEach((l, idx) => {\n        if (idx + 1 > levelInfo.current && idx + 1 <= val) {\n          setLayerLevel(l.id, l.zIndex - 1)\n        }\n      })\n      activeLayer && setLayerLevel(activeLayer.id, activeLayer.zIndex + (val - levelInfo.current))\n    } else { // 上 -> 下\n      layers.forEach((l, idx) => {\n        if (idx + 1 >= val && idx + 1 < levelInfo.current) {\n          setLayerLevel(l.id, l.zIndex + 1)\n        }\n      })\n      activeLayer && setLayerLevel(activeLayer.id, activeLayer.zIndex - (levelInfo.current - val))\n    }\n    setLayers(cloneDeep(layers).sort((a, b) => a.zIndex - b.zIndex))\n  }\n\n  const onOpacityChange = (val: number) => {\n    const layer = cloneDeep(activeLayer)\n    if (layer) {\n      layer.opacity = val\n      setLayer(layer)\n    }\n  }\n\n  // 切换图层锁定状态\n  const onToggleLayerLock = () => {\n    if (activeLayer) {\n      setLayerLock(activeLayer.id, !activeLayer.isLocked)\n    }\n  }\n\n  // 删除图层\n  const onRemove = () => {\n    const layer = layers.find(layer => layer.isSelected)\n    if (layer) {\n      removeLayer(layer.id)\n    }\n  }\n\n  // 清空画布\n  const onClear = () => {\n    setLayers([])\n  }\n\n  // 选择画布尺寸\n  const onCanvasSizeChange = (e: RadioChangeEvent) => {\n    setSelectValue(e.target.value)\n    const res = CANVAS_SIZE_LIST.find(i => i.value === e.target.value)\n    if (res) {\n      setCanvasSize({\n        width: res.width,\n        height: res.height\n      })\n    }\n  }\n\n  // 画布宽度修改\n  const onChangeWidth = (val: number) => {\n    if (isNumber(val) && val > 0) {\n      setCanvasSize({\n        width: val,\n        height: canvasHeight\n      })\n    }\n  }\n\n  // 画布高度修改\n  const onChangeHeight = (val: number) => {\n    if (isNumber(val) && val > 0) {\n      setCanvasSize({\n        width: canvasWidth,\n        height: val\n      })\n    }\n  }\n\n  // 画布尺寸列表\n  const CanvasSizeOptions = (\n    <>\n      <Radio.Group onChange={onCanvasSizeChange} value={selectValue}>\n        <Space direction=\"vertical\">\n          {CANVAS_SIZE_LIST.map(i => <Radio key={i.value} value={i.value}>{i.label}</Radio>)}\n          <Radio value={'6'}>\n            自定义\n            {selectValue === '6' ? <div style={{ marginTop: 10 }}>\n              <InputNumber value={canvasWidth} size=\"small\" placeholder=\"宽\" style={{ width: 100, marginRight: 10 }} onChange={onChangeWidth} />×\n              <InputNumber value={canvasHeight} size=\"small\" placeholder=\"高\" style={{ width: 100, marginLeft: 10, marginRight: 10 }} onChange={onChangeHeight} /> 像素\n            </div> : null}\n          </Radio>\n        </Space>\n      </Radio.Group>\n    </>\n  )\n\n  return <ToolBarWrapper id=\"toolBar\">\n    <ItemGroup className={isLocked ? 'locked' : ''}>\n      {/* 画布尺寸 */}\n      {[LAYER_TYPE.EMPTY].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={CanvasSizeOptions}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <span className=\"text\">画布尺寸</span>\n          </Popover>\n        </ToolItem>\n      }\n      {/* 颜色 */}\n      {[LAYER_TYPE.BACKGROUND, LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={<ChromePicker color={color} onChange={onColorChange} />}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <ColorItem style={{ backgroundColor: color }} />\n          </Popover>\n        </ToolItem>\n      }\n\n      {/* 形状填充颜色 */}\n      {[LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={<ChromePicker color={shapeInfo.fill} onChange={onFillColorChange} />}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <ColorItem style={{ backgroundColor: shapeInfo.fill }} />\n          </Popover>\n        </ToolItem>\n      }\n\n      {/* 形状描边颜色 */}\n      {[LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={<ChromePicker color={shapeInfo.borderColor} onChange={onBorderColorChange} />}\n            trigger=\"click\"\n            placement=\"bottomLeft\"\n          >\n            <ColorItem style={{ backgroundColor: shapeInfo.borderColor }} />\n          </Popover>\n        </ToolItem>\n      }\n\n      {/* 形状描边粗细 */}\n      {[LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={\n              <Slider\n                value={shapeInfo.borderWidth}\n                min={0}\n                max={50}\n                step={1}\n                style={{ width: 180 }}\n                onChange={onBorderWidthChange}\n              />\n            }\n            trigger=\"click\"\n            placement=\"bottomRight\"\n          >\n            <img src={borderWidthIcon} width=\"24\" height=\"24\" alt=\"\" />\n          </Popover>\n        </ToolItem>\n      }\n\n      {/* 形状边框样式 */}\n      {[LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem>\n          <Dropdown \n            overlay={\n              <Menu style={{ width: 120 }}>\n                <Menu.Item\n                  key=\"1\"\n                  style={{ padding: '20px 10px' }}\n                  onClick={() => onBorderStyleChange('solid')}\n                >\n                  <BorderSolid />\n                </Menu.Item>\n                <Menu.Item\n                  key=\"2\"\n                  style={{ padding: '20px 10px' }}\n                  onClick={() => onBorderStyleChange('dashed')}\n                >\n                  <BorderDashed />\n                </Menu.Item>\n                <Menu.Item\n                  key=\"3\"\n                  style={{ padding: '20px 10px' }}\n                  onClick={() => onBorderStyleChange('dotted')}\n                >\n                  <BorderDotted />\n                </Menu.Item>\n              </Menu>\n            }\n            trigger={['click']}\n          >\n            <img src={borderStyleIcon} width=\"24\" height=\"24\" alt=\"\" />\n          </Dropdown>\n        </ToolItem>\n      }\n\n      {/* 字体 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Select\n            value={font}\n            style={{ width: 140 }}\n            placeholder=\"选择字体\"\n            onChange={onFontChange}\n          >\n            {FONT_LIST.map(f => <Option key={f.value} value={f.value}><span style={{ fontFamily: f.value }}>{f.name}</span></Option>)}\n          </Select>\n        </ToolItem>\n      }\n      {/* 字体大小 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem>\n          <Select\n            value={(fontSize * layerScale).toFixed(0)}\n            style={{ width: 100, textAlign: 'center' }}\n            placeholder=\"字体大小\"\n            onChange={onFontsizeChange}\n          >\n            {FONTSIZE_LIST.map(size => <Option key={size} value={size}>{size}</Option>)}\n          </Select>\n        </ToolItem>\n      }\n      {/* 加粗 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem className={fontWeight === 700 ? 'active' : ''} onClick={onWeightChange}>\n          <BoldOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 下划线 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem className={hasUnderline ? 'active' : ''} onClick={onUnderlineChange}>\n          <UnderlineOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 水平对齐 */}\n      {[LAYER_TYPE.TEXT].includes(layerType) &&\n        <ToolItem onClick={onTextAlignChange}>\n          {textAlign === 'left' && <AlignLeftOutlined style={{ fontSize: 24 }} />}\n          {textAlign === 'center' && <AlignCenterOutlined style={{ fontSize: 24 }} />}\n          {textAlign === 'right' && <AlignRightOutlined style={{ fontSize: 24 }} />}\n        </ToolItem>\n      }\n      {/* 图片翻转 */}\n      {[LAYER_TYPE.IMAGE].includes(layerType) &&\n        <ToolItem>\n          <Dropdown \n            overlay={\n              <Menu style={{ width: 120 }}>\n                <Menu.Item\n                  key=\"x\"\n                  style={{ padding: '20px' }}\n                  icon={<SwapOutlined />}\n                  onClick={() => onReverseImage('x')}\n                >\n                  水平翻转\n                </Menu.Item>\n                <Menu.Item\n                  key=\"y\"\n                  style={{ padding: '20px' }}\n                  icon={<SwapOutlined style={{ transform: 'rotate(90deg)' }} />}\n                  onClick={() => onReverseImage('y')}\n                >\n                  垂直翻转\n                </Menu.Item>\n              </Menu>\n            }\n            trigger={['click']}\n          >\n            <span className=\"text\">翻转</span>\n          </Dropdown>\n        </ToolItem>\n      }\n      {/* 图片裁剪 */}\n      {[LAYER_TYPE.IMAGE].includes(layerType) &&\n        <ToolItem onClick={clipImage}>\n          <span className=\"text\">裁剪</span>\n        </ToolItem>\n      }\n    </ItemGroup>\n    <ItemGroup className={isLocked ? 'locked' : ''}>\n      {/* 图层层级 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT, LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={\n              <Slider\n                value={levelInfo.current}\n                min={levelInfo.min}\n                max={levelInfo.max}\n                style={{ width: 180 }}\n                onChange={onLevelChange}\n              />\n            }\n            trigger=\"click\"\n            placement=\"bottomRight\"\n          >\n            <span className=\"text\">层级调整</span>\n          </Popover>\n        </ToolItem>\n      }\n      {/* 透明度 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT, LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem>\n          <Popover\n            content={\n              <Slider\n                value={opacity}\n                min={0}\n                max={1}\n                step={0.01}\n                style={{ width: 180 }}\n                onChange={onOpacityChange}\n              />\n            }\n            trigger=\"click\"\n            placement=\"bottomRight\"\n          >\n            <img src={opacityIcon} width=\"24\" height=\"24\" alt=\"\" />\n          </Popover>\n        </ToolItem>\n      }\n      {/* 图层锁定 */}\n      {[LAYER_TYPE.TEXT, LAYER_TYPE.IMAGE, LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem className={[\"item-lock\", isLocked ? 'active' : ''].join(' ')} onClick={onToggleLayerLock}>\n          {isLocked ? <LockOutlined style={{ fontSize: 24 }} /> : <UnlockOutlined style={{ fontSize: 24 }} />}\n        </ToolItem>\n      }\n      {/* 删除 */}\n      {[LAYER_TYPE.IMAGE, LAYER_TYPE.TEXT, LAYER_TYPE.RECT, LAYER_TYPE.CIRCLE].includes(layerType) &&\n        <ToolItem onClick={onRemove}>\n          <DeleteOutlined style={{ fontSize: 24 }} />\n        </ToolItem>\n      }\n      {/* 清空画布 */}\n      {[LAYER_TYPE.EMPTY].includes(layerType) &&\n        <ToolItem>\n          <Popconfirm\n            placement=\"bottomRight\"\n            title=\"确定清空画布？\"\n            onConfirm={onClear}\n            okText=\"清空\"\n            cancelText=\"取消\"\n          >\n            <span className=\"text\">清空画布</span>\n          </Popconfirm>\n        </ToolItem>\n      }\n    </ItemGroup>\n  </ToolBarWrapper>\n})\n\nconst ToolBarWrapper = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  height: 46px;\n  padding: 0 10px;\n  background-color: #fff;\n  border-bottom: 1px solid #ddd;\n  user-select: none;\n`\n\nconst ItemGroup = styled.div`\n  display: flex;\n  align-items: center;\n\n  &.locked>div:not(.item-lock) {\n    display: none;\n  }\n`\n\nconst ToolItem = styled.div`\n  display: flex;\n  align-items: center;\n  margin-right: 10px;\n  padding: 4px;\n  border-radius: 4px;\n  cursor: pointer;\n\n  &.active {\n    background-color: rgba(57,76,96,.15);\n  }\n\n  &:hover {\n    background-color: rgba(64,87,109,.07);\n  }\n\n  .text {\n    padding: 0 10px;\n    font-size: 16px;\n  }\n\n  input[type=\"search\"] {\n    text-align: center;\n  }\n`\n\nconst ColorItem = styled.div`\n  width: 28px;\n  height: 28px;\n  border: 2px solid #666;\n  border-radius: 4px;\n`\n\nconst BorderSolid = styled.div`\n  width: 100%;\n  height: 0;\n  border-top: 4px solid #000;\n`\n\nconst BorderDashed = styled.div`\n  width: 100%;\n  height: 0;\n  border-top: 4px dashed #000;\n`\n\nconst BorderDotted = styled.div`\n  width: 100%;\n  height: 0;\n  border-top: 4px dotted #000;\n`","import React, { MouseEvent, useCallback, useEffect, useRef, useState } from \"react\";\nimport styled from \"@emotion/styled\";\nimport Footer from \"./Footer\";\nimport Canvas from \"./Canvas\";\nimport ToolBar from \"./tool-bar/Index\"\nimport { ScaleContext, BackgroundContext } from 'store/context';\nimport { templateStore } from 'store/template';\nimport { observer } from 'mobx-react';\nimport { Layer } from 'types'\nimport { cloneDeep } from \"lodash\";\nimport undoRedo from 'utils/undoRedo';\n\nconst { undo, redo } = undoRedo()\n\n// 暂存复制的图层\nlet copyLayer: Partial<Layer> = {}\n\n// 编辑器\nexport default observer(() => {\n  // 画布缩放值\n  const [scale, setScale] = useState(1)\n  // 画布父级容器dom ref\n  const scrollWrapperRef = useRef<HTMLDivElement>(null)\n  // 获取模板数据\n  const { template, resetSelectStatus, removeLayer, addLayer } = templateStore\n\n  // 是否选中背景\n  const [isSelectedBackground, setIsSelectedBackground] = useState(false)\n\n  // 自适应\n  const responsive = useCallback(() => {\n    const wrapperEl = scrollWrapperRef.current\n    const canvasWidth = template.global.width\n    const canvasHeight = template.global.height\n    let scale = 1\n    if (wrapperEl && wrapperEl.clientWidth < canvasWidth + 100) {\n      scale = (wrapperEl.clientWidth - 100) / canvasWidth\n    }\n    if (wrapperEl && wrapperEl.clientHeight < (canvasHeight * scale + 100)) {\n      scale = (wrapperEl.clientHeight - 100) / canvasHeight\n    }\n    setScale(scale)\n  }, [template.global.height, template.global.width])\n\n  // 首次渲染画布尺寸适配\n  useEffect(() => {\n    responsive()\n  }, [responsive])\n\n  // 键盘事件监听\n  const onKeyboardListener = useCallback((e: KeyboardEvent) => {\n    // 页面失焦\n    if (document.activeElement === document.body || document.activeElement === null) {\n      // 删除\n      if (e.key === 'Backspace' || e.key === 'Delete') {\n        const layer = template.layers.find(layer => layer.isSelected)\n        if (layer) {\n          removeLayer(layer.id)\n        }\n      }\n      // 复制\n      if (e.key === 'c' && (e.metaKey || e.ctrlKey)) {\n        const layer = template.layers.find(layer => layer.isSelected)\n        if (layer && !template.layers.some(l => l.isEditing) && !layer.isLocked) {\n          copyLayer = cloneDeep(layer)\n        }\n      }\n      // 粘贴\n      if (e.key === 'v' && (e.metaKey || e.ctrlKey)) {\n        if (!template.layers.some(l => l.isEditing)) {\n          if (copyLayer.id) {\n            copyLayer.position && (copyLayer.position.x += 10)\n            copyLayer.position && (copyLayer.position.y += 10)\n            copyLayer.id = String(Date.now())\n            copyLayer.zIndex = template.layers.length ? template.layers[template.layers.length - 1].zIndex + 1 : 1\n            resetSelectStatus()\n            addLayer(copyLayer as Layer)\n          }\n        }\n      }\n      // 撤销\n      if (e.key === 'z' && (e.metaKey || e.ctrlKey) && !e.shiftKey) {\n        undo()\n      }\n      // 重做\n      if (e.key === 'z' && (e.metaKey || e.ctrlKey) && e.shiftKey) {\n        redo()\n      }\n    }\n  }, [addLayer, removeLayer, resetSelectStatus, template.layers])\n\n  useEffect(() => {\n    document.addEventListener('keydown', onKeyboardListener)\n    return () => { document.removeEventListener('keydown', onKeyboardListener) }\n  }, [onKeyboardListener])\n\n  // 取消所有图层的选中状态包括背景\n  const resetStatus = (e: MouseEvent<HTMLElement>) => {\n    // self\n    if ((e.target as HTMLElement).id === 'editorContainer') {\n      resetSelectStatus()\n      setIsSelectedBackground(false)\n    }\n  }\n\n  return <Wrapper>\n    <ToolBar />\n    <ScrollWrapper ref={scrollWrapperRef}>\n      <Container id=\"editorContainer\" onMouseDown={resetStatus}>\n        <BackgroundContext.Provider value={{ isSelectedBackground, setIsSelectedBackground }}>\n          <ScaleContext.Provider value={scale}>\n            <Canvas />\n          </ScaleContext.Provider>\n        </BackgroundContext.Provider>\n      </Container>\n    </ScrollWrapper>\n    <Footer scale={scale} setScale={(num) => setScale(num)} responsive={responsive} />\n  </Wrapper>\n})\n\nconst Wrapper = styled.div`\n  position: relative;\n  flex: 1;\n  overflow: hidden;\n`\n\nconst ScrollWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  height: calc(100% - 88px);\n  overflow: scroll;\n\n  ::-webkit-scrollbar {\n    width: 8px;\n    background: #eef2f8;\n\n    &:horizontal {\n      height: 8px;\n    }\n  }\n\n  ::-webkit-scrollbar-track {\n    background: #eef2f8;\n  }\n\n  ::-webkit-scrollbar-corner {\n    background: #eef2f8;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: #c4c4c4;\n    border: 8px solid rgba(0, 0, 0, 0);\n    border-radius: 9999px;\n\n    &:hover {\n      background: #adadad;\n    }\n  }\n`\n\nconst Container = styled.div`\n  position: absolute;\n  display: flex;\n  align-items: center;\n  min-width: 100%;\n  min-height: 100%;\n`","import React from \"react\";\nimport styled from \"@emotion/styled\";\nimport Sidebar from \"./side-bar/Sidebar\";\nimport Editor from \"./Editor\";\n\nexport default function Main () {\n  return <MainBody>\n    <Sidebar />\n    <Editor />\n  </MainBody>\n}\n\nconst MainBody = styled.main`\n  display: flex;\n  height: calc(100vh - 56px);\n  background-color: #eef2f8;\n  overflow: hidden;\n`\n","import React from 'react';\nimport Nav from 'components/Nav'\nimport Main from 'components/Main'\nimport './App.css';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Nav />\n      <Main />\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from 'pages/App';\nimport reportWebVitals from './reportWebVitals';\nimport 'antd/dist/antd.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}